# 3.2.2.6. UC-US-06: Quản lý Bộ sưu tập (Manage Collection)

## 1. Đặc tả Use Case

| Mục | Nội dung |
| :--- | :--- |
| **Mã UC** | UC-US-06 |
| **Tên UC** | Quản lý Bộ sưu tập (Manage Collection) |
| **Mô tả** | Người dùng tạo, sửa, xóa bộ sưu tập (Album) và thêm/bớt bài viết vào bộ sưu tập. |
| **Tác nhân sử dụng** | User |
| **Sự kiện kích hoạt** | Người dùng vào tab "Collection" hoặc chọn "Save" trên bài viết. |
| **Luồng sự kiện chính** | **1. Tạo Bộ sưu tập**<br>1. User nhấn "New Collection".<br>2. Nhập tên và chọn chế độ Private/Public.<br>3. Hệ thống gọi `POST /api/collections` -> Insert DB.<br><br>**2. Thêm bài viết vào Collection**<br>1. User chọn "Save" trên bài viết.<br>2. Chọn Collection đích.<br>3. Hệ thống gọi `POST /api/collections/{id}/posts/{postId}`.<br>4. Server tạo liên kết `PostCollections`.<br><br>**3. Xóa bộ sưu tập**<br>1. User chọn Delete Collection.<br>2. Hệ thống gọi `DELETE /api/collections/{id}`.<br>3. Xóa Collection và các liên kết (không xóa bài viết gốc). |
| **Luồng sự kiện phụ** | **A1. Không phải chủ sở hữu (Delete/Edit)**:<br>- API trả về 403 Forbidden.<br><br>**A2. Collection riêng tư (Access)**:<br>- Người khác truy cập Collection Private -> API trả về 403 Forbidden.<br><br>**A3. Bài viết đã tồn tại trong Collection**:<br>- API trả về thành công hoặc thông báo "Đã lưu trước đó". |
| **Yêu cầu trước khi thực hiện** | Đã đăng nhập. |
| **Yêu cầu sau khi thực hiện** | Cấu trúc Collection thay đổi. |

## 2. Biểu đồ

### 2.1. Activity Diagram (Tổng quát)
```plantuml
@startuml
|User|
start
:Chọn hành động Collection;
if (CRUD Collection) then (Create/Delete)
    :Nhập thông tin / Xác nhận;
    |System|
    :API POST|DELETE /collections;
    :Update Collections Table;
    :Return Success;
    stop
else (Save Post)
    :Chọn Post -> "Save to Collection";
    |System|
    :API POST /collections/{id}/posts/{post};
    :Check Owner;
    if (Is Owner?) then (Yes)
        :Insert PostCollection;
        :Return 200 OK;
    else (No)
        :Return 403 Forbidden;
    endif
    stop
endif
@enduml
```

### 2.2. Sequence Diagram (Tổng quát)
```plantuml
@startuml
autonumber
actor User
participant UI
participant API
participant Service
participant DB

alt Create Collection
    User -> UI: Input Name -> Create
    UI -> API: POST /collections
    API -> Service: CreateAsync()
    Service -> DB: Insert Row
    DB --> API: Success
else Add Post to Collection
    User -> UI: Select "Save to Collection"
    UI -> API: POST /collections/{id}/posts/{pId}
    API -> Service: AddPostAsync()
    Service -> DB: Check Ownership
    alt Valid
        Service -> DB: Insert PostCollection
        API --> UI: Success
    else Invalid
        API --> UI: Error 403
    end
end
@enduml
```
