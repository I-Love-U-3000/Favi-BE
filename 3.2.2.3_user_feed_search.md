# 3.2.2.3. UC-US-03: Xem Newsfeed & Tìm kiếm (View & Search)

## 1. Đặc tả Use Case

| Mục | Nội dung |
| :--- | :--- |
| **Mã UC** | UC-US-03 |
| **Tên UC** | Xem Newsfeed và Tìm kiếm (view & Search) |
| **Mô tả** | Người dùng xem nội dung bài viết (dạng Cột hoặc Lưới) và tìm kiếm bài viết theo ngữ nghĩa (Semantic Search). |
| **Tác nhân sử dụng** | User |
| **Sự kiện kích hoạt** | Vào trang chủ hoặc nhập từ khóa vào thanh tìm kiếm. |
| **Luồng sự kiện chính** | **1. Xem Newsfeed**<br>1. User truy cập trang chủ.<br>2. Hệ thống gọi `GET /api/posts/feed`.<br>3. `PostService` truy vấn bài viết từ người theo dõi (Followings) và thuật toán gợi ý.<br>4. Trả về danh sách `PostResponse` phân trang.<br>5. UI hiển thị theo chế độ đã chọn (Cột/Lưới).<br><br>**2. Tìm kiếm (Semantic Search)**<br>1. User nhập nội dung mô tả (VD: "bãi biển hoàng hôn") -> Nhấn Search.<br>2. Hệ thống gọi `GET /api/search/semantic`.<br>3. `SearchService` gọi Vector DB để tìm các ID bài viết tương đồng.<br>4. Server query chi tiết Post từ DB chính theo ID.<br>5. Trả về kết quả search. |
| **Luồng sự kiện phụ** | **A1. Không có kết quả (Search)**:<br>- Vector DB trả về rỗng -> API trả về danh sách rỗng (`[]`).<br>- UI hiển thị "No results found".<br><br>**A2. Lỗi Vector DB (Timeout)**:<br>- Service không gọi được Vector DB -> Ghi Log lỗi `ERR_VECTOR_SERVICE`.<br>- Fallback sang tìm kiếm Keyword (SQL LIKE).<br><br>**A3. Lỗi Mạng (Newsfeed)**:<br>- API trả về 500/Network Error -> UI hiển thị nút "Retry". |
| **Yêu cầu trước khi thực hiện** | User có thể cần đăng nhập (để xem Feed cá nhân), hoặc Guest (xem Public Feed). |
| **Yêu cầu sau khi thực hiện** | Hiển thị đúng nội dung theo quyền riêng tư. |
| **Yêu cầu phi chức năng** | Tìm kiếm trả về kết quả < 2s. |

## 2. Biểu đồ

### 2.1. Activity Diagram (Tổng quát)
```plantuml
@startuml
|User|
start
if (Hành động?) then (Xem Feed)
    :Open Home Page;
    |System|
    :API GET /api/posts/feed;
    :Get Followings & Recommendations;
    :Return List <Post>;
    |User|
    :Hiển thị (Grid/Column);
    stop
else (Tìm kiếm)
    :Nhập từ khóa;
    |System|
    :API GET /api/search/semantic;
    :Vector Embed(Query);
    :Search Vector DB;
    if (Matches Found?) then (Yes)
        :Get Details from SQL;
        :Return Results;
    else (No)
        :Return Empty;
    endif
    stop
endif
@enduml
```

### 2.2. Sequence Diagram (Tổng quát)
```plantuml
@startuml
autonumber
actor User
participant UI
participant "Backend API" as API
participant "Service" as Service
participant "VectorDB" as Vector

alt View Feed
    User -> UI: Open Home
    UI -> API: GET /posts/feed
    API -> Service: GetFeed()
    Service --> API: List Posts
    API --> UI: Display Feed
else Semantic Search
    User -> UI: Search "Query"
    UI -> API: GET /search/semantic
    API -> Service: SearchAsync()
    Service -> Vector: Query Vectors
    alt Has Results
        Vector --> Service: PostIDs
        Service -> Service: Get Details
        Service --> API: Result List
        API --> UI: Show Grid
    else Error/Empty
        Service --> API: Empty List
        API --> UI: "No Results"
    end
end
@enduml
```
