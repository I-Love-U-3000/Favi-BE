# 3.2.2.12. UC-US-12: Đăng xuất (Sign Out)

## 1. Đặc tả Use Case

| Mục | Nội dung |
| :--- | :--- |
| **Mã UC** | UC-US-12 |
| **Tên UC** | Đăng xuất (Sign Out) |
| **Mô tả** | Người dùng chấm dứt phiên làm việc hiện tại, xóa thông tin xác thực khỏi thiết bị để bảo mật tài khoản. |
| **Tác nhân sử dụng** | User |
| **Sự kiện kích hoạt** | Người dùng chọn "Logout" từ Menu cá nhân. |
| **Luồng sự kiện chính** | **1. Thực hiện Đăng xuất**<br>1. User nhấn "Sign Out".<br>2. Hệ thống gọi `POST /api/auth/logout` (Optional - để revoke refresh token phía server).<br>3. Client xóa Access Token, Refresh Token và User Info khỏi LocalStorage/Cookies.<br>4. Client chuyển hướng người dùng về trang Login hoặc Landing Page. |
| **Luồng sự kiện phụ** | **A1. Lỗi mạng (Network Error)**:<br>- API Logout fail.<br>- Client vẫn **BẮT BUỘC** xóa token cục bộ để đảm bảo user thoát khỏi giao diện.<br>- Chuyển hướng về Login như bình thường. |
| **Yêu cầu trước khi thực hiện** | Người dùng đang có phiên đăng nhập hợp lệ. |
| **Yêu cầu sau khi thực hiện** | Token bị vô hiệu hóa (nếu có cơ chế revoke) và bị xóa khỏi Client. |
| **Yêu cầu phi chức năng** | Thao tác phải diễn ra tức thì (< 1s). |

## 2. Biểu đồ

### 2.1. Activity Diagram (Tổng quát)
```plantuml
@startuml
!theme plain
|User|
start
:Click Sign Out;
|System|
:API POST /auth/logout (Revoke Token);
:Clear Browser Storage (Token, Info);
:Redirect to Login Page;
|User|
:Thấy màn hình Login;
stop
@enduml
```

### 2.2. Sequence Diagram (Tổng quát)
```plantuml
@startuml
!theme plain
autonumber
actor User
participant UI
participant "AuthController" as API
participant "SupabaseService" as Auth

User -> UI: Click Logout
UI -> API: POST /api/auth/logout
API -> Auth: RevokeToken(uid)
Auth --> API: Success
API --> UI: 200 OK

note right of UI
  Dù API thành công hay lỗi,
  Client vẫn xóa Token cục bộ
end note

UI -> UI: Clear LocalStorage
UI -> User: Redirect Login
@enduml
```
