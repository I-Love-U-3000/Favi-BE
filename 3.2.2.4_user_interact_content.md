# 3.2.2.4. UC-US-04: Tương tác nội dung (Interact with Content)

## 1. Đặc tả Use Case

| Mục | Nội dung |
| :--- | :--- |
| **Mã UC** | UC-US-04 |
| **Tên UC** | Tương tác nội dung (Like, Comment, Report) |
| **Mô tả** | Người dùng thực hiện thả tim, bình luận và báo cáo nội dung vi phạm. |
| **Tác nhân sử dụng** | User |
| **Sự kiện kích hoạt** | Người dùng thao tác trên thanh công cụ của bài viết/bình luận. |
| **Luồng sự kiện chính** | **1. Thả tim (React)**<br>1. User click Tim.<br>2. Hệ thống gọi `POST /api/posts/{id}/reactions`.<br>3. Server toggle trạng thái và update bộ đếm (Count).<br><br>**2. Bình luận & Trả lời (Comment/Reply)**<br>1. User nhập nội dung -> Gửi.<br>2. Hệ thống gọi `POST /api/comments` (kèm `parentId` nếu là Reply).<br>3. `CommentService` lưu DB -> `NotificationService` tạo thông báo.<br>4. Trả về 200 OK -> UI chèn comment mới vào list.<br><br>**3. Báo cáo (Report)**<br>1. User chọn Report -> Chọn lý do.<br>2. Hệ thống gọi `POST /api/reports`.<br>3. Server tạo Ticket trạng thái 'Pending' cho Admin. |
| **Luồng sự kiện phụ** | **A1. Nội dung gốc bị xóa (Deleted Content)**:<br>- Khi Reply/React một bài viết vừa bị xóa -> API trả về 404 Not Found.<br>- UI báo "Nội dung không còn tồn tại".<br><br>**A2. Spam (Rate Limit)**:<br>- User comment quá nhanh (>10 lần/phút) -> API trả về 429 Too Many Requests.<br>- UI báo "Bạn thao tác quá nhanh". |
| **Yêu cầu trước khi thực hiện** | Đã đăng nhập. |
| **Yêu cầu sau khi thực hiện** | Số lượng Reaction/Comment tăng lên; Thông báo được gửi đi. |
| **Yêu cầu phi chức năng** | Reaction phải phản hồi tức thì về mặt UI (Optimistic UI). |

## 2. Biểu đồ

### 2.1. Activity Diagram (Tổng quát)
```plantuml
@startuml
|User|
start
:Chọn hành động tương tác;
if (Thả Tim) then (React)
    :Click Icon Tim;
    |System|
    :API POST /reactions;
    :Toggle Like Status;
    :Return 200;
    stop
elseif (Bình luận) then (Comment/Reply)
    |User|
    :Nhập text -> Gửi;
    |System|
    :API POST /comments;
    :Check Content & Parent;
    if (Success?) then (Yes)
        :Save DB;
        :Notify Owner;
    else (No)
        :Return 400/404;
    endif
    stop
else (Báo cáo)
    |User|
    :Chọn Report -> Lý do;
    |System|
    :API POST /reports;
    :Create Ticket;
    :Return 201 Created;
    stop
endif
@enduml
```

### 2.2. Sequence Diagram (Tổng quát)
```plantuml
@startuml
autonumber
actor User
participant UI
participant API
participant Service
participant DB

User -> UI: Interact

alt React (Toggle Like)
    User -> UI: Click Heart
    UI -> API: POST /reactions
    API -> Service: ToggleReaction()
    Service -> DB: Update DB
    Service --> API: New State (Liked/Unliked)
    API --> UI: Update Icon
else Comment/Reply
    User -> UI: Send Text
    UI -> API: POST /comments
    API -> Service: CreateComment()
    Service -> DB: Check Parent Exists
    alt Parent Found
        Service -> DB: Insert Comment
        Service --> API: Comment DTO
        API --> UI: Show Comment
    else Not Found
        Service --> API: Error 404
        API --> UI: Show Error
    end
else Report
    User -> UI: Submit Report
    UI -> API: POST /reports
    API -> Service: SaveReport()
    Service -> DB: Insert Pending Report
    API --> UI: "Report Sent"
end
@enduml
```
