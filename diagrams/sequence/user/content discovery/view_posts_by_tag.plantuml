@startuml
!theme vibrant
title View Posts by Tag Sequence

actor User

box "Favi-BE Backend" #LightBlue
  participant "PostsController" as PostController
  participant "ITagService" as TagService
  participant "IPostService" as PostService
  participant "IPrivacyGuard" as PrivacyGuard
end box

User -> PostController: GET /api/posts/tag/{tagId}
activate PostController

PostController -> TagService: GetPostsByTagAsync(tagId, page, pageSize)
activate TagService
TagService --> PostController: PagedResult<PostResponse>
deactivate TagService

loop for each post in result
    PostController -> PostService: GetEntityAsync(post.Id)
    activate PostService
    PostService --> PostController: Post entity
    deactivate PostService

    PostController -> PrivacyGuard: CanViewPostAsync(entity, viewerId)
    activate PrivacyGuard
    PrivacyGuard --> PostController: bool canView
    deactivate PrivacyGuard
end

PostController --> User: 200 OK (Filtered Paged Posts)
deactivate PostController
@enduml
