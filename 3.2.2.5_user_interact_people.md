# 3.2.2.5. UC-US-05: Tương tác người dùng (Interact with People)

## 1. Đặc tả Use Case

| Mục | Nội dung |
| :--- | :--- |
| **Mã UC** | UC-US-05 |
| **Tên UC** | Tương tác người dùng (Connect & Block) |
| **Mô tả** | Người dùng theo dõi (Follow) để cập nhật hoạt động hoặc chặn (Block) để ngăn chặn tương tác. |
| **Tác nhân sử dụng** | User |
| **Sự kiện kích hoạt** | Trên trang Profile người khác hoặc từ menu ngữ cảnh. |
| **Luồng sự kiện chính** | **1. Theo dõi (Follow)**<br>1. User nhấn "Follow".<br>2. Hệ thống gọi `POST /api/profiles/follow/{id}`.<br>3. Server tạo quan hệ `Follows` -> User kia nhận thông báo.<br>4. Button chuyển thành "Following".<br><br>**2. Bỏ theo dõi (Unfollow)**<br>1. User nhấn "Unfollow".<br>2. Hệ thống gọi `DELETE /api/profiles/follow/{id}`.<br>3. Server xóa record trong `Follows`.<br><br>**3. Chặn (Block)**<br>1. User chọn "Block".<br>2. Hệ thống gọi `POST /api/profiles/block/{id}`.<br>3. Server thêm vào `UserBlocks` và xóa quan hệ Follows (nếu có).<br>4. Ẩn toàn bộ nội dung của người bị chặn. |
| **Luồng sự kiện phụ** | **A1. Chặn chính mình (Self Action)**:<br>- API trả về 400 Bad Request.<br>- UI báo lỗi "Không thể thực hiện với chính bạn".<br><br>**A2. Người dùng không tồn tại**:<br>- API trả về 404 Not Found.<br><br>**A3. Đã Follow rồi**:<br>- Gọi API Follow lặp lại -> Server trả về 200/409 tùy logic (Idempotent) nhưng không tạo record trùng. |
| **Yêu cầu trước khi thực hiện** | Đã đăng nhập. |
| **Yêu cầu sau khi thực hiện** | Mối quan hệ được cập nhật trong DB. |
| **Yêu cầu phi chức năng** | Không có. |

## 2. Biểu đồ

### 2.1. Activity Diagram (Tổng quát)
```plantuml
@startuml
|User|
start
:Vào Profile đối phương;
if (Chọn Action?) then (Follow)
    :Nhấn Follow;
    |System|
    :API POST /follow;
    :Insert Follow Record;
    :Notify User;
    :Return 200 OK;
    stop
elseif (Unfollow)
    :Nhấn Unfollow;
    |System|
    :API DELETE /follow;
    :Remove Record;
    :Return 200 OK;
    stop
else (Block)
    :Chọn Block;
    |System|
    :API POST /block;
    :Check Self-Block?;
    if (Self?) then (Yes)
        :Return 400;
    else (No)
        :Insert UserBlocks;
        :Delete Follows (if any);
        :Return 200 OK;
    endif
    stop
endif
@enduml
```

### 2.2. Sequence Diagram (Tổng quát)
```plantuml
@startuml
autonumber
actor User
participant UI
participant API
participant Service
participant DB

User -> UI: Interact with User B

alt Follow Flow
    User -> UI: Click Follow
    UI -> API: POST /follow/{id}
    API -> Service: FollowAsync()
    Service -> DB: Insert Follow
    Service -> DB: Create Notification
    DB --> Service: Success
    API --> UI: 200 OK
else Block Flow
    User -> UI: Click Block
    UI -> API: POST /block/{id}
    API -> Service: BlockAsync()
    Service -> DB: Check Self-Block
    alt Valid
        Service -> DB: Insert UserBlock
        Service -> DB: Remove Follow
        API --> UI: Success
        UI -> User: Hide Profile
    else Invalid (Self)
        API --> UI: Error 400
    end
end
@enduml
```
