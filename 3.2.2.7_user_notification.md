# 3.2.2.7. UC-US-07: Giám sát thông báo (Monitor Notification)

## 1. Đặc tả Use Case

| Mục | Nội dung |
| :--- | :--- |
| **Mã UC** | UC-US-07 |
| **Tên UC** | Giám sát thông báo (Monitor Notification) |
| **Mô tả** | User nhận thông báo realtime về các tương tác và xem lại lịch sử thông báo. |
| **Tác nhân sử dụng** | User |
| **Sự kiện kích hoạt** | Có tương tác liên quan (Like/Comment/Follow) hoặc User click chuông. |
| **Luồng sự kiện chính** | **1. Nhận thông báo (Realtime)**<br>1. Hệ thống (SignalR Hub) nhận sự kiện.<br>2. Push message tới Client qua WebSocket.<br>3. Client hiển thị Toast/Badge.<br><br>**2. Xem danh sách thông báo**<br>1. User click Chuông.<br>2. Hệ thống gọi `GET /api/notifications`.<br>3. Trả về danh sách.<br><br>**3. Đọc thông báo**<br>1. User click vào thông báo.<br>2. Hệ thống gọi `POST /api/notifications/{id}/read`.<br>3. Cập nhật `IsRead = true`.<br>4. Chuyển hướng user tới trang đích. |
| **Luồng sự kiện phụ** | **A1. Mất kết nối SignalR**:<br>- Client không nhận được Notify realtime -> Phải refresh trang để thấy (qua API GET).<br><br>**A2. Thông báo không tồn tại**:<br>- Click vào thông báo cũ đã bị xóa -> API trả về 404. |
| **Yêu cầu phi chức năng** | Thông báo realtime < 1s. |

## 2. Biểu đồ

### 2.1. Activity Diagram (Tổng quát)
```plantuml
@startuml
|Actor|
start
:Trigger Event (Like/Comment);
|System|
:Create Notification DB;
fork
    :SignalR Push to User;
    |User|
    :Show Realtime Badge;
fork again
    |System|
    :API List Notifications (Poll/View);
end fork
|User|
:Click Notification;
|System|
:Mark as Read (API POST /read);
:Redirect to Target;
stop
@enduml
```

### 2.2. Sequence Diagram (Tổng quát)
```plantuml
@startuml
autonumber
actor Actor
participant Backend
participant DB
participant SignalR
actor User

alt Realtime Push
    Actor -> Backend: Like Post
    Backend -> DB: Insert Notif
    Backend -> SignalR: Push(UserId)
    SignalR -> User: WebSocket Message
    User -> User: Show Red Dot
else View & Read
    User -> Backend: GET /notifications
    Backend --> User: List JSON
    User -> Backend: POST /read/{id}
    Backend -> DB: Update IsRead=true
    Backend --> User: Success
end
@enduml
```
