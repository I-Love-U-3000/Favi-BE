This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.gitignore
docker-compose.yml
Favi-BE/Favi-BE.API/appsettings.json
Favi-BE/Favi-BE.API/Common/ClaimsPrincipalExtensions.cs
Favi-BE/Favi-BE.API/Common/JwtOptions.cs
Favi-BE/Favi-BE.API/Controllers/AuthController.cs
Favi-BE/Favi-BE.API/Controllers/CollectionsController.cs
Favi-BE/Favi-BE.API/Controllers/CommentsController.cs
Favi-BE/Favi-BE.API/Controllers/PostController.cs
Favi-BE/Favi-BE.API/Controllers/ProfilesController.cs
Favi-BE/Favi-BE.API/Controllers/ProfileSyncController.cs
Favi-BE/Favi-BE.API/Controllers/ReportsController.cs
Favi-BE/Favi-BE.API/Controllers/SearchController.cs
Favi-BE/Favi-BE.API/Controllers/TagsController.cs
Favi-BE/Favi-BE.API/Data/AppDbContext.cs
Favi-BE/Favi-BE.API/Data/Repositories/CollectionRepository.cs
Favi-BE/Favi-BE.API/Data/Repositories/CommentRepository.cs
Favi-BE/Favi-BE.API/Data/Repositories/FollowRepository.cs
Favi-BE/Favi-BE.API/Data/Repositories/GenericRepository.cs
Favi-BE/Favi-BE.API/Data/Repositories/PostCollectionRepository.cs
Favi-BE/Favi-BE.API/Data/Repositories/PostMediaRepository.cs
Favi-BE/Favi-BE.API/Data/Repositories/PostRepository.cs
Favi-BE/Favi-BE.API/Data/Repositories/PostTagRepository.cs
Favi-BE/Favi-BE.API/Data/Repositories/ProfileRepository.cs
Favi-BE/Favi-BE.API/Data/Repositories/ReactionRepository.cs
Favi-BE/Favi-BE.API/Data/Repositories/ReportRepository.cs
Favi-BE/Favi-BE.API/Data/Repositories/SocialLinkRepository.cs
Favi-BE/Favi-BE.API/Data/Repositories/TagRepository.cs
Favi-BE/Favi-BE.API/Data/UnitOfWork.cs
Favi-BE/Favi-BE.API/Docs/00_overview.md
Favi-BE/Favi-BE.API/Docs/01_auth.md
Favi-BE/Favi-BE.API/Docs/02_user_profile.md
Favi-BE/Favi-BE.API/Docs/03_post.md
Favi-BE/Favi-BE.API/Docs/04_collection.md
Favi-BE/Favi-BE.API/Docs/05_interaction.md
Favi-BE/Favi-BE.API/Docs/06_search_recommendation.md
Favi-BE/Favi-BE.API/Docs/07_reporting_moderation.md
Favi-BE/Favi-BE.API/Docs/08_realtime.md
Favi-BE/Favi-BE.API/Docs/09_infrastructure.md
Favi-BE/Favi-BE.API/Docs/10_unit_of_work.md
Favi-BE/Favi-BE.API/Favi-BE.API.csproj
Favi-BE/Favi-BE.API/Favi-BE.API.http
Favi-BE/Favi-BE.API/Favi-BE.csproj
Favi-BE/Favi-BE.API/Interfaces/IUnitOfWork.cs
Favi-BE/Favi-BE.API/Interfaces/Repositories/ICollectionRepository.cs
Favi-BE/Favi-BE.API/Interfaces/Repositories/ICommentRepository.cs
Favi-BE/Favi-BE.API/Interfaces/Repositories/IFollowRepository.cs
Favi-BE/Favi-BE.API/Interfaces/Repositories/IGenericRepository.cs
Favi-BE/Favi-BE.API/Interfaces/Repositories/IPostCollectionRepository.cs
Favi-BE/Favi-BE.API/Interfaces/Repositories/IPostMediaRepository.cs
Favi-BE/Favi-BE.API/Interfaces/Repositories/IPostRepository.cs
Favi-BE/Favi-BE.API/Interfaces/Repositories/IPostTagRepository.cs
Favi-BE/Favi-BE.API/Interfaces/Repositories/IProfileRepository.cs
Favi-BE/Favi-BE.API/Interfaces/Repositories/IReactionRepository.cs
Favi-BE/Favi-BE.API/Interfaces/Repositories/IReportRepository.cs
Favi-BE/Favi-BE.API/Interfaces/Repositories/ISocialLinkRepository.cs
Favi-BE/Favi-BE.API/Interfaces/Repositories/ITagRepository.cs
Favi-BE/Favi-BE.API/Interfaces/Services/ICloudinaryService.cs
Favi-BE/Favi-BE.API/Interfaces/Services/ICollectionService.cs
Favi-BE/Favi-BE.API/Interfaces/Services/ICommentService.cs
Favi-BE/Favi-BE.API/Interfaces/Services/IPostService.cs
Favi-BE/Favi-BE.API/Interfaces/Services/IPrivacyGuard.cs
Favi-BE/Favi-BE.API/Interfaces/Services/IProfileService.cs
Favi-BE/Favi-BE.API/Interfaces/Services/IReportService.cs
Favi-BE/Favi-BE.API/Interfaces/Services/ISearchService.cs
Favi-BE/Favi-BE.API/Interfaces/Services/ISupabaseAuthService.cs
Favi-BE/Favi-BE.API/Interfaces/Services/ITagService.cs
Favi-BE/Favi-BE.API/Migrations/20250930070642_InitDB.cs
Favi-BE/Favi-BE.API/Migrations/20250930070642_InitDB.Designer.cs
Favi-BE/Favi-BE.API/Migrations/20251003162509_second-db-scaffold-action.cs
Favi-BE/Favi-BE.API/Migrations/20251003162509_second-db-scaffold-action.Designer.cs
Favi-BE/Favi-BE.API/Migrations/20251006031653_Add privacylevel and followprivacylevel for profile.cs
Favi-BE/Favi-BE.API/Migrations/20251006031653_Add privacylevel and followprivacylevel for profile.Designer.cs
Favi-BE/Favi-BE.API/Migrations/AppDbContextModelSnapshot.cs
Favi-BE/Favi-BE.API/Models/Dtos/AuthDtos.cs
Favi-BE/Favi-BE.API/Models/Dtos/CollectionDtos.cs
Favi-BE/Favi-BE.API/Models/Dtos/CommentDtos.cs
Favi-BE/Favi-BE.API/Models/Dtos/CommonDtos.cs
Favi-BE/Favi-BE.API/Models/Dtos/NotificationDtos.cs
Favi-BE/Favi-BE.API/Models/Dtos/PostDtos.cs
Favi-BE/Favi-BE.API/Models/Dtos/ProfileDtos.cs
Favi-BE/Favi-BE.API/Models/Dtos/ReportDtos.cs
Favi-BE/Favi-BE.API/Models/Dtos/SearchDtos.cs
Favi-BE/Favi-BE.API/Models/Dtos/SupabaseAuthDtos.cs
Favi-BE/Favi-BE.API/Models/Dtos/TagDtos.cs
Favi-BE/Favi-BE.API/Models/Entities/Collection.cs
Favi-BE/Favi-BE.API/Models/Entities/Comment.cs
Favi-BE/Favi-BE.API/Models/Entities/JoinTables/Follow.cs
Favi-BE/Favi-BE.API/Models/Entities/JoinTables/PostCollection.cs
Favi-BE/Favi-BE.API/Models/Entities/JoinTables/PostTag.cs
Favi-BE/Favi-BE.API/Models/Entities/JoinTables/Reaction.cs
Favi-BE/Favi-BE.API/Models/Entities/Post.cs
Favi-BE/Favi-BE.API/Models/Entities/PostMedia.cs
Favi-BE/Favi-BE.API/Models/Entities/Profile.cs
Favi-BE/Favi-BE.API/Models/Entities/Report.cs
Favi-BE/Favi-BE.API/Models/Entities/SocialLink.cs
Favi-BE/Favi-BE.API/Models/Entities/Tag.cs
Favi-BE/Favi-BE.API/Models/Enums/NotificationType.cs
Favi-BE/Favi-BE.API/Models/Enums/PrivacyLevel.cs
Favi-BE/Favi-BE.API/Models/Enums/ReactionType.cs
Favi-BE/Favi-BE.API/Models/Enums/ReportStatus.cs
Favi-BE/Favi-BE.API/Models/Enums/ReportTarget.cs
Favi-BE/Favi-BE.API/Models/Enums/SocialKind.cs
Favi-BE/Favi-BE.API/Models/Enums/UserRole.cs
Favi-BE/Favi-BE.API/Program.cs
Favi-BE/Favi-BE.API/Properties/launchSettings.json
Favi-BE/Favi-BE.API/Services/CloudinaryService.cs
Favi-BE/Favi-BE.API/Services/CollectionService.cs
Favi-BE/Favi-BE.API/Services/CommentService.cs
Favi-BE/Favi-BE.API/Services/JwtService.cs
Favi-BE/Favi-BE.API/Services/PostService.cs
Favi-BE/Favi-BE.API/Services/PrivacyGuard.cs
Favi-BE/Favi-BE.API/Services/ProfileService.cs
Favi-BE/Favi-BE.API/Services/ReportService.cs
Favi-BE/Favi-BE.API/Services/SearchService.cs
Favi-BE/Favi-BE.API/Services/SupabaseAuthService.cs
Favi-BE/Favi-BE.API/Services/TagService.cs
Favi-BE/Favi-BE.sln
Favi-BE/FaviBE.Dockerfile
LICENSE
postman/collections/44172356-8e6ecdc6-dac1-4b08-a3f5-bffd8df0375c.json
README.md
Vector-index-api/main.py
Vector-index-api/requirements.txt
Vector-index-api/seed.py
Vector-index-api/VectorIndexApi.Dockerfile
Vector-index-api/warmup.py
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="docker-compose.yml">
services:
  # ===== Favi Backend (.NET) =====
  favi-api:
    build:
      context: ./Favi-BE
      dockerfile: ./FaviBE.Dockerfile
    environment:
      ASPNETCORE_URLS: http://+:8080
      ConnectionStrings__Default: >
        Host=favi-postgres;Port=5432;Database=favi;
        Username=favi;Password=favi;Include Error Detail=true
      VectorIndex__BaseUrl: http://vector-index-api:8080
      VectorIndex__Enabled: "true"
    depends_on:
      - favi-postgres
    ports:
      - "5000:8080"                  # http://localhost:5000

  # ===== Postgres cho Favi =====
  favi-postgres:
    image: postgres:15
    environment:
      POSTGRES_DB: favi
      POSTGRES_USER: favi
      POSTGRES_PASSWORD: favi
    ports:
      - "5432:5432"
    volumes:
      - favi_pgdata:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U favi -d favi"]
      interval: 5s
      timeout: 3s
      retries: 20

  # ===== Vector Index Monolith (FastAPI + OpenCLIP) =====
  vector-index-api:
    build:
      context: ./Vector-index-api
      dockerfile: ./VectorIndexApi.Dockerfile   # <‚Äî d√πng ƒë√∫ng file b·∫°n n√™u
    environment:
      QDRANT_URL: http://qdrant:6333
      FRIENDS_URL: http://favi-api:8080         # <‚Äî g·ªçi tr·ª±c ti·∫øp Favi ƒë·ªÉ l·∫•y friends
      REDIS_URL: redis://redis:6379/0           # n·∫øu b·∫°n ƒë√£ th√™m Redis RL
      COLLECTION_NAME: posts_demo
      MODEL_NAME: ViT-B-32
      PRETRAINED: openai
      RL_SEARCH_PER_MIN: "60"
      RL_POST_PER_MIN: "200"
      RL_BULK_PER_MIN: "20"
      BULK_EMBED_BATCH: "64"
    depends_on:
      - qdrant
      - redis
      - favi-api
    ports:
      - "18080:8080"                # http://localhost:18080 (dev)

  # ===== Qdrant + Redis (cho vector) =====
  qdrant:
    image: qdrant/qdrant:latest
    ports:
      - "6333:6333"
    volumes:
      - qdrant_storage:/qdrant/storage

  redis:
    image: redis:7-alpine
    command: ["redis-server","--save","","--appendonly","no"]

volumes:
  favi_pgdata:
  qdrant_storage:
</file>

<file path="Favi-BE/Favi-BE.API/appsettings.json">
{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  },
  "AllowedHosts": "*",
  "ConnectionStrings": {
    "Default": "Host=localhost;Port=5433;Database=favidb;Username=admin;Password=admin123"
  },
  "Jwt": {
    "Issuer": "favi.local",
    "Audience": "favi.web",
    "Key": "uqw9n0eu129nucouno132n21nu39c012uci2903u129ncu293ue32oru32nu3294u290c4u3294cnu39rcuwsidcbjewoibruewiu2398rnuewcnyewiugfnyw8rny398rcu39tu349ony3o8tfyaewo8wayorway8ocrawycruwayruiawbyowuybcraeworcbyawurbhyawuifywao8ryworhyaewuorawurwy8",
    "AccessMinutes": 60,
    "RefreshDays": 7
  }
}
</file>

<file path="Favi-BE/Favi-BE.API/Common/ClaimsPrincipalExtensions.cs">
using System.Security.Claims;
using System.Text.Json;

namespace Favi_BE.Common
{
    public static class ClaimsPrincipalExtensions
    {
        public static Guid GetUserIdFromMetadata(this ClaimsPrincipal user)
        {
            // L·∫•y claim "user_metadata"
            var meta = user.FindFirstValue("user_metadata");
            if (string.IsNullOrWhiteSpace(meta))
                throw new UnauthorizedAccessException("Missing user_metadata claim.");

            try
            {
                using var doc = JsonDocument.Parse(meta);
                var root = doc.RootElement;
                var sub = root.GetProperty("sub").GetString();
                if (string.IsNullOrWhiteSpace(sub))
                    throw new UnauthorizedAccessException("Missing sub in user_metadata.");

                return Guid.Parse(sub);
            }
            catch (Exception ex)
            {
                throw new UnauthorizedAccessException($"Invalid user_metadata: {ex.Message}");
            }
        }
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Common/JwtOptions.cs">
namespace Favi_BE.Common
{
    public class JwtOptions
    {
        public string Issuer { get; set; } = default!;
        public string Audience { get; set; } = default!;
        public string Key { get; set; } = default!;
        public int AccessMinutes { get; set; } = 60;
        public int RefreshDays { get; set; } = 7;
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Controllers/AuthController.cs">
using Favi_BE.Interfaces.Services;
using Favi_BE.Models.Dtos;
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using System.Text.Json;

namespace Favi_BE.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class AuthController : ControllerBase
    {
        private readonly ISupabaseAuthService _supabase;

        public AuthController(ISupabaseAuthService supabase)
        {
            _supabase = supabase;
        }

        public record LoginDto(string Email, string Password);
        public record RegisterDto(string Email, string Password, string Username);

        // POST /api/auth/login
        [HttpPost("login")]
        public async Task<ActionResult<SupabaseAuthResponse>> Login(LoginDto dto)
        {
            var result = await _supabase.LoginAsync(dto.Email, dto.Password);
            if (result is null)
                return Unauthorized(new { code = "INVALID_CREDENTIALS", message = "Email ho·∫∑c m·∫≠t kh·∫©u kh√¥ng ƒë√∫ng." });
            return Ok(result);
        }

        [HttpPost("register")]
        public async Task<ActionResult<SupabaseAuthResponse>> Register(RegisterDto dto)
        {
            var result = await _supabase.RegisterAsync(dto.Email, dto.Password, dto.Username);
            if (result is null)
                return BadRequest(new { code = "REGISTRATION_FAILED", message = "Kh√¥ng th·ªÉ t·∫°o t√†i kho·∫£n. Vui l√≤ng th·ª≠ l·∫°i." });
            return Ok(result);
        }

        [HttpPost("refresh")]
        public async Task<ActionResult<SupabaseAuthResponse>> Refresh([FromBody] string refreshToken)
        {
            var result = await _supabase.RefreshAsync(refreshToken);
            if (result is null)
                return Unauthorized(new { code = "INVALID_REFRESH_TOKEN", message = "Refresh token kh√¥ng h·ª£p l·ªá ho·∫∑c ƒë√£ h·∫øt h·∫°n." });
            return Ok(result);
        }

    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Controllers/CollectionsController.cs">
using Favi_BE.Common;
using Favi_BE.Interfaces.Services;
using Favi_BE.Models.Dtos;
using Favi_BE.Services;
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;

namespace Favi_BE.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class CollectionsController : ControllerBase
    {
        private readonly ICollectionService _collections;
        private readonly IPrivacyGuard _privacy;
        public CollectionsController(ICollectionService collections, IPrivacyGuard privacyGuard) { _collections = collections; _privacy = privacyGuard; }

        [Authorize]
        [HttpPost]
        public async Task<ActionResult<CollectionResponse>> Create(CreateCollectionRequest dto)
        {
            var userId = User.GetUserIdFromMetadata();
            return Ok(await _collections.CreateAsync(userId, dto));
        }

        [Authorize]
        [HttpPut("{id}")]
        public async Task<ActionResult<CollectionResponse>> Update(Guid id, UpdateCollectionRequest dto)
        {
            var userId = User.GetUserIdFromMetadata();
            var updated = await _collections.UpdateAsync(id, userId, dto);
            return updated is null
                ? NotFound(new { code = "COLLECTION_NOT_FOUND_OR_FORBIDDEN", message = "Kh√¥ng t√¨m th·∫•y ho·∫∑c b·∫°n kh√¥ng c√≥ quy·ªÅn s·ª≠a b·ªô s∆∞u t·∫≠p n√†y." })
                : Ok(updated);
        }

        [HttpGet("{id}/posts")]
        public async Task<ActionResult<PagedResult<PostResponse>>> GetPosts(Guid id, int page = 1, int pageSize = 20)
        {
            var collection = await _collections.GetEntityByIdAsync(id);
            if (collection is null)
                return NotFound(new { code = "COLLECTION_NOT_FOUND", message = "B·ªô s∆∞u t·∫≠p kh√¥ng t·ªìn t·∫°i." });

            var viewerId = User.Identity?.IsAuthenticated == true ? User.GetUserIdFromMetadata() : (Guid?)null;
            if (!await _privacy.CanViewCollectionAsync(collection, viewerId))
                return StatusCode(403, new { code = "COLLECTION_FORBIDDEN", message = "B·∫°n kh√¥ng c√≥ quy·ªÅn xem b·ªô s∆∞u t·∫≠p n√†y." });

            return Ok(await _collections.GetPostsAsync(id, page, pageSize));
        }

        [Authorize]
        [HttpDelete("{id}")]
        public async Task<IActionResult> Delete(Guid id)
        {
            var userId = User.GetUserIdFromMetadata();
            var ok = await _collections.DeleteAsync(id, userId);
            return ok
                ? NoContent()
                : StatusCode(403, new { code = "NOT_OWNER", message = "Ch·ªâ ch·ªß s·ªü h·ªØu m·ªõi ƒë∆∞·ª£c xo√° b·ªô s∆∞u t·∫≠p." });
        }

        [HttpGet("owner/{ownerId}")]
        public async Task<ActionResult<PagedResult<CollectionResponse>>> GetByOwner(Guid ownerId, int page = 1, int pageSize = 20)
        {
            return Ok(await _collections.GetByOwnerAsync(ownerId, page, pageSize));
        }

        [HttpGet("{id}")]
        public async Task<ActionResult<CollectionResponse>> GetById(Guid id)
        {
            var collection = await _collections.GetEntityByIdAsync(id);
            if (collection is null)
                return NotFound(new { code = "COLLECTION_NOT_FOUND", message = "B·ªô s∆∞u t·∫≠p kh√¥ng t·ªìn t·∫°i." });

            var viewerId = User.Identity?.IsAuthenticated == true ? User.GetUserIdFromMetadata() : (Guid?)null;
            if (!await _privacy.CanViewCollectionAsync(collection, viewerId))
                return StatusCode(403, new { code = "COLLECTION_FORBIDDEN", message = "B·∫°n kh√¥ng c√≥ quy·ªÅn xem b·ªô s∆∞u t·∫≠p n√†y." });

            return Ok(await _collections.GetByIdAsync(id));
        }
        [Authorize]
        [HttpPost("{id}/posts/{postId}")]
        public async Task<IActionResult> AddPost(Guid id, Guid postId)
        {
            var userId = User.GetUserIdFromMetadata();
            var ok = await _collections.AddPostAsync(id, postId, userId);
            return ok
                ? Ok(new { message = "ƒê√£ th√™m b√†i vi·∫øt v√†o b·ªô s∆∞u t·∫≠p." })
                : StatusCode(403, new { code = "NOT_OWNER_OR_INVALID", message = "Kh√¥ng th·ªÉ th√™m: b·∫°n kh√¥ng s·ªü h·ªØu ho·∫∑c d·ªØ li·ªáu kh√¥ng h·ª£p l·ªá." });
        }

        [Authorize]
        [HttpDelete("{id}/posts/{postId}")]
        public async Task<IActionResult> RemovePost(Guid id, Guid postId)
        {
            var userId = User.GetUserIdFromMetadata();
            var ok = await _collections.RemovePostAsync(id, postId, userId);
            return ok
                ? NoContent()
                : StatusCode(403, new { code = "NOT_OWNER_OR_INVALID", message = "Kh√¥ng th·ªÉ xo√° kh·ªèi b·ªô s∆∞u t·∫≠p." });
        }
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Controllers/CommentsController.cs">
using Favi_BE.Common;
using Favi_BE.Interfaces.Services;
using Favi_BE.Models.Dtos;
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;

namespace Favi_BE.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class CommentsController : ControllerBase
    {
        private readonly ICommentService _comments;
        private readonly IPostService _posts;
        private readonly IPrivacyGuard _privacy;

        public CommentsController(ICommentService comments, IPostService posts, IPrivacyGuard privacy)
        {
            _comments = comments;
            _posts = posts;
            _privacy = privacy;
        }

        [Authorize]
        [HttpPost]
        public async Task<ActionResult<CommentResponse>> Create(CreateCommentRequest dto)
        {
            var userId = User.GetUserIdFromMetadata();
            return Ok(await _comments.CreateAsync(dto.PostId, userId, dto.Content, dto.ParentCommentId));
        }

        [Authorize]
        [HttpPut("{id}")]
        public async Task<IActionResult> Update(Guid id, UpdateCommentRequest dto)
        {
            var userId = User.GetUserIdFromMetadata();
            var result = await _comments.UpdateAsync(id, userId, dto.Content);
            return result is null
                ? NotFound(new { code = "COMMENT_NOT_FOUND_OR_FORBIDDEN", message = "Kh√¥ng t√¨m th·∫•y b√¨nh lu·∫≠n ho·∫∑c b·∫°n kh√¥ng c√≥ quy·ªÅn s·ª≠a." })
                : Ok(result);
        }
        [Authorize]
        [HttpDelete("{id}")]
        public async Task<IActionResult> Delete(Guid id)
        {
            var userId = User.GetUserIdFromMetadata();
            var ok = await _comments.DeleteAsync(id, userId);
            return ok
                ? Ok(new { message = "ƒê√£ xo√° b√¨nh lu·∫≠n." })
                : NotFound(new { code = "COMMENT_NOT_FOUND_OR_FORBIDDEN", message = "Kh√¥ng t√¨m th·∫•y b√¨nh lu·∫≠n ho·∫∑c b·∫°n kh√¥ng c√≥ quy·ªÅn xo√°." });
        }

        [HttpGet("post/{postId}")]
        public async Task<ActionResult<PagedResult<CommentResponse>>> GetByPost(Guid postId, int page = 1, int pageSize = 20)
        {
            var viewerId = User.Identity?.IsAuthenticated == true ? User.GetUserIdFromMetadata() : (Guid?)null;
            var post = await _posts.GetEntityAsync(postId);

            if (post == null)
                return NotFound(new { code = "POST_NOT_FOUND", message = "B√†i vi·∫øt kh√¥ng t·ªìn t·∫°i." });

            if (!await _privacy.CanViewPostAsync(post, viewerId))
                return StatusCode(403, new { code = "POST_FORBIDDEN", message = "B·∫°n kh√¥ng c√≥ quy·ªÅn xem b√¨nh lu·∫≠n c·ªßa b√†i vi·∫øt n√†y." });

            return Ok(await _comments.GetByPostAsync(postId, page, pageSize));
        }
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Controllers/PostController.cs">
using Favi_BE.Common;
using Favi_BE.Interfaces.Services;
using Favi_BE.Models.Dtos;
using Favi_BE.Models.Enums;
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;

namespace Favi_BE.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class PostsController : ControllerBase
    {
        private readonly IPostService _posts;
        private readonly ITagService _tags;
        private readonly IPrivacyGuard _privacy;
        private readonly IProfileService _profileService;
        public PostsController(IPostService posts, ITagService tags, IPrivacyGuard privacy, IProfileService profileService)
        {
            _posts = posts;
            _tags = tags;
            _privacy = privacy;
            _profileService = profileService;
        }

        // ======================
        // üîπ Helper
        // ======================
        private Guid? TryGetUserId()
        {
            if (User?.Identity?.IsAuthenticated != true) return null;
            try { return User.GetUserIdFromMetadata(); }
            catch { return null; }
        }

        // ======================
        // üîπ GET: Chi ti·∫øt post
        // ======================
        [HttpGet("{id:guid}")]
        public async Task<ActionResult<PostResponse>> GetById(Guid id)
        {
            var viewerId = TryGetUserId();
            var postEntity = await _posts.GetEntityAsync(id);
            if (postEntity == null)
                return NotFound(new { code = "POST_NOT_FOUND", message = "B√†i vi·∫øt kh√¥ng t·ªìn t·∫°i ho·∫∑c ƒë√£ b·ªã xo√°." }); // üëà r√µ r√†ng

            if (!await _privacy.CanViewPostAsync(postEntity, viewerId))
                return StatusCode(403, new { code = "POST_FORBIDDEN", message = "B·∫°n kh√¥ng c√≥ quy·ªÅn xem b√†i vi·∫øt n√†y." }); // üëà c√≥ body

            var post = await _posts.GetByIdAsync(id, viewerId);
            return Ok(post);
        }


        // ======================
        // üîπ GET: B√†i vi·∫øt theo Profile (Public wall)
        // ======================
        [HttpGet("profile/{profileId:guid}")]
        public async Task<ActionResult<PagedResult<PostResponse>>> GetByProfile(Guid profileId, [FromQuery] int page = 1, [FromQuery] int pageSize = 20)
        {
            var viewerId = TryGetUserId();
            var profile = await _profileService.GetEntityByIdAsync(profileId);
            if (profile == null)
                return NotFound(new { code = "PROFILE_NOT_FOUND", message = "H·ªì s∆° kh√¥ng t·ªìn t·∫°i." });

            if (!await _privacy.CanViewProfileAsync(profile, viewerId))
                return StatusCode(403, new { code = "PROFILE_FORBIDDEN", message = "B·∫°n kh√¥ng c√≥ quy·ªÅn xem b√†i vi·∫øt c·ªßa h·ªì s∆° n√†y." });

            var result = await _posts.GetByProfileAsync(profileId, viewerId, page, pageSize);
            var visiblePosts = new List<PostResponse>();
            foreach (var p in result.Items)
            {
                var entity = await _posts.GetEntityAsync(p.Id);
                if (entity == null) continue;
                if (await _privacy.CanViewPostAsync(entity, viewerId))
                    visiblePosts.Add(p);
            }
            return Ok(new PagedResult<PostResponse>(visiblePosts, page, pageSize, result.TotalCount));
        }

        // ======================
        // üîπ GET: Feed c√° nh√¢n (posts c·ªßa ng∆∞·ªùi d√πng + followings)
        // ======================
        [Authorize]
        [HttpGet("feed")]
        public async Task<ActionResult<PagedResult<PostResponse>>> GetPersonalFeed([FromQuery] int page = 1, [FromQuery] int pageSize = 20)
        {
            var userId = User.GetUserIdFromMetadata();
            var result = await _posts.GetFeedAsync(userId, page, pageSize);

            // ‚úÖ L·ªçc nh·ªØng post m√† ng∆∞·ªùi xem kh√¥ng ƒë∆∞·ª£c ph√©p xem (v√≠ d·ª• private)
            var visiblePosts = new List<PostResponse>();
            foreach (var p in result.Items)
            {
                var entity = await _posts.GetEntityAsync(p.Id);
                if (await _privacy.CanViewPostAsync(entity, userId))
                    visiblePosts.Add(p);
            }

            return Ok(new PagedResult<PostResponse>(visiblePosts, page, pageSize, result.TotalCount));
        }

        // ======================
        // üîπ GET: Explore (TODO - thu·∫≠t to√°n ƒë·ªÅ xu·∫•t)
        // ======================
        [Authorize]
        [HttpGet("explore")]
        public async Task<ActionResult<PagedResult<PostResponse>>> GetExplore([FromQuery] int page = 1, [FromQuery] int pageSize = 20)
        {
            // TODO: Thu·∫≠t to√°n explore (g·ª£i √Ω theo tag, ƒë·ªô t∆∞∆°ng t√°c, profile t∆∞∆°ng ƒë·ªìng, v.v.)
            return Ok(await _posts.GetExploreAsync(User.GetUserIdFromMetadata(), page, pageSize));
        }

        // ======================
        // üîπ GET: Latest posts (TODO - thu·∫≠t to√°n sort to√†n h·ªá th·ªëng)
        // ======================
        [HttpGet("latest")]
        public async Task<ActionResult<PagedResult<PostResponse>>> GetLatest([FromQuery] int page = 1, [FromQuery] int pageSize = 20)
        {
            // TODO: L·∫•y danh s√°ch b√†i m·ªõi nh·∫•t to√†n h·ªá th·ªëng
            return Ok(await _posts.GetLatestAsync(page, pageSize));
        }

        // ======================
        // üîπ GET: Post theo Tag (gom t·ª´ TagController)
        // ======================
        [HttpGet("tag/{tagId:guid}")]
        public async Task<ActionResult<PagedResult<PostResponse>>> GetByTag(Guid tagId, [FromQuery] int page = 1, [FromQuery] int pageSize = 20)
        {
            var viewerId = TryGetUserId();
            var result = await _tags.GetPostsByTagAsync(tagId, page, pageSize);

            // ‚úÖ L·ªçc quy·ªÅn xem
            var visiblePosts = new List<PostResponse>();
            foreach (var p in result.Items)
            {
                var entity = await _posts.GetEntityAsync(p.Id);
                if (await _privacy.CanViewPostAsync(entity, viewerId))
                    visiblePosts.Add(p);
            }

            return Ok(new PagedResult<PostResponse>(visiblePosts, page, pageSize, result.TotalCount));
        }

        // ======================
        // üîπ POST: T·∫°o post
        // ======================
        [Authorize]
        [HttpPost]
        public async Task<ActionResult<PostResponse>> Create(CreatePostRequest dto)
        {
            var authorId = User.GetUserIdFromMetadata();
            if (string.IsNullOrWhiteSpace(dto.Caption) && (dto.Tags == null || !dto.Tags.Any()))
                return BadRequest(new { code = "EMPTY_POST", message = "B√†i vi·∫øt tr·ªëng. C·∫ßn c√≥ caption ho·∫∑c √≠t nh·∫•t 1 tag." });

            var created = await _posts.CreateAsync(authorId, dto.Caption, dto.Tags);
            return CreatedAtAction(nameof(GetById), new { id = created.Id }, created);
        }

        // ======================
        // üîπ PUT: C·∫≠p nh·∫≠t caption
        // ======================
        [Authorize]
        [HttpPut("{id:guid}")]
        public async Task<IActionResult> Update(Guid id, UpdatePostRequest dto)
        {
            var requesterId = User.GetUserIdFromMetadata();
            var ok = await _posts.UpdateAsync(id, requesterId, dto.Caption);
            return ok
                ? Ok(new { message = "ƒê√£ c·∫≠p nh·∫≠t b√†i vi·∫øt." })
                : StatusCode(403, new { code = "POST_FORBIDDEN_OR_NOT_FOUND", message = "Kh√¥ng th·ªÉ ch·ªânh s·ª≠a b√†i vi·∫øt (kh√¥ng t·ªìn t·∫°i ho·∫∑c b·∫°n kh√¥ng ph·∫£i ch·ªß s·ªü h·ªØu)." });
        }

        // ======================
        // üîπ DELETE: Xo√° post (cascade t·ª± lo)
        // ======================
        [Authorize]
        [HttpDelete("{id:guid}")]
        public async Task<IActionResult> Delete(Guid id)
        {
            var requesterId = User.GetUserIdFromMetadata();
            var ok = await _posts.DeleteAsync(id, requesterId);
            return ok
                ? NoContent()
                : StatusCode(403, new { code = "POST_FORBIDDEN_OR_NOT_FOUND", message = "Kh√¥ng th·ªÉ xo√° b√†i vi·∫øt (kh√¥ng t·ªìn t·∫°i ho·∫∑c b·∫°n kh√¥ng ph·∫£i ch·ªß s·ªü h·ªØu)." });
        }

        // ======================
        // üîπ POST: Upload Media
        // ======================
        [Authorize]
        [HttpPost("{id:guid}/media")]
        public async Task<ActionResult<IEnumerable<PostMediaResponse>>> UploadMedia(Guid id, [FromForm] List<IFormFile> files)
        {
            if (files == null || files.Count == 0)
                return BadRequest(new { code = "NO_FILE", message = "Kh√¥ng c√≥ file n√†o ƒë∆∞·ª£c g·ª≠i." });

            var requesterId = User.GetUserIdFromMetadata();

            // V√¨ service tr·∫£ empty cho 'kh√¥ng ph·∫£i owner' ho·∫∑c 'kh√¥ng c√≥ post',
            // controller n√™n ph√¢n bi·ªát tr∆∞·ªõc ƒë·ªÉ tr·∫£ message r√µ r√†ng.
            var postEntity = await _posts.GetEntityAsync(id);
            if (postEntity is null)
                return NotFound(new { code = "POST_NOT_FOUND", message = "B√†i vi·∫øt kh√¥ng t·ªìn t·∫°i." });

            if (postEntity.ProfileId != requesterId)
                return StatusCode(403, new { code = "NOT_OWNER", message = "Ch·ªâ ch·ªß b√†i vi·∫øt m·ªõi ƒë∆∞·ª£c upload media." });

            var result = await _posts.UploadMediaAsync(id, files, requesterId);
            if (!result.Any())
                return BadRequest(new { code = "UPLOAD_FAILED", message = "Upload th·∫•t b·∫°i ho·∫∑c t·∫•t c·∫£ file b·ªã b·ªè qua." });

            return Ok(result);
        }


        // ======================
        // üîπ POST: Toggle Reaction
        // ======================
        [Authorize]
        [HttpPost("{id:guid}/reactions")]
        public async Task<ActionResult> ToggleReaction(Guid id, [FromQuery] string type)
        {
            var userId = User.GetUserIdFromMetadata();

            if (!Enum.TryParse<ReactionType>(type, true, out var reactionType))
                return BadRequest(new { code = "INVALID_REACTION_TYPE", message = $"Gi√° tr·ªã reaction '{type}' kh√¥ng h·ª£p l·ªá." });

            var postEntity = await _posts.GetEntityAsync(id);
            if (postEntity is null)
                return NotFound(new { code = "POST_NOT_FOUND", message = "B√†i vi·∫øt kh√¥ng t·ªìn t·∫°i." });

            var newState = await _posts.ToggleReactionAsync(id, userId, reactionType);

            // Service tr·∫£ null khi: 1) post kh√¥ng c√≥ (ƒë√£ check ·ªü tr√™n) ho·∫∑c 2) reaction b·ªã g·ª°
            if (newState is null)
                return Ok(new { removed = true, message = "Reaction ƒë√£ ƒë∆∞·ª£c g·ª°." });

            return Ok(new { type = newState.ToString(), message = "Reaction ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t." });
        }
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Controllers/ProfilesController.cs">
using Favi_BE.Common;
using Favi_BE.Interfaces.Services;
using Favi_BE.Models.Dtos;
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using System.Text.RegularExpressions;

namespace Favi_BE.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class ProfilesController : ControllerBase
    {
        private readonly IProfileService _profiles;
        private readonly IPrivacyGuard _privacy;

        public ProfilesController(IProfileService profiles, IPrivacyGuard privacy)
        { _profiles = profiles; _privacy = privacy; }

        // Ai c≈©ng xem ƒë∆∞·ª£c profile ng∆∞·ªùi kh√°c
        [HttpGet("{id}")]
        public async Task<ActionResult<ProfileResponse>> GetById(Guid id)
        {
            var profile = await _profiles.GetEntityByIdAsync(id);
            if (profile is null)
                return NotFound(new { code = "PROFILE_NOT_FOUND", message = "H·ªì s∆° kh√¥ng t·ªìn t·∫°i." });

            var viewerId = User.Identity?.IsAuthenticated == true ? User.GetUserIdFromMetadata() : (Guid?)null;
            if (!await _privacy.CanViewProfileAsync(profile, viewerId))
                return StatusCode(403, new { code = "PROFILE_FORBIDDEN", message = "B·∫°n kh√¥ng c√≥ quy·ªÅn xem h·ªì s∆° n√†y." });

            return Ok(await _profiles.GetByIdAsync(id));
        }


        // C·∫≠p nh·∫≠t profile ch√≠nh m√¨nh
        [Authorize]
        [HttpPut]
        public async Task<ActionResult<ProfileResponse>> Update(ProfileUpdateRequest dto)
        {
            var userId = User.GetUserIdFromMetadata();
            var updated = await _profiles.UpdateAsync(userId, dto);
            return updated is null
                ? NotFound(new { code = "PROFILE_NOT_FOUND", message = "Kh√¥ng t√¨m th·∫•y h·ªì s∆° ƒë·ªÉ c·∫≠p nh·∫≠t." })
                : Ok(updated);
        }

        // Follow ng∆∞·ªùi kh√°c
        [Authorize]
        [HttpPost("follow/{targetId}")]
        public async Task<IActionResult> Follow(Guid targetId)
        {
            var userId = User.GetUserIdFromMetadata();
            var profile = await _profiles.GetEntityByIdAsync(targetId);
            if (profile is null)
                return NotFound(new { code = "PROFILE_NOT_FOUND", message = "H·ªì s∆° m·ª•c ti√™u kh√¥ng t·ªìn t·∫°i." });

            if (!await _privacy.CanFollowAsync(profile, userId))
                return StatusCode(403, new { code = "FOLLOW_FORBIDDEN", message = "B·∫°n kh√¥ng th·ªÉ theo d√µi h·ªì s∆° n√†y." });

            var ok = await _profiles.FollowAsync(userId, targetId);
            return ok ? Ok(new { message = "ƒê√£ theo d√µi." }) : BadRequest(new { code = "FOLLOW_FAILED", message = "Theo d√µi th·∫•t b·∫°i." });
        }

        // Unfollow ng∆∞·ªùi kh√°c
        [Authorize]
        [HttpDelete("follow/{targetId}")]
        public async Task<IActionResult> Unfollow(Guid targetId)
        {
            var userId = User.GetUserIdFromMetadata();
            var ok = await _profiles.UnfollowAsync(userId, targetId);
            return ok ? Ok(new { message = "ƒê√£ b·ªè theo d√µi." }) : BadRequest(new { code = "UNFOLLOW_FAILED", message = "B·ªè theo d√µi th·∫•t b·∫°i." });
        }

        // Xem followers c·ªßa ng∆∞·ªùi kh√°c
        [HttpGet("{id}/followers")]
        public async Task<IActionResult> Followers(Guid id, [FromQuery] int? skip, [FromQuery] int? take)
        {
            var profile = await _profiles.GetEntityByIdAsync(id);
            if (profile is null)
                return NotFound(new { code = "PROFILE_NOT_FOUND", message = "H·ªì s∆° kh√¥ng t·ªìn t·∫°i." });

            var viewerId = User.Identity?.IsAuthenticated == true ? User.GetUserIdFromMetadata() : (Guid?)null;
            if (!await _privacy.CanViewFollowListAsync(profile, viewerId))
                return StatusCode(403, new { code = "FOLLOW_LIST_FORBIDDEN", message = "B·∫°n kh√¥ng c√≥ quy·ªÅn xem danh s√°ch ng∆∞·ªùi theo d√µi." });

            int s = skip ?? 0;
            int t = take ?? 1000;
            var result = await _profiles.GetFollowersAsync(id, s, t);
            return Ok(result);
        }

        // Xem followings c·ªßa ng∆∞·ªùi kh√°c
        [HttpGet("{id}/followings")]
        public async Task<IActionResult> Followings(Guid id, [FromQuery] int? skip, [FromQuery] int? take)
        {
            var profile = await _profiles.GetEntityByIdAsync(id);
            if (profile is null)
                return NotFound(new { code = "PROFILE_NOT_FOUND", message = "H·ªì s∆° kh√¥ng t·ªìn t·∫°i." });

            var viewerId = User.Identity?.IsAuthenticated == true ? User.GetUserIdFromMetadata() : (Guid?)null;
            if (!await _privacy.CanViewFollowListAsync(profile, viewerId))
                return StatusCode(403, new { code = "FOLLOW_LIST_FORBIDDEN", message = "B·∫°n kh√¥ng c√≥ quy·ªÅn xem danh s√°ch ƒëang theo d√µi." });

            int s = skip ?? 0;
            int t = take ?? 1000;
            var result = await _profiles.GetFollowingsAsync(id, s, t);
            return Ok(result);
        }

        [HttpGet("{id}/links")]
        public async Task<IActionResult> GetLinks(Guid id)
        {
            var links = await _profiles.GetSocialLinksAsync(id);
            return Ok(links);
        }

        // L·∫•y social links c·ªßa ch√≠nh m√¨nh
        [Authorize]
        [HttpGet("me/links")]
        public async Task<IActionResult> GetLinks()
        {
            var userId = User.GetUserIdFromMetadata();
            return Ok(await _profiles.GetSocialLinksAsync(userId));
        }

        // Th√™m social link cho ch√≠nh m√¨nh
        [Authorize]
        [HttpPost("links")]
        public async Task<IActionResult> AddLink(SocialLinkDto dto)
        {
            var userId = User.GetUserIdFromMetadata();
            return Ok(await _profiles.AddSocialLinkAsync(userId, dto));
        }

        // Xo√° social link c·ªßa ch√≠nh m√¨nh
        [Authorize]
        [HttpDelete("links/{linkId}")]
        public async Task<IActionResult> RemoveLink(Guid linkId)
        {
            var userId = User.GetUserIdFromMetadata();
            var ok = await _profiles.RemoveSocialLinkAsync(userId, linkId);
            return ok
                ? Ok(new { message = "ƒê√£ xo√° li√™n k·∫øt m·∫°ng x√£ h·ªôi." })
                : NotFound(new { code = "SOCIAL_LINK_NOT_FOUND", message = "Kh√¥ng t√¨m th·∫•y li√™n k·∫øt ƒë·ªÉ xo√°." });
        }

        // Xo√° t√†i kho·∫£n ch√≠nh m√¨nh
        [Authorize]
        [HttpDelete]
        public async Task<IActionResult> Delete()
        {
            var userId = User.GetUserIdFromMetadata();
            return await _profiles.DeleteAsync(userId)
                ? Ok(new { message = "ƒê√£ xo√° t√†i kho·∫£n." })
                : BadRequest(new { code = "DELETE_PROFILE_FAILED", message = "Kh√¥ng th·ªÉ xo√° t√†i kho·∫£n." });
        }

        [HttpGet("check-username")]
        [AllowAnonymous]
        public async Task<IActionResult> CheckUsername([FromQuery] string username)
        {
            var result=await _profiles.CheckValidUsername(Normalize(username));
            if (result) return Ok(new { message = "Username h·ª£p l·ªá v√† ch∆∞a ƒë∆∞·ª£c s·ª≠ d·ª•ng." });
            return BadRequest(new { code = "USERNAME_INVALID_OR_TAKEN", message = "Username ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng." });
        }

        private static string Normalize(string s)
        {
            s = s.Trim().ToLowerInvariant();
            s = Regex.Replace(s, @"[^a-z0-9_.]", "");
            return s;
        }
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Controllers/ProfileSyncController.cs">
using Favi_BE.Interfaces.Services;
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;

namespace Favi_BE.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class ProfilesSyncController : ControllerBase
    {
        private readonly IProfileService _profiles;

        public ProfilesSyncController(IProfileService profiles)
        {
            _profiles = profiles;
        }

        public record SupabaseUserCreatedDto(Guid user_id, string email, string? role, Dictionary<string, object>? raw_user_meta_data);

        [HttpPost("sync")]
        [AllowAnonymous]
        public async Task<IActionResult> SyncProfile([FromBody] SupabaseUserCreatedDto dto)
        {
            try
            {
                var existing = await _profiles.GetByIdAsync(dto.user_id);
                if (existing != null) return Ok(new { message = "Profile already exists" });

                var meta = dto.raw_user_meta_data ?? new Dictionary<string, object>();
                string username = meta.ContainsKey("username")
                    ? meta["username"]?.ToString() ?? dto.email.Split('@')[0]
                    : dto.email.Split('@')[0];

                string displayName = string.Empty;
                await _profiles.CreateProfileAsync(dto.user_id, username, displayName);

                return Ok(new { message = "Profile created successfully", username, displayName });
            }
            catch (Exception ex)
            {
                return BadRequest(new { code = "PROFILE_SYNC_FAILED", message = $"Sync failed: {ex.Message}" });
            }
        }


    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Controllers/ReportsController.cs">
using Favi_BE.Common;
using Favi_BE.Interfaces.Services;
using Favi_BE.Models.Dtos;
using Favi_BE.Models.Enums;
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;

namespace Favi_BE.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class ReportsController : ControllerBase
    {
        private readonly IReportService _reports;
        private readonly IPrivacyGuard _privacy;
        public ReportsController(
            IReportService reports ,
            IPrivacyGuard privacy
            )
        {
            _reports = reports;
            _privacy = privacy;
        }

        [Authorize]
        [HttpPost]
        public async Task<ActionResult<ReportResponse>> Create(CreateReportRequest dto)
        {
            var reporterId = User.GetUserIdFromMetadata();
            if (!await _privacy.CanReportAsync(dto.TargetType, dto.TargetId, reporterId))
                return StatusCode(403, new { code = "REPORT_FORBIDDEN", message = "B·∫°n kh√¥ng th·ªÉ b√°o c√°o n·ªôi dung n√†y." });

            var report = await _reports.CreateAsync(dto);
            return Ok(report);
        }

        [Authorize(Roles = "admin")]
        [HttpGet]
        public async Task<ActionResult<PagedResult<ReportResponse>>> GetAll(int page = 1, int pageSize = 20) =>
            Ok(await _reports.GetAllAsync(page, pageSize));

        [Authorize(Roles = "admin")]
        [HttpPut("{id}")]
        public async Task<IActionResult> UpdateStatus(Guid id, UpdateReportStatusRequest dto)
        {
            var ok = await _reports.UpdateStatusAsync(id, dto);
            return ok
                ? Ok(new { message = "ƒê√£ c·∫≠p nh·∫≠t tr·∫°ng th√°i b√°o c√°o." })
                : NotFound(new { code = "REPORT_NOT_FOUND", message = "Kh√¥ng t√¨m th·∫•y b√°o c√°o." });
        }

        [Authorize]
        [HttpGet("my")]
        public async Task<ActionResult<PagedResult<ReportResponse>>> GetMyReports(int page = 1, int pageSize = 20)
        {
            var userId = User.GetUserIdFromMetadata();
            return Ok(await _reports.GetReportsByReporterIdAsync(userId, page, pageSize));
        }

        // dung policy thay vi check role
        [Authorize]
        [HttpGet("target/{targetId}")]
        public async Task<ActionResult<PagedResult<ReportResponse>>> GetReportsByTarget(Guid targetId, int page = 1, int pageSize = 20)
        {
            var userId = User.GetUserIdFromMetadata();
            if (userId != targetId && !User.IsInRole("admin"))
                return StatusCode(403, new { code = "REPORT_LIST_FORBIDDEN", message = "B·∫°n kh√¥ng c√≥ quy·ªÅn xem b√°o c√°o cho m·ª•c ti√™u n√†y." });

            return Ok(await _reports.GetReportsByTargetIdAsync(targetId, page, pageSize));
        }

        [Authorize]
        [HttpGet("target-type")]
        public async Task<ActionResult<PagedResult<ReportResponse>>> GetReportsByTargetType([FromQuery] string targetType, int page = 1, int pageSize = 20)
        {
            if (!User.IsInRole("admin"))
                return StatusCode(403, new { code = "REPORT_LIST_FORBIDDEN", message = "Ch·ªâ admin m·ªõi ƒë∆∞·ª£c xem danh s√°ch b√°o c√°o theo lo·∫°i." });

            if (!Enum.TryParse<ReportTarget>(targetType, true, out var reportTarget))
                return BadRequest(new { code = "INVALID_REPORT_TARGET", message = $"Gi√° tr·ªã targetType '{targetType}' kh√¥ng h·ª£p l·ªá." });

            return Ok(await _reports.GetReportsByTargetTypeAsync(reportTarget, page, pageSize));
        }
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Controllers/SearchController.cs">
using Favi_BE.Interfaces.Services;
using Favi_BE.Models.Dtos;
using Microsoft.AspNetCore.Mvc;

namespace Favi_BE.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class SearchController : ControllerBase
    {
        private readonly ISearchService _search;
        public SearchController(ISearchService search) => _search = search;

        [HttpPost]
        public async Task<ActionResult<SearchResult>> Search(SearchRequest dto) =>
            Ok(await _search.SearchAsync(dto));
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Controllers/TagsController.cs">
using Favi_BE.Interfaces.Services;
using Favi_BE.Models.Dtos;
using Favi_BE.Models.Entities;
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;

namespace Favi_BE.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class TagsController : ControllerBase
    {
        private readonly ITagService _tags;
        public TagsController(ITagService tags) => _tags = tags;

        [HttpGet]
        public async Task<ActionResult<PagedResult<TagResponse>>> GetAllPaged(int page = 1, int pageSize = 20) =>
            Ok(await _tags.GetAllPagedAsync(page, pageSize));

        // Kh√¥ng th·ªÉ load h·∫øt 1 l·∫ßn v√¨ c√≥ th·ªÉ c√≥ r·∫•t nhi·ªÅu tag
        /*[HttpGet]
        public async Task<ActionResult<IEnumerable<TagResponse>>> GetAll() =>
            Ok(await _tags.GetAllAsync());*/

        [HttpGet("{id}")]
        public async Task<ActionResult<TagResponse>> GetById(Guid id)
        {
            var tag = await _tags.GetByIdAsync(id);
            return tag is null
                ? NotFound(new { code = "TAG_NOT_FOUND", message = "Tag kh√¥ng t·ªìn t·∫°i." })
                : Ok(tag);
        }


        // Kh√¥ng c·∫ßn thi·∫øt v√¨ tag s·∫Ω ƒë∆∞·ª£c t·∫°o t·ª± ƒë·ªông khi t·∫°o b√†i vi·∫øt, ngo√†i ra c√°c quan h·ªá nh∆∞ post- tag ƒëang ch∆∞a ƒë∆∞·ª£c t·∫°o
        /*[Authorize]
        [HttpPost]
        public async Task<ActionResult<TagResponse>> GetOrCreateTagsAsync([FromBody] IEnumerable<Tag> tags) =>
            Ok(await _tags.CreateAsync());*/

        [HttpGet("{id}/posts")]
        public async Task<ActionResult<PagedResult<PostResponse>>> GetPosts(Guid id, int page = 1, int pageSize = 20) =>
            Ok(await _tags.GetPostsByTagAsync(id, page, pageSize));
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Data/AppDbContext.cs">
using Favi_BE.Models.Entities;
using Favi_BE.Models.Entities.JoinTables;
using Microsoft.EntityFrameworkCore;

namespace Favi_BE.Data
{
    public class AppDbContext: DbContext
    {
        public AppDbContext(DbContextOptions<AppDbContext> options) : base(options) { }

        public DbSet<Profile> Profiles { get; set; }
        public DbSet<Post> Posts { get; set; }
        public DbSet<Comment> Comments { get; set; }
        public DbSet<Collection> Collections { get; set; }
        public DbSet<Tag> Tags { get; set; }
        public DbSet<Report> Reports { get; set; }
        public DbSet<PostMedia> PostMedias { get; set; }
        public DbSet<SocialLink> SocialLinks { get; set; }
        public DbSet<Follow> Follows { get; set; }
        public DbSet<PostCollection> PostCollections { get; set; }
        public DbSet<PostTag> PostTags { get; set; }
        public DbSet<Reaction> Reactions { get; set; }

        protected override void OnModelCreating(ModelBuilder modelBuilder)
        {
            base.OnModelCreating(modelBuilder);

            // ===== Composite keys =====
            modelBuilder.Entity<PostTag>().HasKey(pt => new { pt.PostId, pt.TagId });
            modelBuilder.Entity<PostCollection>().HasKey(pc => new { pc.PostId, pc.CollectionId });
            modelBuilder.Entity<Follow>().HasKey(f => new { f.FollowerId, f.FolloweeId });
            modelBuilder.Entity<Reaction>().HasKey(r => new { r.PostId, r.ProfileId });

            // ===== Post =====
            modelBuilder.Entity<Post>()
                .HasOne(p => p.Profile)
                .WithMany(pf => pf.Posts)
                .HasForeignKey(p => p.ProfileId)
                .OnDelete(DeleteBehavior.Cascade);

            // PostMedia (Post -> PostMedias)
            modelBuilder.Entity<PostMedia>()
                .HasOne(m => m.Post)
                .WithMany(p => p.PostMedias)
                .HasForeignKey(m => m.PostId)
                .OnDelete(DeleteBehavior.Cascade);

            // ===== Comment =====
            modelBuilder.Entity<Comment>()
                .HasOne(c => c.Post)
                .WithMany(p => p.Comments)
                .HasForeignKey(c => c.PostId)
                .OnDelete(DeleteBehavior.Cascade);

            modelBuilder.Entity<Comment>()
                .HasOne(c => c.Profile)
                .WithMany(pf => pf.Comments)
                .HasForeignKey(c => c.ProfileId)
                .OnDelete(DeleteBehavior.Cascade);

            // tr√°nh cascade v√≤ng khi xo√° cha -> con
            modelBuilder.Entity<Comment>()
                .HasOne(c => c.ParentComment)
                .WithMany(p => p.Replies)
                .HasForeignKey(c => c.ParentCommentId)
                .OnDelete(DeleteBehavior.NoAction);

            // ===== Collection =====
            modelBuilder.Entity<Collection>()
                .HasOne(c => c.Profile)
                .WithMany(pf => pf.Collections)
                .HasForeignKey(c => c.ProfileId)
                .OnDelete(DeleteBehavior.Cascade);

            // PostCollection
            modelBuilder.Entity<PostCollection>()
                .HasOne(pc => pc.Post)
                .WithMany(p => p.PostCollections)
                .HasForeignKey(pc => pc.PostId)
                .OnDelete(DeleteBehavior.Cascade);

            modelBuilder.Entity<PostCollection>()
                .HasOne(pc => pc.Collection)
                .WithMany(c => c.PostCollections)
                .HasForeignKey(pc => pc.CollectionId)
                .OnDelete(DeleteBehavior.Cascade);

            // ===== PostTag =====
            modelBuilder.Entity<PostTag>()
                .HasOne(pt => pt.Post)
                .WithMany(p => p.PostTags)
                .HasForeignKey(pt => pt.PostId)
                .OnDelete(DeleteBehavior.Cascade);

            modelBuilder.Entity<PostTag>()
                .HasOne(pt => pt.Tag)
                .WithMany(t => t.PostTags)
                .HasForeignKey(pt => pt.TagId)
                .OnDelete(DeleteBehavior.Cascade);

            // ===== Reaction =====
            modelBuilder.Entity<Reaction>()
                .HasOne(r => r.Post)
                .WithMany(p => p.Reactions)
                .HasForeignKey(r => r.PostId)
                .OnDelete(DeleteBehavior.Cascade);

            modelBuilder.Entity<Reaction>()
                .HasOne(r => r.Profile)
                .WithMany(pf => pf.Reactions)
                .HasForeignKey(r => r.ProfileId)
                .OnDelete(DeleteBehavior.Cascade);

            // ===== Follow (self-ref Profile) =====
            modelBuilder.Entity<Follow>()
                .HasOne(f => f.Follower)
                .WithMany()
                .HasForeignKey(f => f.FollowerId)
                .OnDelete(DeleteBehavior.Cascade);

            modelBuilder.Entity<Follow>()
                .HasOne(f => f.Followee)
                .WithMany()
                .HasForeignKey(f => f.FolloweeId)
                .OnDelete(DeleteBehavior.Cascade);

            // ===== SocialLink =====
            modelBuilder.Entity<SocialLink>()
                .HasOne(sl => sl.Profile)
                .WithMany(pf => pf.SocialLinks)
                .HasForeignKey(sl => sl.ProfileId)
                .OnDelete(DeleteBehavior.Cascade);

            // ===== Report =====
            modelBuilder.Entity<Report>()
                .HasOne(r => r.Reporter)
                .WithMany(pf => pf.Reports)
                .HasForeignKey(r => r.ReporterId)
                .OnDelete(DeleteBehavior.Cascade);
        }

    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Data/Repositories/CollectionRepository.cs">
using Favi_BE.Interfaces.Repositories;
using Favi_BE.Models.Entities;
using Microsoft.EntityFrameworkCore;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;

namespace Favi_BE.Data.Repositories
{
    public class CollectionRepository : GenericRepository<Collection>, ICollectionRepository
    {
        public CollectionRepository(AppDbContext context) : base(context)
        {
        }

        public async Task<IEnumerable<Collection>> GetCollectionsByProfileIdAsync(Guid profileId)
        {
            return await _dbSet
                .Where(c => c.ProfileId == profileId)
                .OrderByDescending(c => c.CreatedAt)
                .ToListAsync();
        }

        public async Task<Collection> GetCollectionWithPostsAsync(Guid collectionId)
        {
            return await _dbSet
                .Where(c => c.Id == collectionId)
                .Include(c => c.PostCollections)
                .ThenInclude(pc => pc.Post)
                .ThenInclude(p => p.PostMedias)
                .FirstOrDefaultAsync();
        }
        public async Task<(IEnumerable<Collection> Items, int Total)> GetAllByOwnerPagedAsync(Guid ownerId, int skip, int take)
        {
            var query = _dbSet
                .Where(c => c.ProfileId == ownerId)
                .Include(c => c.PostCollections)
                .OrderByDescending(c => c.CreatedAt);

            var total = await query.CountAsync();
            var items = await query.Skip(skip).Take(take).ToListAsync();
            return (items, total);
        }

    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Data/Repositories/CommentRepository.cs">
using Favi_BE.Interfaces.Repositories;
using Favi_BE.Models.Entities;
using Microsoft.EntityFrameworkCore;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;

namespace Favi_BE.Data.Repositories
{
    public class CommentRepository : GenericRepository<Comment>, ICommentRepository
    {
        public CommentRepository(AppDbContext context) : base(context)
        {
        }

        public async Task<IEnumerable<Comment>> GetCommentsByPostIdAsync(Guid postId)
        {
            return await _dbSet
                .Where(c => c.PostId == postId && c.ParentCommentId == null)
                .Include(c => c.Profile)
                .OrderByDescending(c => c.CreatedAt)
                .ToListAsync();
        }

        public async Task<IEnumerable<Comment>> GetRepliesAsync(Guid parentCommentId)
        {
            return await _dbSet
                .Where(c => c.ParentCommentId == parentCommentId)
                .Include(c => c.Profile)
                .OrderBy(c => c.CreatedAt)
                .ToListAsync();
        }
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Data/Repositories/FollowRepository.cs">
using Favi_BE.Interfaces.Repositories;
using Favi_BE.Models.Entities.JoinTables;
using Microsoft.EntityFrameworkCore;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;

namespace Favi_BE.Data.Repositories
{
    public class FollowRepository : GenericRepository<Follow>, IFollowRepository
    {
        public FollowRepository(AppDbContext context) : base(context)
        {
        }

        public async Task<bool> IsFollowingAsync(Guid followerId, Guid followedId)
        {
            return await _dbSet.AnyAsync(f => f.FollowerId == followerId && f.FolloweeId == followedId);
        }

        public async Task<IEnumerable<Follow>> GetFollowersAsync(Guid profileId, int skip, int take)
        {
            return await _dbSet
                .Where(f => f.FolloweeId == profileId)
                .Include(f => f.Follower)
                .OrderByDescending(f => f.CreatedAt)
                .Skip(skip)
                .Take(take)
                .ToListAsync();
        }

        public async Task<IEnumerable<Follow>> GetFollowingAsync(Guid profileId, int skip, int take)
        {
            return await _dbSet
                .Where(f => f.FollowerId == profileId)
                .Include(f => f.Followee)
                .OrderByDescending(f => f.CreatedAt)
                .Skip(skip)
                .Take(take)
                .ToListAsync();
        }

        public async Task<int> GetFollowersCountAsync(Guid profileId)
        {
            return await _dbSet.CountAsync(f => f.FolloweeId == profileId);
        }

        public async Task<int> GetFollowingCountAsync(Guid profileId)
        {
            return await _dbSet.CountAsync(f => f.FollowerId == profileId);
        }

        public async Task<Follow?> GetAsync(Guid followerId, Guid followeeId)
        {
            return await _dbSet.FirstOrDefaultAsync(f => f.FollowerId == followerId && f.FolloweeId == followeeId);
        }
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Data/Repositories/GenericRepository.cs">
using Favi_BE.Interfaces.Repositories;
using Microsoft.EntityFrameworkCore;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Linq.Expressions;
using System.Threading.Tasks;

namespace Favi_BE.Data.Repositories
{
    public class GenericRepository<T> : IGenericRepository<T> where T : class
    {
        protected readonly AppDbContext _context;
        protected readonly DbSet<T> _dbSet;

        public GenericRepository(AppDbContext context)
        {
            _context = context;
            _dbSet = context.Set<T>();
        }

        public virtual T GetById(Guid id)
        {
            return _dbSet.Find(id);
        }

        public virtual async Task<T> GetByIdAsync(Guid id)
        {
            return await _dbSet.FindAsync(id);
        }

        public virtual IEnumerable<T> GetAll()
        {
            return _dbSet.ToList();
        }

        public virtual async Task<IEnumerable<T>> GetAllAsync()
        {
            return await _dbSet.ToListAsync();
        }

        public virtual IEnumerable<T> Find(Expression<Func<T, bool>> predicate)
        {
            return _dbSet.Where(predicate).ToList();
        }

        public virtual async Task<IEnumerable<T>> FindAsync(Expression<Func<T, bool>> predicate)
        {
            return await _dbSet.Where(predicate).ToListAsync();
        }

        public virtual async Task<bool> ExistsAsync(Expression<Func<T, bool>> predicate)
        {
            return await _dbSet.AnyAsync(predicate);
        }

        public virtual void Add(T entity)
        {
            _dbSet.Add(entity);
        }

        public virtual void AddRange(IEnumerable<T> entities)
        {
            _dbSet.AddRange(entities);
        }

        public virtual async Task AddAsync(T entity)
        {
            await _dbSet.AddAsync(entity);
        }

        public virtual async Task AddRangeAsync(IEnumerable<T> entities)
        {
            await _dbSet.AddRangeAsync(entities);
        }

        public virtual void Update(T entity)
        {
            _dbSet.Attach(entity);
            _context.Entry(entity).State = EntityState.Modified;
        }

        public virtual void UpdateRange(IEnumerable<T> entities)
        {
            foreach (var entity in entities)
            {
                _dbSet.Attach(entity);
                _context.Entry(entity).State = EntityState.Modified;
            }
        }

        public virtual void Remove(T entity)
        {
            _dbSet.Remove(entity);
        }

        public virtual void RemoveRange(IEnumerable<T> entities)
        {
            _dbSet.RemoveRange(entities);
        }

        public virtual async Task<int> CountAsync()
        {
            return await _dbSet.CountAsync();
        }

        public virtual async Task<int> CountAsync(Expression<Func<T, bool>> predicate)
        {
            return await _dbSet.CountAsync(predicate);
        }
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Data/Repositories/PostCollectionRepository.cs">
using Favi_BE.Interfaces.Repositories;
using Favi_BE.Models.Entities.JoinTables;
using Microsoft.EntityFrameworkCore;
using System;
using System.Threading.Tasks;

namespace Favi_BE.Data.Repositories
{
    public class PostCollectionRepository : GenericRepository<PostCollection>, IPostCollectionRepository
    {
        public PostCollectionRepository(AppDbContext context) : base(context)
        {
        }

        public async Task<bool> ExistsInCollectionAsync(Guid postId, Guid collectionId)
        {
            return await _dbSet.AnyAsync(pc => pc.PostId == postId && pc.CollectionId == collectionId);
        }

        public async Task RemoveFromCollectionAsync(Guid postId, Guid collectionId)
        {
            var postCollection = await _dbSet.FirstOrDefaultAsync(
                pc => pc.PostId == postId && pc.CollectionId == collectionId);
                
            if (postCollection != null)
            {
                Remove(postCollection);
            }
        }
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Data/Repositories/PostMediaRepository.cs">
using Favi_BE.Interfaces.Repositories;
using Favi_BE.Models.Entities;
using Microsoft.EntityFrameworkCore;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;

namespace Favi_BE.Data.Repositories
{
    public class PostMediaRepository : GenericRepository<PostMedia>, IPostMediaRepository
    {
        public PostMediaRepository(AppDbContext context) : base(context)
        {
        }

        public async Task<IEnumerable<PostMedia>> GetByPostIdAsync(Guid postId)
        {
            return await _dbSet
                .Where(pm => pm.PostId == postId)
                .OrderBy(pm => pm.Position)
                .ToListAsync();
        }
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Data/Repositories/PostRepository.cs">
using Favi_BE.Interfaces.Repositories;
using Favi_BE.Models.Entities;
using Microsoft.EntityFrameworkCore;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;

namespace Favi_BE.Data.Repositories
{
    public class PostRepository : GenericRepository<Post>, IPostRepository
    {
        public PostRepository(AppDbContext context) : base(context)
        {
        }

        public async Task<IEnumerable<Post>> GetPostsByProfileIdAsync(Guid profileId, int skip, int take)
        {
            return await _dbSet
                .Where(p => p.ProfileId == profileId)
                .OrderByDescending(p => p.CreatedAt)
                .Skip(skip)
                .Take(take)
                .Include(p => p.Profile)
                .Include(p => p.PostMedias)
                .ToListAsync();
        }

        public async Task<IEnumerable<Post>> GetPostsWithMediaAsync(int skip, int take)
        {
            return await _dbSet
                .OrderByDescending(p => p.CreatedAt)
                .Skip(skip)
                .Take(take)
                .Include(p => p.Profile)
                .Include(p => p.PostMedias)
                .ToListAsync();
        }

        public async Task<Post?> GetPostWithDetailsAsync(Guid postId)
        {
            return await _dbSet
                .Where(p => p.Id == postId)
                .Include(p => p.Profile)
                .Include(p => p.PostMedias)
                .Include(p => p.Comments.Where(c => c.ParentCommentId == null))
                .ThenInclude(c => c.Profile)
                .Include(p => p.PostTags)
                .ThenInclude(pt => pt.Tag)
                .FirstOrDefaultAsync();
        }

        public async Task<IEnumerable<Post>> GetFeedByFollowingsAsync(Guid profileId, int skip, int take)
        {
            return await _dbSet
                .Where(p => _context.Follows.Any(f => f.FollowerId == profileId && f.FolloweeId == p.ProfileId))
                .OrderByDescending(p => p.CreatedAt)
                .Skip(skip)
                .Take(take)
                .Include(p => p.Profile)
                .Include(p => p.PostMedias)
                .ToListAsync();
        }

        public async Task<IEnumerable<Post>> GetPostsByTagIdAsync(Guid tagId, int skip, int take)
        {
            return await _dbSet
                .Where(p => p.PostTags.Any(pt => pt.TagId == tagId))
                .OrderByDescending(p => p.CreatedAt)
                .Skip(skip)
                .Take(take)
                .Include(p => p.Profile)
                .Include(p => p.PostMedias)
                .ToListAsync();
        }

        public async Task<IEnumerable<Post>> GetPostsByCollectionIdAsync(Guid collectionId, int skip, int take)
        {
            return await _dbSet
                .Where(p => p.PostCollections.Any(pc => pc.CollectionId == collectionId))
                .OrderByDescending(p => p.CreatedAt)
                .Skip(skip)
                .Take(take)
                .Include(p => p.Profile)
                .Include(p => p.PostMedias)
                .ToListAsync();
        }

        public async Task<IEnumerable<Post>> GetLatestPostsAsync(int skip, int take)
        {
            return await _dbSet
                .OrderByDescending(p => p.CreatedAt)
                .Skip(skip)
                .Take(take)
                .Include(p => p.Profile)
                .Include(p => p.PostMedias)
                .ToListAsync();
        }

        public async Task<Post?> GetPostWithAllAsync(Guid postId)
        {
            return await _dbSet
                .Where(p => p.Id == postId)
                .Include(p => p.Profile)
                .Include(p => p.PostMedias)
                .Include(p => p.PostTags).ThenInclude(pt => pt.Tag)
                .Include(p => p.Comments).ThenInclude(c => c.Profile)
                .Include(p => p.Reactions).ThenInclude(r => r.Profile)
                .FirstOrDefaultAsync();
        }
        public async Task<(IEnumerable<Post> Items, int Total)> GetFeedPagedAsync(Guid profileId, int skip, int take)
        {
            var query = _dbSet
                .Where(p => _context.Follows.Any(f => f.FollowerId == profileId && f.FolloweeId == p.ProfileId))
                .Include(p => p.Profile)
                .Include(p => p.PostMedias)
                .Include(p => p.PostTags).ThenInclude(pt => pt.Tag)
                .OrderByDescending(p => p.CreatedAt);

            var total = await query.CountAsync();
            var items = await query.Skip(skip).Take(take).ToListAsync();
            return (items, total);
        }

        public async Task<(IEnumerable<Post> Items, int Total)> GetPostsByTagPagedAsync(Guid tagId, int skip, int take)
        {
            var query = _dbSet
                .Where(p => p.PostTags.Any(pt => pt.TagId == tagId))
                .Include(p => p.Profile)
                .Include(p => p.PostMedias)
                .Include(p => p.PostTags)
                    .ThenInclude(pt => pt.Tag)
                // üëá Th√™m include Reaction (v√† Comment n·∫øu c·∫ßn)
                .Include(p => p.Reactions)
                .OrderByDescending(p => p.CreatedAt);

            var total = await query.CountAsync();
            var items = await query
                .Skip(skip)
                .Take(take)
                .ToListAsync();

            return (items, total);
        }


        public async Task<(IEnumerable<Post> Items, int Total)> GetPostsByCollectionPagedAsync(Guid collectionId, int skip, int take)
        {
            var query = _dbSet
                .Where(p => p.PostCollections.Any(pc => pc.CollectionId == collectionId))
                .Include(p => p.Profile)
                .Include(p => p.PostMedias)
                .Include(p => p.PostTags)
                    .ThenInclude(pt => pt.Tag)
                // üëá Th√™m Reactions ƒë·ªÉ service map ReactionSummaryDto ƒë·∫ßy ƒë·ªß
                .Include(p => p.Reactions)
                .OrderByDescending(p => p.CreatedAt);

            var total = await query.CountAsync();

            var items = await query
                .Skip(skip)
                .Take(take)
                .ToListAsync();

            return (items, total);
        }


    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Data/Repositories/PostTagRepository.cs">
using Favi_BE.Interfaces.Repositories;
using Favi_BE.Models.Entities.JoinTables;
using Microsoft.EntityFrameworkCore;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;

namespace Favi_BE.Data.Repositories
{
    public class PostTagRepository : GenericRepository<PostTag>, IPostTagRepository
    {
        public PostTagRepository(AppDbContext context) : base(context)
        {
        }

        public async Task<IEnumerable<PostTag>> GetByPostIdAsync(Guid postId)
        {
            return await _dbSet
                .Where(pt => pt.PostId == postId)
                .Include(pt => pt.Tag)
                .ToListAsync();
        }

        public async Task<IEnumerable<PostTag>> GetByTagIdAsync(Guid tagId)
        {
            return await _dbSet
                .Where(pt => pt.TagId == tagId)
                .Include(pt => pt.Post)
                .ToListAsync();
        }

        public async Task<bool> ExistsAsync(Guid postId, Guid tagId)
        {
            return await _dbSet.AnyAsync(pt => pt.PostId == postId && pt.TagId == tagId);
        }

        public async Task AddTagToPostAsync(Guid postId, Guid tagId)
        {
            if (!await ExistsAsync(postId, tagId))
            {
                await AddAsync(new PostTag
                {
                    PostId = postId,
                    TagId = tagId
                });
            }
        }

        public async Task RemoveTagFromPostAsync(Guid postId, Guid tagId)
        {
            var postTag = await _dbSet.FirstOrDefaultAsync(pt => pt.PostId == postId && pt.TagId == tagId);
            if (postTag != null)
            {
                Remove(postTag);
            }
        }

        public async Task<IEnumerable<Guid>> GetPostIdsByTagNameAsync(string tagName)
        {
            return await _context.PostTags
                .Where(pt => pt.Tag.Name.ToLower() == tagName.ToLower())
                .Select(pt => pt.PostId)
                .ToListAsync();
        }
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Data/Repositories/ProfileRepository.cs">
using Favi_BE.Interfaces.Repositories;
using Favi_BE.Models.Entities;
using Microsoft.EntityFrameworkCore;
using System;
using System.Collections.Generic;
using System.Threading.Tasks;

namespace Favi_BE.Data.Repositories
{
    public class ProfileRepository : GenericRepository<Profile>, IProfileRepository
    {
        public ProfileRepository(AppDbContext context) : base(context)
        {
        }

        public async Task<Profile> GetByUsernameAsync(string username)
        {
            return await _dbSet.FirstOrDefaultAsync(p => p.Username.ToLower() == username.ToLower());
        }

        public async Task<IEnumerable<Profile>> GetTopCreatorsAsync(int count)
        {
            // Get profiles with most followers
            return await _context.Profiles
                .OrderByDescending(p => _context.Follows.Count(f => f.FolloweeId == p.Id))
                .Take(count)
                .ToListAsync();
        }

        public async Task<bool> IsUsernameUniqueAsync(string username)
        {
            return !await _dbSet.AnyAsync(p => p.Username.ToLower() == username.ToLower());
        }
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Data/Repositories/ReactionRepository.cs">
using Favi_BE.Interfaces.Repositories;
using Favi_BE.Models.Entities;
using Favi_BE.Models.Entities.JoinTables;
using Microsoft.EntityFrameworkCore;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;

namespace Favi_BE.Data.Repositories
{
    public class ReactionRepository : GenericRepository<Reaction>, IReactionRepository
    {
        public ReactionRepository(AppDbContext context) : base(context)
        {
        }

        public async Task<IEnumerable<Reaction>> GetReactionsByPostIdAsync(Guid postId)
        {
            return await _dbSet
                .Where(r => r.PostId == postId)
                .Include(r => r.Profile)
                .ToListAsync();
        }

        public async Task<Reaction> GetProfileReactionOnPostAsync(Guid profileId, Guid postId)
        {
            return await _dbSet
                .FirstOrDefaultAsync(r => r.ProfileId == profileId && r.PostId == postId);
        }
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Data/Repositories/ReportRepository.cs">
using Favi_BE.Interfaces.Repositories;
using Favi_BE.Models.Entities;
using Favi_BE.Models.Enums;
using Microsoft.EntityFrameworkCore;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;

namespace Favi_BE.Data.Repositories
{
    public class ReportRepository : GenericRepository<Report>, IReportRepository
    {
        public ReportRepository(AppDbContext context) : base(context)
        {
        }

        public async Task<IEnumerable<Report>> GetPendingReportsAsync(int skip, int take)
        {
            return await _dbSet
                .Where(r => r.Status == Models.Enums.ReportStatus.Pending)
                .OrderBy(r => r.CreatedAt)
                .Skip(skip)
                .Take(take)
                .Include(r => r.Reporter)
                .ToListAsync();
        }

        public async Task<IEnumerable<Report>> GetReportsByTargetTypeAsync(ReportTarget targetType, int skip, int take)
        {
            return await _dbSet
                .Where(r => r.TargetType == targetType)
                .OrderByDescending(r => r.CreatedAt)
                .Skip(skip)
                .Take(take)
                .Include(r => r.Reporter)
                .ToListAsync();
        }
        public async Task<IEnumerable<Report>> GetReportsByTargetIdAsync(Guid targetId, int skip, int take)
        {
            return await _dbSet
                .Where(r => r.TargetId == targetId)
                .OrderByDescending(r => r.CreatedAt)
                .Skip(skip)
                .Take(take)
                .Include(r => r.Reporter)
                .ToListAsync();
        }
        public async Task<IEnumerable<Report>> GetReportsByReporterIdAsync(Guid reporterId, int skip, int take)
        {
            return await _dbSet
                .Where(r => r.ReporterId == reporterId)
                .OrderByDescending(r => r.CreatedAt)
                .Skip(skip)
                .Take(take)
                .Include(r => r.Reporter)
                .ToListAsync();
        }
        public async Task<(IEnumerable<Report> Items, int Total)> GetReportsByReporterIdPagedAsync(Guid reporterId, int skip, int take)
        {
            var query = _dbSet.Where(r => r.ReporterId == reporterId).OrderByDescending(r => r.CreatedAt);
            var total = await query.CountAsync();
            var items = await query.Skip(skip).Take(take).ToListAsync();
            return (items, total);
        }

        public async Task<(IEnumerable<Report> Items, int Total)> GetReportsByTargetTypePagedAsync(ReportTarget targetType, int skip, int take)
        {
            var query = _dbSet.Where(r => r.TargetType == targetType).OrderByDescending(r => r.CreatedAt);
            var total = await query.CountAsync();
            var items = await query.Skip(skip).Take(take).ToListAsync();
            return (items, total);
        }

        public async Task<(IEnumerable<Report> Items, int Total)> GetReportsByTargetIdPagedAsync(Guid targetId, int skip, int take)
        {
            var query = _dbSet.Where(r => r.TargetId == targetId).OrderByDescending(r => r.CreatedAt);
            var total = await query.CountAsync();
            var items = await query.Skip(skip).Take(take).ToListAsync();
            return (items, total);
        }

    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Data/Repositories/SocialLinkRepository.cs">
using Favi_BE.Interfaces.Repositories;
using Favi_BE.Models.Entities;
using Microsoft.EntityFrameworkCore;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;

namespace Favi_BE.Data.Repositories
{
    public class SocialLinkRepository : GenericRepository<SocialLink>, ISocialLinkRepository
    {
        public SocialLinkRepository(AppDbContext context) : base(context)
        {
        }

        public async Task<IEnumerable<SocialLink>> GetByProfileIdAsync(Guid profileId)
        {
            return await _dbSet
                .Where(sl => sl.ProfileId == profileId)
                .ToListAsync();
        }
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Data/Repositories/TagRepository.cs">
using Favi_BE.Interfaces.Repositories;
using Favi_BE.Models.Entities;
using Microsoft.EntityFrameworkCore;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;

namespace Favi_BE.Data.Repositories
{
    public class TagRepository : GenericRepository<Tag>, ITagRepository
    {
        public TagRepository(AppDbContext context) : base(context)
        {
        }

        public async Task<Tag> GetByNameAsync(string name)
        {
            return await _dbSet.FirstOrDefaultAsync(t => t.Name.ToLower() == name.ToLower());
        }

        public async Task<IEnumerable<Tag>> GetTagsByPostIdAsync(Guid postId)
        {
            return await _context.PostTags
                .Where(pt => pt.PostId == postId)
                .Select(pt => pt.Tag)
                .ToListAsync();
        }

        public async Task<IEnumerable<Tag>> GetOrCreateTagsAsync(IEnumerable<string> tagNames)
        {
            var result = new List<Tag>();
            
            foreach (var name in tagNames)
            {
                var normalizedName = name.Trim().ToLower();
                if (string.IsNullOrWhiteSpace(normalizedName))
                    continue;
                    
                var tag = await GetByNameAsync(normalizedName);
                
                if (tag == null)
                {
                    tag = new Tag { Id = Guid.NewGuid(), Name = normalizedName };
                    await AddAsync(tag);
                }
                
                result.Add(tag);
            }
            
            return result;
        }

        public async Task<(IEnumerable<Tag> Tags, int TotalCount)> GetAllPagedAsync(int skip, int take)
        {
            var totalCount = await _dbSet.CountAsync();
            var tags = await _dbSet
                .OrderBy(t => t.Name)
                .Skip(skip)
                .Take(take)
                .ToListAsync();
            return (tags, totalCount);
        }
        public async Task<IEnumerable<Tag>> GetTagsWithNoPostsAsync()
        {
            return await _context.Tags
                .Where(t => !t.PostTags.Any())
                .ToListAsync();
        }

    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Data/UnitOfWork.cs">
using Favi_BE.Data.Repositories;
using System;
using System.Threading.Tasks;
using Microsoft.EntityFrameworkCore.Storage;
using Favi_BE.Interfaces.Repositories;
using Favi_BE.Interfaces;

namespace Favi_BE.Data
{
    public class UnitOfWork : IUnitOfWork
    {
        private readonly AppDbContext _context;
        private IDbContextTransaction _transaction;
        private bool _disposed = false;

        public UnitOfWork(AppDbContext context)
        {
            _context = context;

            // Initialize repositories
            Profiles = new ProfileRepository(_context);
            Posts = new PostRepository(_context);
            PostMedia = new PostMediaRepository(_context);
            Collections = new CollectionRepository(_context);
            Comments = new CommentRepository(_context);
            Tags = new TagRepository(_context);
            Reports = new ReportRepository(_context);
            SocialLinks = new SocialLinkRepository(_context);

            // Join tables
            PostTags = new PostTagRepository(_context);
            PostCollections = new PostCollectionRepository(_context);
            Follows = new FollowRepository(_context);
            Reactions = new ReactionRepository(_context);
        }

        // Core entities
        public IProfileRepository Profiles { get; private set; }
        public IPostRepository Posts { get; private set; }
        public IPostMediaRepository PostMedia { get; private set; }
        public ICollectionRepository Collections { get; private set; }
        public ICommentRepository Comments { get; private set; }
        public ITagRepository Tags { get; private set; }
        public IReportRepository Reports { get; private set; }
        public ISocialLinkRepository SocialLinks { get; private set; }

        // Join tables
        public IPostTagRepository PostTags { get; private set; }
        public IPostCollectionRepository PostCollections { get; private set; }
        public IFollowRepository Follows { get; private set; }
        public IReactionRepository Reactions { get; private set; }

        public int Complete()
        {
            return _context.SaveChanges();
        }

        public async Task<int> CompleteAsync()
        {
            return await _context.SaveChangesAsync();
        }

        public async Task BeginTransactionAsync()
        {
            _transaction = await _context.Database.BeginTransactionAsync();
        }

        public async Task CommitTransactionAsync()
        {
            try
            {
                await _transaction.CommitAsync();
            }
            catch
            {
                await _transaction.RollbackAsync();
                throw;
            }
            finally
            {
                _transaction.Dispose();
                _transaction = null;
            }
        }

        public async Task RollbackTransactionAsync()
        {
            if (_transaction != null)
            {
                await _transaction.RollbackAsync();
                _transaction.Dispose();
                _transaction = null;
            }
        }

        protected virtual void Dispose(bool disposing)
        {
            if (!_disposed)
            {
                if (disposing)
                {
                    _transaction?.Dispose();
                    _context.Dispose();
                }
            }
            _disposed = true;
        }

        public void Dispose()
        {
            Dispose(true);
            GC.SuppressFinalize(this);
        }
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Docs/00_overview.md">
# Favi Backend Overview

## Ki·∫øn tr√∫c t·ªïng th·ªÉ
- Frontend: Next.js
- Backend: .NET 8 (C#, EF Core)
- Database: PostgreSQL (l∆∞u metadata)
- Auth & Realtime: Supabase
- Image Storage: Cloudinary

## Nguy√™n t·∫Øc thi·∫øt k·∫ø
- Notifications, Messages, Conversations: **kh√¥ng l∆∞u EF Core**, ch·ªâ realtime (Supabase Realtime).
- API tu√¢n th·ªß REST, chu·∫©n h√≥a response.
- √Åp d·ª•ng Clean Architecture.

## S∆° ƒë·ªì (kh√°i ni·ªám)
Frontend <-> Backend (.NET API) <-> PostgreSQL + Cloudinary + Supabase (Auth/Realtime)
</file>

<file path="Favi-BE/Favi-BE.API/Docs/01_auth.md">
# Module Auth

## Ch·ª©c nƒÉng
- ƒêƒÉng k√Ω / ƒêƒÉng nh·∫≠p b·∫±ng Supabase Auth
- X√°c th·ª±c token trong .NET
- Qu·∫£n l√Ω profile m·ªü r·ªông

## API
- POST `/api/auth/login`
- POST `/api/auth/register`
- POST `/api/auth/refresh`

## Entity
- Profile (l∆∞u th√¥ng tin m·ªü r·ªông ngo√†i Auth)
</file>

<file path="Favi-BE/Favi-BE.API/Docs/02_user_profile.md">
# Module User Profile

## Entities
- Profile
- SocialLink
- Follow

## Ch·ª©c nƒÉng
- CRUD h·ªì s∆° ng∆∞·ªùi d√πng
- Qu·∫£n l√Ω social link
- Follow/Unfollow
</file>

<file path="Favi-BE/Favi-BE.API/Docs/03_post.md">
# Module Post

## Entities
- Post
- PostMedia
- PostTag

## L∆∞u tr·ªØ ·∫£nh
- Upload qua Cloudinary API
- L∆∞u metadata (url, size, format) trong DB

## Ch·ª©c nƒÉng
- T·∫°o/s·ª≠a/xo√° post
- Upload nhi·ªÅu ·∫£nh
- G·∫Øn tag
</file>

<file path="Favi-BE/Favi-BE.API/Docs/04_collection.md">
# Module Collection

## Entities
- Collection
- PostCollection

## Ch·ª©c nƒÉng
- T·∫°o Collection theo ch·ªß ƒë·ªÅ
- Th√™m/b·ªè ·∫£nh v√†o Collection
- L∆∞u post t·ª´ ng∆∞·ªùi kh√°c
</file>

<file path="Favi-BE/Favi-BE.API/Docs/05_interaction.md">
# Module Interaction

## Entities
- Reaction
- Comment
- Follow

## Ch·ª©c nƒÉng
- Like/Reaction
- Comment CRUD
- Follow/Unfollow
</file>

<file path="Favi-BE/Favi-BE.API/Docs/06_search_recommendation.md">
# Module Search & Recommendation

## Ch·ª©c nƒÉng
- Search theo t·ª´ kh√≥a, tag, m√†u s·∫Øc
- G·ª£i √Ω ·∫£nh d√πng Vector DB + metadata

## API
- GET `/api/search`
- GET `/api/recommendations`
</file>

<file path="Favi-BE/Favi-BE.API/Docs/07_reporting_moderation.md">
# Module Reporting & Moderation

## Entities
- Report

## Ch·ª©c nƒÉng
- Ng∆∞·ªùi d√πng report post/comment
- Admin x·ª≠ l√Ω (·∫©n, xo√°)
</file>

<file path="Favi-BE/Favi-BE.API/Docs/08_realtime.md">
# Module Realtime

## C√¥ng ngh·ªá
- Supabase Realtime Channel

## Ch·ª©c nƒÉng
- Chat/Message (Realtime)
- Notifications (Like, Comment, Follow, System)

## L∆∞u √Ω
- Kh√¥ng ƒë∆∞a v√†o EF Core
</file>

<file path="Favi-BE/Favi-BE.API/Docs/09_infrastructure.md">
# Module Infrastructure

## Th√†nh ph·∫ßn
- EF Core + PostgreSQL
- Cloudinary (upload, resize)
- Supabase (Auth + Realtime)
- Logging (Serilog)
- Security (JWT, HTTPS)

## File c·∫•u h√¨nh
- appsettings.json
</file>

<file path="Favi-BE/Favi-BE.API/Docs/10_unit_of_work.md">
# Unit of Work Pattern

## Interface
- IUnitOfWork.cs

## Repository
- UserRepository
- PostRepository
- CollectionRepository
- ...

## Ch·ª©c nƒÉng
- Gom thao t√°c DB
- ƒê·∫£m b·∫£o transaction
</file>

<file path="Favi-BE/Favi-BE.API/Favi-BE.API.csproj">
<Project Sdk="Microsoft.NET.Sdk.Web">

  <PropertyGroup>
    <TargetFramework>net9.0</TargetFramework>
    <Nullable>enable</Nullable>
    <ImplicitUsings>enable</ImplicitUsings>
    <RootNamespace>Favi_BE.API</RootNamespace>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="CloudinaryDotNet" Version="1.27.7" />
    <PackageReference Include="jose-jwt" Version="5.2.0" />
    <PackageReference Include="JWT" Version="11.0.0" />
    <PackageReference Include="Microsoft.AspNetCore.Authentication.JwtBearer" Version="9.0.9" />
    <PackageReference Include="Microsoft.AspNetCore.OpenApi" Version="9.0.9" />
    <PackageReference Include="Microsoft.EntityFrameworkCore.Tools" Version="9.0.9">
      <PrivateAssets>all</PrivateAssets>
      <IncludeAssets>runtime; build; native; contentfiles; analyzers; buildtransitive</IncludeAssets>
    </PackageReference>
    <PackageReference Include="Microsoft.IdentityModel.Tokens" Version="8.14.0" />
    <PackageReference Include="Scalar.AspNetCore" Version="2.8.8" />
    <PackageReference Include="System.IdentityModel.Tokens.Jwt" Version="8.14.0" />
	  <PackageReference Include="Microsoft.EntityFrameworkCore" Version="9.0.9" />

	  <PackageReference Include="Microsoft.EntityFrameworkCore.Design" Version="9.0.9">
		  <PrivateAssets>all</PrivateAssets>
	  </PackageReference>

	  <PackageReference Include="Npgsql.EntityFrameworkCore.PostgreSQL" Version="9.0.4" />

	  <PackageReference Include="Microsoft.Extensions.Logging.Console" Version="9.0.9" />
  </ItemGroup>

  <ItemGroup>
    <Folder Include="Docs\" />
  </ItemGroup>

</Project>
</file>

<file path="Favi-BE/Favi-BE.API/Favi-BE.API.http">
@Favi_BE_HostAddress = http://localhost:5104

GET {{Favi_BE_HostAddress}}/weatherforecast/
Accept: application/json

###
</file>

<file path="Favi-BE/Favi-BE.API/Favi-BE.csproj">
<Project Sdk="Microsoft.NET.Sdk.Web">

  <PropertyGroup>
    <TargetFramework>net9.0</TargetFramework>
    <Nullable>enable</Nullable>
    <ImplicitUsings>enable</ImplicitUsings>
    <RootNamespace>Favi_BE</RootNamespace>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="jose-jwt" Version="5.2.0" />
    <PackageReference Include="JWT" Version="11.0.0" />
    <PackageReference Include="Microsoft.AspNetCore.Authentication.JwtBearer" Version="9.0.9" />
    <PackageReference Include="Microsoft.AspNetCore.OpenApi" Version="9.0.9" />
    <PackageReference Include="Microsoft.IdentityModel.Tokens" Version="8.14.0" />
    <PackageReference Include="System.IdentityModel.Tokens.Jwt" Version="8.14.0" />
  </ItemGroup>

</Project>
</file>

<file path="Favi-BE/Favi-BE.API/Interfaces/IUnitOfWork.cs">
using Favi_BE.Interfaces.Repositories;
using System;
using System.Threading.Tasks;

namespace Favi_BE.Interfaces
{
    public interface IUnitOfWork : IDisposable
    {
        // Core entities
        IProfileRepository Profiles { get; }
        IPostRepository Posts { get; }
        IPostMediaRepository PostMedia { get; }
        ICollectionRepository Collections { get; }
        ICommentRepository Comments { get; }
        ITagRepository Tags { get; }
        IReportRepository Reports { get; }
        ISocialLinkRepository SocialLinks { get; }

        // Join tables and relationships
        IPostTagRepository PostTags { get; }
        IPostCollectionRepository PostCollections { get; }
        IFollowRepository Follows { get; }
        IReactionRepository Reactions { get; }

        // Transaction management
        int Complete();
        Task<int> CompleteAsync();

        // Transaction control
        Task BeginTransactionAsync();
        Task CommitTransactionAsync();
        Task RollbackTransactionAsync();
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Interfaces/Repositories/ICollectionRepository.cs">
using Favi_BE.Models.Entities;
using System;
using System.Collections.Generic;
using System.Threading.Tasks;

namespace Favi_BE.Interfaces.Repositories
{
    public interface ICollectionRepository : IGenericRepository<Collection>
    {
        Task<IEnumerable<Collection>> GetCollectionsByProfileIdAsync(Guid profileId);
        Task<Collection> GetCollectionWithPostsAsync(Guid collectionId);
        Task<(IEnumerable<Collection> Items, int Total)> GetAllByOwnerPagedAsync(Guid ownerId, int skip, int take);
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Interfaces/Repositories/ICommentRepository.cs">
using Favi_BE.Models.Entities;
using System;
using System.Collections.Generic;
using System.Threading.Tasks;

namespace Favi_BE.Interfaces.Repositories
{
    public interface ICommentRepository : IGenericRepository<Comment>
    {
        Task<IEnumerable<Comment>> GetCommentsByPostIdAsync(Guid postId);
        Task<IEnumerable<Comment>> GetRepliesAsync(Guid parentCommentId);
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Interfaces/Repositories/IFollowRepository.cs">
using Favi_BE.Models.Entities.JoinTables;
using System;
using System.Collections.Generic;
using System.Threading.Tasks;

namespace Favi_BE.Interfaces.Repositories
{
    public interface IFollowRepository : IGenericRepository<Follow>
    {
        Task<bool> IsFollowingAsync(Guid followerId, Guid followedId);
        Task<IEnumerable<Follow>> GetFollowersAsync(Guid profileId, int skip, int take);
        Task<IEnumerable<Follow>> GetFollowingAsync(Guid profileId, int skip, int take);
        Task<int> GetFollowersCountAsync(Guid profileId);
        Task<int> GetFollowingCountAsync(Guid profileId);
        Task<Follow?> GetAsync(Guid followerId, Guid followeeId);
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Interfaces/Repositories/IGenericRepository.cs">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Linq.Expressions;
using System.Threading.Tasks;

namespace Favi_BE.Interfaces.Repositories
{
    public interface IGenericRepository<T> where T : class
    {
        // Read operations
        T GetById(Guid id);
        Task<T> GetByIdAsync(Guid id);
        IEnumerable<T> GetAll();
        Task<IEnumerable<T>> GetAllAsync();
        IEnumerable<T> Find(Expression<Func<T, bool>> predicate);
        Task<IEnumerable<T>> FindAsync(Expression<Func<T, bool>> predicate);
        Task<bool> ExistsAsync(Expression<Func<T, bool>> predicate);

        // Create operations
        void Add(T entity);
        void AddRange(IEnumerable<T> entities);
        Task AddAsync(T entity);
        Task AddRangeAsync(IEnumerable<T> entities);

        // Update operations
        void Update(T entity);
        void UpdateRange(IEnumerable<T> entities);

        // Delete operations
        void Remove(T entity);
        void RemoveRange(IEnumerable<T> entities);

        // Count operations
        Task<int> CountAsync();
        Task<int> CountAsync(Expression<Func<T, bool>> predicate);
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Interfaces/Repositories/IPostCollectionRepository.cs">
using Favi_BE.Models.Entities.JoinTables;
using System;
using System.Threading.Tasks;

namespace Favi_BE.Interfaces.Repositories
{
    public interface IPostCollectionRepository : IGenericRepository<PostCollection>
    {
        Task<bool> ExistsInCollectionAsync(Guid postId, Guid collectionId);
        Task RemoveFromCollectionAsync(Guid postId, Guid collectionId);
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Interfaces/Repositories/IPostMediaRepository.cs">
using Favi_BE.Models.Entities;
using System;
using System.Collections.Generic;
using System.Threading.Tasks;

namespace Favi_BE.Interfaces.Repositories
{
    public interface IPostMediaRepository : IGenericRepository<PostMedia>
    {
        Task<IEnumerable<PostMedia>> GetByPostIdAsync(Guid postId);
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Interfaces/Repositories/IPostRepository.cs">
using Favi_BE.Models.Entities;
using System;
using System.Collections.Generic;
using System.Threading.Tasks;

namespace Favi_BE.Interfaces.Repositories
{
    public interface IPostRepository : IGenericRepository<Post>
    {
        Task<IEnumerable<Post>> GetPostsByProfileIdAsync(Guid profileId, int skip, int take);
        Task<IEnumerable<Post>> GetPostsWithMediaAsync(int skip, int take);
        Task<Post?> GetPostWithDetailsAsync(Guid postId);

        Task<Post?> GetPostWithAllAsync(Guid postId);

        Task<IEnumerable<Post>> GetFeedByFollowingsAsync(Guid profileId, int skip, int take);
        // L·∫•y posts theo tag
        Task<IEnumerable<Post>> GetPostsByTagIdAsync(Guid tagId, int skip, int take);

        // L·∫•y posts trong 1 collection
        Task<IEnumerable<Post>> GetPostsByCollectionIdAsync(Guid collectionId, int skip, int take);

        // L·∫•y newest posts (Explore)
        Task<IEnumerable<Post>> GetLatestPostsAsync(int skip, int take);
        Task<(IEnumerable<Post> Items, int Total)> GetFeedPagedAsync(Guid profileId, int skip, int take);
        Task<(IEnumerable<Post> Items, int Total)> GetPostsByTagPagedAsync(Guid tagId, int skip, int take);
        Task<(IEnumerable<Post> Items, int Total)> GetPostsByCollectionPagedAsync(Guid collectionId, int skip, int take);
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Interfaces/Repositories/IPostTagRepository.cs">
using Favi_BE.Models.Entities.JoinTables;
using System;
using System.Collections.Generic;
using System.Threading.Tasks;

namespace Favi_BE.Interfaces.Repositories
{
    public interface IPostTagRepository : IGenericRepository<PostTag>
    {
        Task<IEnumerable<PostTag>> GetByPostIdAsync(Guid postId);
        Task<IEnumerable<PostTag>> GetByTagIdAsync(Guid tagId);
        Task<bool> ExistsAsync(Guid postId, Guid tagId);
        Task AddTagToPostAsync(Guid postId, Guid tagId);
        Task RemoveTagFromPostAsync(Guid postId, Guid tagId);
        Task<IEnumerable<Guid>> GetPostIdsByTagNameAsync(string tagName);
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Interfaces/Repositories/IProfileRepository.cs">
using Favi_BE.Models.Entities;
using System;
using System.Threading.Tasks;
using System.Collections.Generic;

namespace Favi_BE.Interfaces.Repositories
{
    public interface IProfileRepository : IGenericRepository<Profile>
    {
        Task<Profile> GetByUsernameAsync(string username);
        Task<IEnumerable<Profile>> GetTopCreatorsAsync(int count);
        Task<bool> IsUsernameUniqueAsync(string username);
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Interfaces/Repositories/IReactionRepository.cs">
using Favi_BE.Models.Entities;
using Favi_BE.Models.Entities.JoinTables;
using System;
using System.Collections.Generic;
using System.Threading.Tasks;

namespace Favi_BE.Interfaces.Repositories
{
    public interface IReactionRepository : IGenericRepository<Reaction>
    {
        Task<IEnumerable<Reaction>> GetReactionsByPostIdAsync(Guid postId);
        Task<Reaction> GetProfileReactionOnPostAsync(Guid profileId, Guid postId);
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Interfaces/Repositories/IReportRepository.cs">
using Favi_BE.Models.Entities;
using Favi_BE.Models.Enums;
using System;
using System.Collections.Generic;
using System.Threading.Tasks;

namespace Favi_BE.Interfaces.Repositories
{
    public interface IReportRepository : IGenericRepository<Report>
    {
        Task<IEnumerable<Report>> GetPendingReportsAsync(int skip, int take);
        Task<IEnumerable<Report>> GetReportsByTargetTypeAsync(ReportTarget reportTarget, int skip, int take);
        Task<IEnumerable<Report>> GetReportsByTargetIdAsync(Guid targetId, int skip, int take);
        Task<IEnumerable<Report>> GetReportsByReporterIdAsync(Guid reporterId, int skip, int take);
        Task<(IEnumerable<Report> Items, int Total)> GetReportsByReporterIdPagedAsync(Guid reporterId, int skip, int take);
        Task<(IEnumerable<Report> Items, int Total)> GetReportsByTargetTypePagedAsync(ReportTarget targetType, int skip, int take);
        Task<(IEnumerable<Report> Items, int Total)> GetReportsByTargetIdPagedAsync(Guid targetId, int skip, int take);
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Interfaces/Repositories/ISocialLinkRepository.cs">
using Favi_BE.Models.Entities;
using System;
using System.Collections.Generic;
using System.Threading.Tasks;

namespace Favi_BE.Interfaces.Repositories
{
    public interface ISocialLinkRepository : IGenericRepository<SocialLink>
    {
        Task<IEnumerable<SocialLink>> GetByProfileIdAsync(Guid profileId);
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Interfaces/Repositories/ITagRepository.cs">
using Favi_BE.Models.Entities;
using System;
using System.Collections.Generic;
using System.Threading.Tasks;

namespace Favi_BE.Interfaces.Repositories
{
    public interface ITagRepository : IGenericRepository<Tag>
    {
        Task<Tag> GetByNameAsync(string name);
        Task<IEnumerable<Tag>> GetTagsByPostIdAsync(Guid postId);
        Task<IEnumerable<Tag>> GetOrCreateTagsAsync(IEnumerable<string> tagNames);
        Task<(IEnumerable<Tag> Tags, int TotalCount)> GetAllPagedAsync(int skip, int take);
        Task<IEnumerable<Tag>> GetTagsWithNoPostsAsync();

    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Interfaces/Services/ICloudinaryService.cs">
using Favi_BE.Models.Dtos;

namespace Favi_BE.Interfaces.Services
{
    // Interfaces/Services/ICloudinaryService.cs
    public interface ICloudinaryService
    {
        // B·∫£n an to√†n: kh√¥ng throw; null n·∫øu upload fail
        Task<PostMediaResponse?> TryUploadAsync(IFormFile file, CancellationToken ct = default);

        // (Optional) B·∫£n strict: throw n·∫øu c·∫ßn, gi·ªØ cho test n·ªôi b·ªô
        Task<PostMediaResponse> UploadAsyncOrThrow(IFormFile file, CancellationToken ct = default);
    }


}
</file>

<file path="Favi-BE/Favi-BE.API/Interfaces/Services/ICollectionService.cs">
using Favi_BE.Models.Dtos;
using Favi_BE.Models.Entities;

namespace Favi_BE.Interfaces.Services
{
    public interface ICollectionService
    {
        Task<CollectionResponse> CreateAsync(Guid ownerId, CreateCollectionRequest dto);
        Task<CollectionResponse?> UpdateAsync(Guid collectionId, Guid requesterId, UpdateCollectionRequest dto);
        Task<bool> DeleteAsync(Guid collectionId, Guid requesterId);

        Task<PagedResult<CollectionResponse>> GetByOwnerAsync(Guid ownerId, int page, int pageSize);
        Task<CollectionResponse?> GetByIdAsync(Guid collectionId);

        Task<bool> AddPostAsync(Guid collectionId, Guid postId, Guid requesterId);
        Task<bool> RemovePostAsync(Guid collectionId, Guid postId, Guid requesterId);

        Task<PagedResult<PostResponse>> GetPostsAsync(Guid collectionId, int page, int pageSize);
        Task<Collection?> GetEntityByIdAsync(Guid collectionId);
    }

}
</file>

<file path="Favi-BE/Favi-BE.API/Interfaces/Services/ICommentService.cs">
using Favi_BE.Models.Dtos;

namespace Favi_BE.Interfaces.Services
{
    public interface ICommentService
    {
        Task<CommentResponse> CreateAsync(Guid postId, Guid authorId, string content, Guid? parentId);
        Task<CommentResponse?> UpdateAsync(Guid commentId, Guid requesterId, string content);
        Task<bool> DeleteAsync(Guid commentId, Guid requesterId);
        Task<PagedResult<CommentResponse>> GetByPostAsync(Guid postId, int page, int pageSize);
    }

}
</file>

<file path="Favi-BE/Favi-BE.API/Interfaces/Services/IPostService.cs">
using Favi_BE.Models.Dtos;
using Favi_BE.Models.Entities;
using Favi_BE.Models.Enums;

namespace Favi_BE.Interfaces.Services
{
    public interface IPostService
    {
        Task<PostResponse?> GetByIdAsync(Guid id, Guid? currentUserId);
        Task<PostResponse> CreateAsync(Guid authorId, string? caption, IEnumerable<string>? tags);
        Task<bool> UpdateAsync(Guid postId, Guid requesterId, string? caption);
        Task<bool> DeleteAsync(Guid postId, Guid requesterId);

        // Media
        Task<IEnumerable<PostMediaResponse>> UploadMediaAsync(Guid postId, IEnumerable<IFormFile> files, Guid requesterId);
        Task<bool> RemoveMediaAsync(Guid postId, Guid mediaId, Guid requesterId);

        // Tags
        Task<IEnumerable<TagDto>> AddTagsAsync(Guid postId, IEnumerable<string> tags, Guid requesterId);
        Task<bool> RemoveTagAsync(Guid postId, Guid tagId, Guid requesterId);

        // Reactions
        Task<ReactionSummaryDto> GetReactionsAsync(Guid postId, Guid? currentUserId);
        Task<ReactionType?> ToggleReactionAsync(Guid postId, Guid userId, ReactionType type);
        Task<PagedResult<PostResponse>> GetByProfileAsync(Guid profileId, Guid? viewerId, int page, int pageSize);
        Task<PagedResult<PostResponse>> GetFeedAsync(Guid currentUserId, int page, int pageSize);
        Task<PagedResult<PostResponse>> GetExploreAsync(Guid userId, int page, int pageSize);
        Task<PagedResult<PostResponse>> GetLatestAsync(int page, int pageSize);
        Task<Post?> GetEntityAsync(Guid id);
    }

}
</file>

<file path="Favi-BE/Favi-BE.API/Interfaces/Services/IPrivacyGuard.cs">
using Favi_BE.Models.Entities;
using Favi_BE.Models.Enums;

namespace Favi_BE.Interfaces.Services
{
    public interface IPrivacyGuard
    {
        Task<bool> CanViewProfileAsync(Profile profile, Guid? viewerId, bool isAdmin = false);
        Task<bool> CanViewPostAsync(Post post, Guid? viewerId, bool isAdmin = false);
        Task<bool> CanViewCollectionAsync(Collection collection, Guid? viewerId, bool isAdmin = false);
        Task<bool> CanViewCommentAsync(Post parentPost, Guid? viewerId, bool isAdmin = false);
        Task<bool> CanFollowAsync(Profile targetProfile, Guid? viewerId, bool isAdmin = false);
        Task<bool> CanViewFollowListAsync(Profile profile, Guid? viewerId, bool isAdmin = false);
        Task<bool> CanReportAsync(ReportTarget targetType, Guid targetId, Guid reporterId);
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Interfaces/Services/IProfileService.cs">
using Favi_BE.Models.Dtos;
using Favi_BE.Models.Entities;

namespace Favi_BE.Interfaces.Services
{
    public interface IProfileService
    {
        Task<ProfileResponse?> GetByIdAsync(Guid profileId);
        Task<ProfileResponse?> UpdateAsync(Guid profileId, ProfileUpdateRequest dto);
        Task<bool> FollowAsync(Guid followerId, Guid followeeId);
        Task<bool> UnfollowAsync(Guid followerId, Guid followeeId);
        Task<IEnumerable<FollowResponse>> GetFollowersAsync(Guid profileId);
        Task<IEnumerable<FollowResponse>> GetFollowingsAsync(Guid profileId);
        Task<IEnumerable<FollowResponse>> GetFollowersAsync(Guid profileId, int skip, int take);
        Task<IEnumerable<FollowResponse>> GetFollowingsAsync(Guid profileId, int skip, int take);
        Task<IEnumerable<SocialLinkDto>> GetSocialLinksAsync(Guid profileId);
        Task<SocialLinkDto> AddSocialLinkAsync(Guid profileId, SocialLinkDto dto);
        Task<bool> RemoveSocialLinkAsync(Guid profileId, Guid linkId);
        Task<Profile> CreateProfileAsync(Guid id, string username, string? displayName);
        Task<bool> DeleteAsync(Guid profileId);
        Task<Profile?> GetEntityByIdAsync(Guid profileId);
        Task<bool> CheckValidUsername(string username);
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Interfaces/Services/IReportService.cs">
using Favi_BE.Models.Dtos;
using Favi_BE.Models.Entities;
using Favi_BE.Models.Enums;

namespace Favi_BE.Interfaces.Services
{
    public interface IReportService
    {
        Task<ReportResponse> CreateAsync(CreateReportRequest dto);
        Task<PagedResult<ReportResponse>> GetAllAsync(int page, int pageSize);
        Task<bool> UpdateStatusAsync(Guid reportId, UpdateReportStatusRequest dto);
        Task<PagedResult<ReportResponse>> GetReportsByReporterIdAsync(Guid reporterId, int page, int pageSize);
        Task<PagedResult<ReportResponse>> GetReportsByTargetIdAsync(Guid targetId, int skip, int take);
        Task<PagedResult<ReportResponse>> GetReportsByTargetTypeAsync(ReportTarget targetType, int skip, int take);
    }

}
</file>

<file path="Favi-BE/Favi-BE.API/Interfaces/Services/ISearchService.cs">
using Favi_BE.Models.Dtos;
using Microsoft.AspNetCore.Mvc;

namespace Favi_BE.Interfaces.Services
{
    public interface ISearchService
    {
        Task<SearchResult> SearchAsync(SearchRequest dto); 
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Interfaces/Services/ISupabaseAuthService.cs">
using Favi_BE.Models.Dtos;

namespace Favi_BE.Interfaces.Services
{
    public interface ISupabaseAuthService
    {
        Task<SupabaseAuthResponse?> RegisterAsync(string email, string password, string username);
        Task<SupabaseAuthResponse?> LoginAsync(string email, string password);
        Task<SupabaseAuthResponse?> RefreshAsync(string refreshToken);
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Interfaces/Services/ITagService.cs">
using Favi_BE.Models.Dtos;

namespace Favi_BE.Interfaces.Services
{
    public interface ITagService
    {
        Task<TagResponse> CreateAsync(string name);
        Task<IEnumerable<TagResponse>> GetAllAsync();
        Task<TagResponse?> GetByIdAsync(Guid id);
        Task<PagedResult<PostResponse>> GetPostsByTagAsync(Guid tagId, int page, int pageSize);
        Task<PagedResult<TagResponse>> GetAllPagedAsync(int page, int pageSize);
        Task<IEnumerable<TagResponse>> GetOrCreateTagsAsync(IEnumerable<string> names);
    }

}
</file>

<file path="Favi-BE/Favi-BE.API/Migrations/20250930070642_InitDB.cs">
using System;
using Microsoft.EntityFrameworkCore.Migrations;

#nullable disable

namespace Favi_BE.Migrations
{
    /// <inheritdoc />
    public partial class InitDB : Migration
    {
        /// <inheritdoc />
        protected override void Up(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.CreateTable(
                name: "Profiles",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    Username = table.Column<string>(type: "text", nullable: false),
                    DisplayName = table.Column<string>(type: "text", nullable: true),
                    AvatarUrl = table.Column<string>(type: "text", nullable: true),
                    CoverUrl = table.Column<string>(type: "text", nullable: true),
                    Bio = table.Column<string>(type: "text", nullable: true),
                    Role = table.Column<int>(type: "integer", nullable: false),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    LastActiveAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_Profiles", x => x.Id);
                });

            migrationBuilder.CreateTable(
                name: "Tags",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    Name = table.Column<string>(type: "text", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_Tags", x => x.Id);
                });

            migrationBuilder.CreateTable(
                name: "Collections",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    ProfileId = table.Column<Guid>(type: "uuid", nullable: false),
                    Title = table.Column<string>(type: "text", nullable: false),
                    Description = table.Column<string>(type: "text", nullable: true),
                    CoverImageUrl = table.Column<string>(type: "text", nullable: true),
                    Privacy = table.Column<int>(type: "integer", nullable: false),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    UpdatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_Collections", x => x.Id);
                    table.ForeignKey(
                        name: "FK_Collections_Profiles_ProfileId",
                        column: x => x.ProfileId,
                        principalTable: "Profiles",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateTable(
                name: "Follows",
                columns: table => new
                {
                    FollowerId = table.Column<Guid>(type: "uuid", nullable: false),
                    FolloweeId = table.Column<Guid>(type: "uuid", nullable: false),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_Follows", x => new { x.FollowerId, x.FolloweeId });
                    table.ForeignKey(
                        name: "FK_Follows_Profiles_FolloweeId",
                        column: x => x.FolloweeId,
                        principalTable: "Profiles",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                    table.ForeignKey(
                        name: "FK_Follows_Profiles_FollowerId",
                        column: x => x.FollowerId,
                        principalTable: "Profiles",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateTable(
                name: "Posts",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    ProfileId = table.Column<Guid>(type: "uuid", nullable: false),
                    Caption = table.Column<string>(type: "text", nullable: true),
                    Privacy = table.Column<int>(type: "integer", nullable: false),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    UpdatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_Posts", x => x.Id);
                    table.ForeignKey(
                        name: "FK_Posts_Profiles_ProfileId",
                        column: x => x.ProfileId,
                        principalTable: "Profiles",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateTable(
                name: "Reports",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    ReporterId = table.Column<Guid>(type: "uuid", nullable: true),
                    TargetType = table.Column<int>(type: "integer", nullable: false),
                    TargetId = table.Column<Guid>(type: "uuid", nullable: false),
                    Reason = table.Column<string>(type: "text", nullable: true),
                    Status = table.Column<int>(type: "integer", nullable: false),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    ActedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: true),
                    Data = table.Column<string>(type: "text", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_Reports", x => x.Id);
                    table.ForeignKey(
                        name: "FK_Reports_Profiles_ReporterId",
                        column: x => x.ReporterId,
                        principalTable: "Profiles",
                        principalColumn: "Id");
                });

            migrationBuilder.CreateTable(
                name: "SocialLinks",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    ProfileId = table.Column<Guid>(type: "uuid", nullable: false),
                    Kind = table.Column<int>(type: "integer", nullable: false),
                    Url = table.Column<string>(type: "text", nullable: false),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_SocialLinks", x => x.Id);
                    table.ForeignKey(
                        name: "FK_SocialLinks_Profiles_ProfileId",
                        column: x => x.ProfileId,
                        principalTable: "Profiles",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateTable(
                name: "Comments",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    PostId = table.Column<Guid>(type: "uuid", nullable: false),
                    ProfileId = table.Column<Guid>(type: "uuid", nullable: false),
                    Content = table.Column<string>(type: "text", nullable: false),
                    ParentCommentId = table.Column<Guid>(type: "uuid", nullable: true),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    UpdatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_Comments", x => x.Id);
                    table.ForeignKey(
                        name: "FK_Comments_Comments_ParentCommentId",
                        column: x => x.ParentCommentId,
                        principalTable: "Comments",
                        principalColumn: "Id");
                    table.ForeignKey(
                        name: "FK_Comments_Posts_PostId",
                        column: x => x.PostId,
                        principalTable: "Posts",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                    table.ForeignKey(
                        name: "FK_Comments_Profiles_ProfileId",
                        column: x => x.ProfileId,
                        principalTable: "Profiles",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateTable(
                name: "PostCollections",
                columns: table => new
                {
                    PostId = table.Column<Guid>(type: "uuid", nullable: false),
                    CollectionId = table.Column<Guid>(type: "uuid", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_PostCollections", x => new { x.PostId, x.CollectionId });
                    table.ForeignKey(
                        name: "FK_PostCollections_Collections_CollectionId",
                        column: x => x.CollectionId,
                        principalTable: "Collections",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                    table.ForeignKey(
                        name: "FK_PostCollections_Posts_PostId",
                        column: x => x.PostId,
                        principalTable: "Posts",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateTable(
                name: "PostMedias",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    PostId = table.Column<Guid>(type: "uuid", nullable: false),
                    Url = table.Column<string>(type: "text", nullable: false),
                    ThumbnailUrl = table.Column<string>(type: "text", nullable: true),
                    Position = table.Column<int>(type: "integer", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_PostMedias", x => x.Id);
                    table.ForeignKey(
                        name: "FK_PostMedias_Posts_PostId",
                        column: x => x.PostId,
                        principalTable: "Posts",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateTable(
                name: "PostTags",
                columns: table => new
                {
                    PostId = table.Column<Guid>(type: "uuid", nullable: false),
                    TagId = table.Column<Guid>(type: "uuid", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_PostTags", x => new { x.PostId, x.TagId });
                    table.ForeignKey(
                        name: "FK_PostTags_Posts_PostId",
                        column: x => x.PostId,
                        principalTable: "Posts",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                    table.ForeignKey(
                        name: "FK_PostTags_Tags_TagId",
                        column: x => x.TagId,
                        principalTable: "Tags",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateTable(
                name: "Reactions",
                columns: table => new
                {
                    PostId = table.Column<Guid>(type: "uuid", nullable: false),
                    ProfileId = table.Column<Guid>(type: "uuid", nullable: false),
                    Type = table.Column<int>(type: "integer", nullable: false),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_Reactions", x => new { x.PostId, x.ProfileId });
                    table.ForeignKey(
                        name: "FK_Reactions_Posts_PostId",
                        column: x => x.PostId,
                        principalTable: "Posts",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                    table.ForeignKey(
                        name: "FK_Reactions_Profiles_ProfileId",
                        column: x => x.ProfileId,
                        principalTable: "Profiles",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateIndex(
                name: "IX_Collections_ProfileId",
                table: "Collections",
                column: "ProfileId");

            migrationBuilder.CreateIndex(
                name: "IX_Comments_ParentCommentId",
                table: "Comments",
                column: "ParentCommentId");

            migrationBuilder.CreateIndex(
                name: "IX_Comments_PostId",
                table: "Comments",
                column: "PostId");

            migrationBuilder.CreateIndex(
                name: "IX_Comments_ProfileId",
                table: "Comments",
                column: "ProfileId");

            migrationBuilder.CreateIndex(
                name: "IX_Follows_FolloweeId",
                table: "Follows",
                column: "FolloweeId");

            migrationBuilder.CreateIndex(
                name: "IX_PostCollections_CollectionId",
                table: "PostCollections",
                column: "CollectionId");

            migrationBuilder.CreateIndex(
                name: "IX_PostMedias_PostId",
                table: "PostMedias",
                column: "PostId");

            migrationBuilder.CreateIndex(
                name: "IX_Posts_ProfileId",
                table: "Posts",
                column: "ProfileId");

            migrationBuilder.CreateIndex(
                name: "IX_PostTags_TagId",
                table: "PostTags",
                column: "TagId");

            migrationBuilder.CreateIndex(
                name: "IX_Reactions_ProfileId",
                table: "Reactions",
                column: "ProfileId");

            migrationBuilder.CreateIndex(
                name: "IX_Reports_ReporterId",
                table: "Reports",
                column: "ReporterId");

            migrationBuilder.CreateIndex(
                name: "IX_SocialLinks_ProfileId",
                table: "SocialLinks",
                column: "ProfileId");
        }

        /// <inheritdoc />
        protected override void Down(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.DropTable(
                name: "Comments");

            migrationBuilder.DropTable(
                name: "Follows");

            migrationBuilder.DropTable(
                name: "PostCollections");

            migrationBuilder.DropTable(
                name: "PostMedias");

            migrationBuilder.DropTable(
                name: "PostTags");

            migrationBuilder.DropTable(
                name: "Reactions");

            migrationBuilder.DropTable(
                name: "Reports");

            migrationBuilder.DropTable(
                name: "SocialLinks");

            migrationBuilder.DropTable(
                name: "Collections");

            migrationBuilder.DropTable(
                name: "Tags");

            migrationBuilder.DropTable(
                name: "Posts");

            migrationBuilder.DropTable(
                name: "Profiles");
        }
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Migrations/20250930070642_InitDB.Designer.cs">
// <auto-generated />
using System;
using Favi_BE.Data;
using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.Infrastructure;
using Microsoft.EntityFrameworkCore.Migrations;
using Microsoft.EntityFrameworkCore.Storage.ValueConversion;
using Npgsql.EntityFrameworkCore.PostgreSQL.Metadata;

#nullable disable

namespace Favi_BE.Migrations
{
    [DbContext(typeof(AppDbContext))]
    [Migration("20250930070642_InitDB")]
    partial class InitDB
    {
        /// <inheritdoc />
        protected override void BuildTargetModel(ModelBuilder modelBuilder)
        {
#pragma warning disable 612, 618
            modelBuilder
                .HasAnnotation("ProductVersion", "9.0.9")
                .HasAnnotation("Relational:MaxIdentifierLength", 63);

            NpgsqlModelBuilderExtensions.UseIdentityByDefaultColumns(modelBuilder);

            modelBuilder.Entity("Favi_BE.Models.Entities.Collection", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("CoverImageUrl")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<int>("Privacy")
                        .HasColumnType("integer");

                    b.Property<Guid>("ProfileId")
                        .HasColumnType("uuid");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("ProfileId");

                    b.ToTable("Collections");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Comment", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Content")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("ParentCommentId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("PostId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ProfileId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("ParentCommentId");

                    b.HasIndex("PostId");

                    b.HasIndex("ProfileId");

                    b.ToTable("Comments");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.JoinTables.Follow", b =>
                {
                    b.Property<Guid>("FollowerId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("FolloweeId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("FollowerId", "FolloweeId");

                    b.HasIndex("FolloweeId");

                    b.ToTable("Follows");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.JoinTables.PostCollection", b =>
                {
                    b.Property<Guid>("PostId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("CollectionId")
                        .HasColumnType("uuid");

                    b.HasKey("PostId", "CollectionId");

                    b.HasIndex("CollectionId");

                    b.ToTable("PostCollections");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.JoinTables.PostTag", b =>
                {
                    b.Property<Guid>("PostId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("TagId")
                        .HasColumnType("uuid");

                    b.HasKey("PostId", "TagId");

                    b.HasIndex("TagId");

                    b.ToTable("PostTags");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.JoinTables.Reaction", b =>
                {
                    b.Property<Guid>("PostId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ProfileId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("Type")
                        .HasColumnType("integer");

                    b.HasKey("PostId", "ProfileId");

                    b.HasIndex("ProfileId");

                    b.ToTable("Reactions");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Post", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Caption")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("Privacy")
                        .HasColumnType("integer");

                    b.Property<Guid>("ProfileId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("ProfileId");

                    b.ToTable("Posts");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.PostMedia", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<int>("Position")
                        .HasColumnType("integer");

                    b.Property<Guid>("PostId")
                        .HasColumnType("uuid");

                    b.Property<string>("ThumbnailUrl")
                        .HasColumnType("text");

                    b.Property<string>("Url")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("PostId");

                    b.ToTable("PostMedias");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Profile", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("AvatarUrl")
                        .HasColumnType("text");

                    b.Property<string>("Bio")
                        .HasColumnType("text");

                    b.Property<string>("CoverUrl")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DisplayName")
                        .HasColumnType("text");

                    b.Property<DateTime?>("LastActiveAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("Role")
                        .HasColumnType("integer");

                    b.Property<string>("Username")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Profiles");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Report", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("ActedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Data")
                        .HasColumnType("text");

                    b.Property<string>("Reason")
                        .HasColumnType("text");

                    b.Property<Guid?>("ReporterId")
                        .HasColumnType("uuid");

                    b.Property<int>("Status")
                        .HasColumnType("integer");

                    b.Property<Guid>("TargetId")
                        .HasColumnType("uuid");

                    b.Property<int>("TargetType")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.HasIndex("ReporterId");

                    b.ToTable("Reports");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.SocialLink", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("Kind")
                        .HasColumnType("integer");

                    b.Property<Guid>("ProfileId")
                        .HasColumnType("uuid");

                    b.Property<string>("Url")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("ProfileId");

                    b.ToTable("SocialLinks");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Tag", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Tags");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Collection", b =>
                {
                    b.HasOne("Favi_BE.Models.Entities.Profile", "Profile")
                        .WithMany("Collections")
                        .HasForeignKey("ProfileId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Profile");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Comment", b =>
                {
                    b.HasOne("Favi_BE.Models.Entities.Comment", "ParentComment")
                        .WithMany("Replies")
                        .HasForeignKey("ParentCommentId");

                    b.HasOne("Favi_BE.Models.Entities.Post", "Post")
                        .WithMany("Comments")
                        .HasForeignKey("PostId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("Favi_BE.Models.Entities.Profile", "Profile")
                        .WithMany("Comments")
                        .HasForeignKey("ProfileId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("ParentComment");

                    b.Navigation("Post");

                    b.Navigation("Profile");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.JoinTables.Follow", b =>
                {
                    b.HasOne("Favi_BE.Models.Entities.Profile", "Followee")
                        .WithMany()
                        .HasForeignKey("FolloweeId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("Favi_BE.Models.Entities.Profile", "Follower")
                        .WithMany()
                        .HasForeignKey("FollowerId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Followee");

                    b.Navigation("Follower");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.JoinTables.PostCollection", b =>
                {
                    b.HasOne("Favi_BE.Models.Entities.Collection", "Collection")
                        .WithMany("PostCollections")
                        .HasForeignKey("CollectionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("Favi_BE.Models.Entities.Post", "Post")
                        .WithMany("PostCollections")
                        .HasForeignKey("PostId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Collection");

                    b.Navigation("Post");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.JoinTables.PostTag", b =>
                {
                    b.HasOne("Favi_BE.Models.Entities.Post", "Post")
                        .WithMany("PostTags")
                        .HasForeignKey("PostId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("Favi_BE.Models.Entities.Tag", "Tag")
                        .WithMany("PostTags")
                        .HasForeignKey("TagId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Post");

                    b.Navigation("Tag");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.JoinTables.Reaction", b =>
                {
                    b.HasOne("Favi_BE.Models.Entities.Post", "Post")
                        .WithMany("Reactions")
                        .HasForeignKey("PostId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("Favi_BE.Models.Entities.Profile", "Profile")
                        .WithMany("Reactions")
                        .HasForeignKey("ProfileId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Post");

                    b.Navigation("Profile");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Post", b =>
                {
                    b.HasOne("Favi_BE.Models.Entities.Profile", "Profile")
                        .WithMany("Posts")
                        .HasForeignKey("ProfileId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Profile");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.PostMedia", b =>
                {
                    b.HasOne("Favi_BE.Models.Entities.Post", "Post")
                        .WithMany("Media")
                        .HasForeignKey("PostId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Post");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Report", b =>
                {
                    b.HasOne("Favi_BE.Models.Entities.Profile", "Reporter")
                        .WithMany("Reports")
                        .HasForeignKey("ReporterId");

                    b.Navigation("Reporter");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.SocialLink", b =>
                {
                    b.HasOne("Favi_BE.Models.Entities.Profile", "Profile")
                        .WithMany("SocialLinks")
                        .HasForeignKey("ProfileId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Profile");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Collection", b =>
                {
                    b.Navigation("PostCollections");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Comment", b =>
                {
                    b.Navigation("Replies");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Post", b =>
                {
                    b.Navigation("Comments");

                    b.Navigation("Media");

                    b.Navigation("PostCollections");

                    b.Navigation("PostTags");

                    b.Navigation("Reactions");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Profile", b =>
                {
                    b.Navigation("Collections");

                    b.Navigation("Comments");

                    b.Navigation("Posts");

                    b.Navigation("Reactions");

                    b.Navigation("Reports");

                    b.Navigation("SocialLinks");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Tag", b =>
                {
                    b.Navigation("PostTags");
                });
#pragma warning restore 612, 618
        }
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Migrations/20251003162509_second-db-scaffold-action.cs">
using System;
using Microsoft.EntityFrameworkCore.Migrations;

#nullable disable

namespace Favi_BE.Migrations
{
    /// <inheritdoc />
    public partial class seconddbscaffoldaction : Migration
    {
        /// <inheritdoc />
        protected override void Up(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.DropForeignKey(
                name: "FK_Reports_Profiles_ReporterId",
                table: "Reports");

            migrationBuilder.RenameColumn(
                name: "Privacy",
                table: "Collections",
                newName: "PrivacyLevel");

            migrationBuilder.AlterColumn<Guid>(
                name: "ReporterId",
                table: "Reports",
                type: "uuid",
                nullable: false,
                defaultValue: new Guid("00000000-0000-0000-0000-000000000000"),
                oldClrType: typeof(Guid),
                oldType: "uuid",
                oldNullable: true);

            migrationBuilder.AddColumn<string>(
                name: "Format",
                table: "PostMedias",
                type: "text",
                nullable: false,
                defaultValue: "");

            migrationBuilder.AddColumn<int>(
                name: "Height",
                table: "PostMedias",
                type: "integer",
                nullable: false,
                defaultValue: 0);

            migrationBuilder.AddColumn<string>(
                name: "PublicId",
                table: "PostMedias",
                type: "text",
                nullable: false,
                defaultValue: "");

            migrationBuilder.AddColumn<int>(
                name: "Width",
                table: "PostMedias",
                type: "integer",
                nullable: false,
                defaultValue: 0);

            migrationBuilder.AddForeignKey(
                name: "FK_Reports_Profiles_ReporterId",
                table: "Reports",
                column: "ReporterId",
                principalTable: "Profiles",
                principalColumn: "Id",
                onDelete: ReferentialAction.Cascade);
        }

        /// <inheritdoc />
        protected override void Down(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.DropForeignKey(
                name: "FK_Reports_Profiles_ReporterId",
                table: "Reports");

            migrationBuilder.DropColumn(
                name: "Format",
                table: "PostMedias");

            migrationBuilder.DropColumn(
                name: "Height",
                table: "PostMedias");

            migrationBuilder.DropColumn(
                name: "PublicId",
                table: "PostMedias");

            migrationBuilder.DropColumn(
                name: "Width",
                table: "PostMedias");

            migrationBuilder.RenameColumn(
                name: "PrivacyLevel",
                table: "Collections",
                newName: "Privacy");

            migrationBuilder.AlterColumn<Guid>(
                name: "ReporterId",
                table: "Reports",
                type: "uuid",
                nullable: true,
                oldClrType: typeof(Guid),
                oldType: "uuid");

            migrationBuilder.AddForeignKey(
                name: "FK_Reports_Profiles_ReporterId",
                table: "Reports",
                column: "ReporterId",
                principalTable: "Profiles",
                principalColumn: "Id");
        }
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Migrations/20251003162509_second-db-scaffold-action.Designer.cs">
// <auto-generated />
using System;
using Favi_BE.Data;
using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.Infrastructure;
using Microsoft.EntityFrameworkCore.Migrations;
using Microsoft.EntityFrameworkCore.Storage.ValueConversion;
using Npgsql.EntityFrameworkCore.PostgreSQL.Metadata;

#nullable disable

namespace Favi_BE.Migrations
{
    [DbContext(typeof(AppDbContext))]
    [Migration("20251003162509_second-db-scaffold-action")]
    partial class seconddbscaffoldaction
    {
        /// <inheritdoc />
        protected override void BuildTargetModel(ModelBuilder modelBuilder)
        {
#pragma warning disable 612, 618
            modelBuilder
                .HasAnnotation("ProductVersion", "9.0.9")
                .HasAnnotation("Relational:MaxIdentifierLength", 63);

            NpgsqlModelBuilderExtensions.UseIdentityByDefaultColumns(modelBuilder);

            modelBuilder.Entity("Favi_BE.Models.Entities.Collection", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("CoverImageUrl")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<int>("PrivacyLevel")
                        .HasColumnType("integer");

                    b.Property<Guid>("ProfileId")
                        .HasColumnType("uuid");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("ProfileId");

                    b.ToTable("Collections");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Comment", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Content")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("ParentCommentId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("PostId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ProfileId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("ParentCommentId");

                    b.HasIndex("PostId");

                    b.HasIndex("ProfileId");

                    b.ToTable("Comments");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.JoinTables.Follow", b =>
                {
                    b.Property<Guid>("FollowerId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("FolloweeId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("FollowerId", "FolloweeId");

                    b.HasIndex("FolloweeId");

                    b.ToTable("Follows");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.JoinTables.PostCollection", b =>
                {
                    b.Property<Guid>("PostId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("CollectionId")
                        .HasColumnType("uuid");

                    b.HasKey("PostId", "CollectionId");

                    b.HasIndex("CollectionId");

                    b.ToTable("PostCollections");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.JoinTables.PostTag", b =>
                {
                    b.Property<Guid>("PostId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("TagId")
                        .HasColumnType("uuid");

                    b.HasKey("PostId", "TagId");

                    b.HasIndex("TagId");

                    b.ToTable("PostTags");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.JoinTables.Reaction", b =>
                {
                    b.Property<Guid>("PostId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ProfileId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("Type")
                        .HasColumnType("integer");

                    b.HasKey("PostId", "ProfileId");

                    b.HasIndex("ProfileId");

                    b.ToTable("Reactions");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Post", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Caption")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("Privacy")
                        .HasColumnType("integer");

                    b.Property<Guid>("ProfileId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("ProfileId");

                    b.ToTable("Posts");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.PostMedia", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Format")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<int>("Height")
                        .HasColumnType("integer");

                    b.Property<int>("Position")
                        .HasColumnType("integer");

                    b.Property<Guid>("PostId")
                        .HasColumnType("uuid");

                    b.Property<string>("PublicId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ThumbnailUrl")
                        .HasColumnType("text");

                    b.Property<string>("Url")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<int>("Width")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.HasIndex("PostId");

                    b.ToTable("PostMedias");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Profile", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("AvatarUrl")
                        .HasColumnType("text");

                    b.Property<string>("Bio")
                        .HasColumnType("text");

                    b.Property<string>("CoverUrl")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DisplayName")
                        .HasColumnType("text");

                    b.Property<DateTime?>("LastActiveAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("Role")
                        .HasColumnType("integer");

                    b.Property<string>("Username")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Profiles");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Report", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("ActedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Data")
                        .HasColumnType("text");

                    b.Property<string>("Reason")
                        .HasColumnType("text");

                    b.Property<Guid>("ReporterId")
                        .HasColumnType("uuid");

                    b.Property<int>("Status")
                        .HasColumnType("integer");

                    b.Property<Guid>("TargetId")
                        .HasColumnType("uuid");

                    b.Property<int>("TargetType")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.HasIndex("ReporterId");

                    b.ToTable("Reports");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.SocialLink", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("Kind")
                        .HasColumnType("integer");

                    b.Property<Guid>("ProfileId")
                        .HasColumnType("uuid");

                    b.Property<string>("Url")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("ProfileId");

                    b.ToTable("SocialLinks");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Tag", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Tags");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Collection", b =>
                {
                    b.HasOne("Favi_BE.Models.Entities.Profile", "Profile")
                        .WithMany("Collections")
                        .HasForeignKey("ProfileId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Profile");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Comment", b =>
                {
                    b.HasOne("Favi_BE.Models.Entities.Comment", "ParentComment")
                        .WithMany("Replies")
                        .HasForeignKey("ParentCommentId");

                    b.HasOne("Favi_BE.Models.Entities.Post", "Post")
                        .WithMany("Comments")
                        .HasForeignKey("PostId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("Favi_BE.Models.Entities.Profile", "Profile")
                        .WithMany("Comments")
                        .HasForeignKey("ProfileId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("ParentComment");

                    b.Navigation("Post");

                    b.Navigation("Profile");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.JoinTables.Follow", b =>
                {
                    b.HasOne("Favi_BE.Models.Entities.Profile", "Followee")
                        .WithMany()
                        .HasForeignKey("FolloweeId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("Favi_BE.Models.Entities.Profile", "Follower")
                        .WithMany()
                        .HasForeignKey("FollowerId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Followee");

                    b.Navigation("Follower");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.JoinTables.PostCollection", b =>
                {
                    b.HasOne("Favi_BE.Models.Entities.Collection", "Collection")
                        .WithMany("PostCollections")
                        .HasForeignKey("CollectionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("Favi_BE.Models.Entities.Post", "Post")
                        .WithMany("PostCollections")
                        .HasForeignKey("PostId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Collection");

                    b.Navigation("Post");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.JoinTables.PostTag", b =>
                {
                    b.HasOne("Favi_BE.Models.Entities.Post", "Post")
                        .WithMany("PostTags")
                        .HasForeignKey("PostId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("Favi_BE.Models.Entities.Tag", "Tag")
                        .WithMany("PostTags")
                        .HasForeignKey("TagId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Post");

                    b.Navigation("Tag");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.JoinTables.Reaction", b =>
                {
                    b.HasOne("Favi_BE.Models.Entities.Post", "Post")
                        .WithMany("Reactions")
                        .HasForeignKey("PostId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("Favi_BE.Models.Entities.Profile", "Profile")
                        .WithMany("Reactions")
                        .HasForeignKey("ProfileId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Post");

                    b.Navigation("Profile");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Post", b =>
                {
                    b.HasOne("Favi_BE.Models.Entities.Profile", "Profile")
                        .WithMany("Posts")
                        .HasForeignKey("ProfileId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Profile");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.PostMedia", b =>
                {
                    b.HasOne("Favi_BE.Models.Entities.Post", "Post")
                        .WithMany("PostMedias")
                        .HasForeignKey("PostId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Post");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Report", b =>
                {
                    b.HasOne("Favi_BE.Models.Entities.Profile", "Reporter")
                        .WithMany("Reports")
                        .HasForeignKey("ReporterId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Reporter");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.SocialLink", b =>
                {
                    b.HasOne("Favi_BE.Models.Entities.Profile", "Profile")
                        .WithMany("SocialLinks")
                        .HasForeignKey("ProfileId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Profile");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Collection", b =>
                {
                    b.Navigation("PostCollections");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Comment", b =>
                {
                    b.Navigation("Replies");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Post", b =>
                {
                    b.Navigation("Comments");

                    b.Navigation("PostCollections");

                    b.Navigation("PostMedias");

                    b.Navigation("PostTags");

                    b.Navigation("Reactions");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Profile", b =>
                {
                    b.Navigation("Collections");

                    b.Navigation("Comments");

                    b.Navigation("Posts");

                    b.Navigation("Reactions");

                    b.Navigation("Reports");

                    b.Navigation("SocialLinks");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Tag", b =>
                {
                    b.Navigation("PostTags");
                });
#pragma warning restore 612, 618
        }
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Migrations/20251006031653_Add privacylevel and followprivacylevel for profile.cs">
using Microsoft.EntityFrameworkCore.Migrations;

#nullable disable

namespace Favi_BE.Migrations
{
    /// <inheritdoc />
    public partial class Addprivacylevelandfollowprivacylevelforprofile : Migration
    {
        /// <inheritdoc />
        protected override void Up(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.AddColumn<int>(
                name: "FollowPrivacyLevel",
                table: "Profiles",
                type: "integer",
                nullable: false,
                defaultValue: 0);

            migrationBuilder.AddColumn<int>(
                name: "PrivacyLevel",
                table: "Profiles",
                type: "integer",
                nullable: false,
                defaultValue: 0);
        }

        /// <inheritdoc />
        protected override void Down(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.DropColumn(
                name: "FollowPrivacyLevel",
                table: "Profiles");

            migrationBuilder.DropColumn(
                name: "PrivacyLevel",
                table: "Profiles");
        }
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Migrations/20251006031653_Add privacylevel and followprivacylevel for profile.Designer.cs">
// <auto-generated />
using System;
using Favi_BE.Data;
using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.Infrastructure;
using Microsoft.EntityFrameworkCore.Migrations;
using Microsoft.EntityFrameworkCore.Storage.ValueConversion;
using Npgsql.EntityFrameworkCore.PostgreSQL.Metadata;

#nullable disable

namespace Favi_BE.Migrations
{
    [DbContext(typeof(AppDbContext))]
    [Migration("20251006031653_Add privacylevel and followprivacylevel for profile")]
    partial class Addprivacylevelandfollowprivacylevelforprofile
    {
        /// <inheritdoc />
        protected override void BuildTargetModel(ModelBuilder modelBuilder)
        {
#pragma warning disable 612, 618
            modelBuilder
                .HasAnnotation("ProductVersion", "9.0.9")
                .HasAnnotation("Relational:MaxIdentifierLength", 63);

            NpgsqlModelBuilderExtensions.UseIdentityByDefaultColumns(modelBuilder);

            modelBuilder.Entity("Favi_BE.Models.Entities.Collection", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("CoverImageUrl")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<int>("PrivacyLevel")
                        .HasColumnType("integer");

                    b.Property<Guid>("ProfileId")
                        .HasColumnType("uuid");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("ProfileId");

                    b.ToTable("Collections");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Comment", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Content")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("ParentCommentId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("PostId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ProfileId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("ParentCommentId");

                    b.HasIndex("PostId");

                    b.HasIndex("ProfileId");

                    b.ToTable("Comments");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.JoinTables.Follow", b =>
                {
                    b.Property<Guid>("FollowerId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("FolloweeId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("FollowerId", "FolloweeId");

                    b.HasIndex("FolloweeId");

                    b.ToTable("Follows");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.JoinTables.PostCollection", b =>
                {
                    b.Property<Guid>("PostId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("CollectionId")
                        .HasColumnType("uuid");

                    b.HasKey("PostId", "CollectionId");

                    b.HasIndex("CollectionId");

                    b.ToTable("PostCollections");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.JoinTables.PostTag", b =>
                {
                    b.Property<Guid>("PostId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("TagId")
                        .HasColumnType("uuid");

                    b.HasKey("PostId", "TagId");

                    b.HasIndex("TagId");

                    b.ToTable("PostTags");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.JoinTables.Reaction", b =>
                {
                    b.Property<Guid>("PostId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ProfileId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("Type")
                        .HasColumnType("integer");

                    b.HasKey("PostId", "ProfileId");

                    b.HasIndex("ProfileId");

                    b.ToTable("Reactions");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Post", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Caption")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("Privacy")
                        .HasColumnType("integer");

                    b.Property<Guid>("ProfileId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("ProfileId");

                    b.ToTable("Posts");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.PostMedia", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Format")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<int>("Height")
                        .HasColumnType("integer");

                    b.Property<int>("Position")
                        .HasColumnType("integer");

                    b.Property<Guid>("PostId")
                        .HasColumnType("uuid");

                    b.Property<string>("PublicId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ThumbnailUrl")
                        .HasColumnType("text");

                    b.Property<string>("Url")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<int>("Width")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.HasIndex("PostId");

                    b.ToTable("PostMedias");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Profile", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("AvatarUrl")
                        .HasColumnType("text");

                    b.Property<string>("Bio")
                        .HasColumnType("text");

                    b.Property<string>("CoverUrl")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DisplayName")
                        .HasColumnType("text");

                    b.Property<int>("FollowPrivacyLevel")
                        .HasColumnType("integer");

                    b.Property<DateTime?>("LastActiveAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("PrivacyLevel")
                        .HasColumnType("integer");

                    b.Property<int>("Role")
                        .HasColumnType("integer");

                    b.Property<string>("Username")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Profiles");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Report", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("ActedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Data")
                        .HasColumnType("text");

                    b.Property<string>("Reason")
                        .HasColumnType("text");

                    b.Property<Guid>("ReporterId")
                        .HasColumnType("uuid");

                    b.Property<int>("Status")
                        .HasColumnType("integer");

                    b.Property<Guid>("TargetId")
                        .HasColumnType("uuid");

                    b.Property<int>("TargetType")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.HasIndex("ReporterId");

                    b.ToTable("Reports");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.SocialLink", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("Kind")
                        .HasColumnType("integer");

                    b.Property<Guid>("ProfileId")
                        .HasColumnType("uuid");

                    b.Property<string>("Url")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("ProfileId");

                    b.ToTable("SocialLinks");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Tag", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Tags");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Collection", b =>
                {
                    b.HasOne("Favi_BE.Models.Entities.Profile", "Profile")
                        .WithMany("Collections")
                        .HasForeignKey("ProfileId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Profile");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Comment", b =>
                {
                    b.HasOne("Favi_BE.Models.Entities.Comment", "ParentComment")
                        .WithMany("Replies")
                        .HasForeignKey("ParentCommentId")
                        .OnDelete(DeleteBehavior.NoAction);

                    b.HasOne("Favi_BE.Models.Entities.Post", "Post")
                        .WithMany("Comments")
                        .HasForeignKey("PostId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("Favi_BE.Models.Entities.Profile", "Profile")
                        .WithMany("Comments")
                        .HasForeignKey("ProfileId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("ParentComment");

                    b.Navigation("Post");

                    b.Navigation("Profile");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.JoinTables.Follow", b =>
                {
                    b.HasOne("Favi_BE.Models.Entities.Profile", "Followee")
                        .WithMany()
                        .HasForeignKey("FolloweeId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("Favi_BE.Models.Entities.Profile", "Follower")
                        .WithMany()
                        .HasForeignKey("FollowerId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Followee");

                    b.Navigation("Follower");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.JoinTables.PostCollection", b =>
                {
                    b.HasOne("Favi_BE.Models.Entities.Collection", "Collection")
                        .WithMany("PostCollections")
                        .HasForeignKey("CollectionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("Favi_BE.Models.Entities.Post", "Post")
                        .WithMany("PostCollections")
                        .HasForeignKey("PostId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Collection");

                    b.Navigation("Post");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.JoinTables.PostTag", b =>
                {
                    b.HasOne("Favi_BE.Models.Entities.Post", "Post")
                        .WithMany("PostTags")
                        .HasForeignKey("PostId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("Favi_BE.Models.Entities.Tag", "Tag")
                        .WithMany("PostTags")
                        .HasForeignKey("TagId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Post");

                    b.Navigation("Tag");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.JoinTables.Reaction", b =>
                {
                    b.HasOne("Favi_BE.Models.Entities.Post", "Post")
                        .WithMany("Reactions")
                        .HasForeignKey("PostId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("Favi_BE.Models.Entities.Profile", "Profile")
                        .WithMany("Reactions")
                        .HasForeignKey("ProfileId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Post");

                    b.Navigation("Profile");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Post", b =>
                {
                    b.HasOne("Favi_BE.Models.Entities.Profile", "Profile")
                        .WithMany("Posts")
                        .HasForeignKey("ProfileId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Profile");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.PostMedia", b =>
                {
                    b.HasOne("Favi_BE.Models.Entities.Post", "Post")
                        .WithMany("PostMedias")
                        .HasForeignKey("PostId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Post");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Report", b =>
                {
                    b.HasOne("Favi_BE.Models.Entities.Profile", "Reporter")
                        .WithMany("Reports")
                        .HasForeignKey("ReporterId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Reporter");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.SocialLink", b =>
                {
                    b.HasOne("Favi_BE.Models.Entities.Profile", "Profile")
                        .WithMany("SocialLinks")
                        .HasForeignKey("ProfileId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Profile");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Collection", b =>
                {
                    b.Navigation("PostCollections");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Comment", b =>
                {
                    b.Navigation("Replies");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Post", b =>
                {
                    b.Navigation("Comments");

                    b.Navigation("PostCollections");

                    b.Navigation("PostMedias");

                    b.Navigation("PostTags");

                    b.Navigation("Reactions");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Profile", b =>
                {
                    b.Navigation("Collections");

                    b.Navigation("Comments");

                    b.Navigation("Posts");

                    b.Navigation("Reactions");

                    b.Navigation("Reports");

                    b.Navigation("SocialLinks");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Tag", b =>
                {
                    b.Navigation("PostTags");
                });
#pragma warning restore 612, 618
        }
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Migrations/AppDbContextModelSnapshot.cs">
// <auto-generated />
using System;
using Favi_BE.Data;
using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.Infrastructure;
using Microsoft.EntityFrameworkCore.Storage.ValueConversion;
using Npgsql.EntityFrameworkCore.PostgreSQL.Metadata;

#nullable disable

namespace Favi_BE.Migrations
{
    [DbContext(typeof(AppDbContext))]
    partial class AppDbContextModelSnapshot : ModelSnapshot
    {
        protected override void BuildModel(ModelBuilder modelBuilder)
        {
#pragma warning disable 612, 618
            modelBuilder
                .HasAnnotation("ProductVersion", "9.0.9")
                .HasAnnotation("Relational:MaxIdentifierLength", 63);

            NpgsqlModelBuilderExtensions.UseIdentityByDefaultColumns(modelBuilder);

            modelBuilder.Entity("Favi_BE.Models.Entities.Collection", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("CoverImageUrl")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<int>("PrivacyLevel")
                        .HasColumnType("integer");

                    b.Property<Guid>("ProfileId")
                        .HasColumnType("uuid");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("ProfileId");

                    b.ToTable("Collections");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Comment", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Content")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("ParentCommentId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("PostId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ProfileId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("ParentCommentId");

                    b.HasIndex("PostId");

                    b.HasIndex("ProfileId");

                    b.ToTable("Comments");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.JoinTables.Follow", b =>
                {
                    b.Property<Guid>("FollowerId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("FolloweeId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("FollowerId", "FolloweeId");

                    b.HasIndex("FolloweeId");

                    b.ToTable("Follows");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.JoinTables.PostCollection", b =>
                {
                    b.Property<Guid>("PostId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("CollectionId")
                        .HasColumnType("uuid");

                    b.HasKey("PostId", "CollectionId");

                    b.HasIndex("CollectionId");

                    b.ToTable("PostCollections");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.JoinTables.PostTag", b =>
                {
                    b.Property<Guid>("PostId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("TagId")
                        .HasColumnType("uuid");

                    b.HasKey("PostId", "TagId");

                    b.HasIndex("TagId");

                    b.ToTable("PostTags");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.JoinTables.Reaction", b =>
                {
                    b.Property<Guid>("PostId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ProfileId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("Type")
                        .HasColumnType("integer");

                    b.HasKey("PostId", "ProfileId");

                    b.HasIndex("ProfileId");

                    b.ToTable("Reactions");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Post", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Caption")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("Privacy")
                        .HasColumnType("integer");

                    b.Property<Guid>("ProfileId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("ProfileId");

                    b.ToTable("Posts");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.PostMedia", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Format")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<int>("Height")
                        .HasColumnType("integer");

                    b.Property<int>("Position")
                        .HasColumnType("integer");

                    b.Property<Guid>("PostId")
                        .HasColumnType("uuid");

                    b.Property<string>("PublicId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ThumbnailUrl")
                        .HasColumnType("text");

                    b.Property<string>("Url")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<int>("Width")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.HasIndex("PostId");

                    b.ToTable("PostMedias");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Profile", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("AvatarUrl")
                        .HasColumnType("text");

                    b.Property<string>("Bio")
                        .HasColumnType("text");

                    b.Property<string>("CoverUrl")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DisplayName")
                        .HasColumnType("text");

                    b.Property<int>("FollowPrivacyLevel")
                        .HasColumnType("integer");

                    b.Property<DateTime?>("LastActiveAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("PrivacyLevel")
                        .HasColumnType("integer");

                    b.Property<int>("Role")
                        .HasColumnType("integer");

                    b.Property<string>("Username")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Profiles");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Report", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("ActedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Data")
                        .HasColumnType("text");

                    b.Property<string>("Reason")
                        .HasColumnType("text");

                    b.Property<Guid>("ReporterId")
                        .HasColumnType("uuid");

                    b.Property<int>("Status")
                        .HasColumnType("integer");

                    b.Property<Guid>("TargetId")
                        .HasColumnType("uuid");

                    b.Property<int>("TargetType")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.HasIndex("ReporterId");

                    b.ToTable("Reports");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.SocialLink", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("Kind")
                        .HasColumnType("integer");

                    b.Property<Guid>("ProfileId")
                        .HasColumnType("uuid");

                    b.Property<string>("Url")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("ProfileId");

                    b.ToTable("SocialLinks");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Tag", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Tags");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Collection", b =>
                {
                    b.HasOne("Favi_BE.Models.Entities.Profile", "Profile")
                        .WithMany("Collections")
                        .HasForeignKey("ProfileId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Profile");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Comment", b =>
                {
                    b.HasOne("Favi_BE.Models.Entities.Comment", "ParentComment")
                        .WithMany("Replies")
                        .HasForeignKey("ParentCommentId")
                        .OnDelete(DeleteBehavior.NoAction);

                    b.HasOne("Favi_BE.Models.Entities.Post", "Post")
                        .WithMany("Comments")
                        .HasForeignKey("PostId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("Favi_BE.Models.Entities.Profile", "Profile")
                        .WithMany("Comments")
                        .HasForeignKey("ProfileId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("ParentComment");

                    b.Navigation("Post");

                    b.Navigation("Profile");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.JoinTables.Follow", b =>
                {
                    b.HasOne("Favi_BE.Models.Entities.Profile", "Followee")
                        .WithMany()
                        .HasForeignKey("FolloweeId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("Favi_BE.Models.Entities.Profile", "Follower")
                        .WithMany()
                        .HasForeignKey("FollowerId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Followee");

                    b.Navigation("Follower");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.JoinTables.PostCollection", b =>
                {
                    b.HasOne("Favi_BE.Models.Entities.Collection", "Collection")
                        .WithMany("PostCollections")
                        .HasForeignKey("CollectionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("Favi_BE.Models.Entities.Post", "Post")
                        .WithMany("PostCollections")
                        .HasForeignKey("PostId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Collection");

                    b.Navigation("Post");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.JoinTables.PostTag", b =>
                {
                    b.HasOne("Favi_BE.Models.Entities.Post", "Post")
                        .WithMany("PostTags")
                        .HasForeignKey("PostId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("Favi_BE.Models.Entities.Tag", "Tag")
                        .WithMany("PostTags")
                        .HasForeignKey("TagId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Post");

                    b.Navigation("Tag");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.JoinTables.Reaction", b =>
                {
                    b.HasOne("Favi_BE.Models.Entities.Post", "Post")
                        .WithMany("Reactions")
                        .HasForeignKey("PostId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("Favi_BE.Models.Entities.Profile", "Profile")
                        .WithMany("Reactions")
                        .HasForeignKey("ProfileId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Post");

                    b.Navigation("Profile");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Post", b =>
                {
                    b.HasOne("Favi_BE.Models.Entities.Profile", "Profile")
                        .WithMany("Posts")
                        .HasForeignKey("ProfileId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Profile");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.PostMedia", b =>
                {
                    b.HasOne("Favi_BE.Models.Entities.Post", "Post")
                        .WithMany("PostMedias")
                        .HasForeignKey("PostId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Post");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Report", b =>
                {
                    b.HasOne("Favi_BE.Models.Entities.Profile", "Reporter")
                        .WithMany("Reports")
                        .HasForeignKey("ReporterId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Reporter");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.SocialLink", b =>
                {
                    b.HasOne("Favi_BE.Models.Entities.Profile", "Profile")
                        .WithMany("SocialLinks")
                        .HasForeignKey("ProfileId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Profile");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Collection", b =>
                {
                    b.Navigation("PostCollections");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Comment", b =>
                {
                    b.Navigation("Replies");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Post", b =>
                {
                    b.Navigation("Comments");

                    b.Navigation("PostCollections");

                    b.Navigation("PostMedias");

                    b.Navigation("PostTags");

                    b.Navigation("Reactions");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Profile", b =>
                {
                    b.Navigation("Collections");

                    b.Navigation("Comments");

                    b.Navigation("Posts");

                    b.Navigation("Reactions");

                    b.Navigation("Reports");

                    b.Navigation("SocialLinks");
                });

            modelBuilder.Entity("Favi_BE.Models.Entities.Tag", b =>
                {
                    b.Navigation("PostTags");
                });
#pragma warning restore 612, 618
        }
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Models/Dtos/AuthDtos.cs">
namespace Favi_BE.Models.Dtos
{
    public record LoginRequest(string Email, string Password);
    public record RegisterRequest(string Email, string Password, string Username, string? DisplayName);
    public record RefreshRequest(string RefreshToken);

    public record AuthResponse(
        string AccessToken,
        string RefreshToken,
        string Message
    );
}
</file>

<file path="Favi-BE/Favi-BE.API/Models/Dtos/CollectionDtos.cs">
using Favi_BE.Models.Enums;

namespace Favi_BE.Models.Dtos
{
    public record CreateCollectionRequest(
        Guid OwnerProfileId,
        string Title,
        string? Description,
        PrivacyLevel PrivacyLevel,
        string? CoverImageUrl
    );

    public record UpdateCollectionRequest(
        string? Title,
        string? Description,
        PrivacyLevel? PrivacyLevel,
        string? CoverImageUrl
    );

    public record CollectionResponse(
        Guid Id,
        Guid OwnerProfileId,
        string Title,
        string? Description,
        string CoverImageUrl,
        PrivacyLevel PrivacyLevel,
        DateTime CreatedAt,
        DateTime UpdatedAt,
        IEnumerable<Guid> PostIds,
        int PostCount
    );

}
</file>

<file path="Favi-BE/Favi-BE.API/Models/Dtos/CommentDtos.cs">
namespace Favi_BE.Models.Dtos
{
    public record CreateCommentRequest(
        Guid PostId,
        Guid AuthorProfileId,
        string Content,
        Guid? ParentCommentId
    );

    public record UpdateCommentRequest(
        string Content
    );

    public record CommentResponse(
        Guid Id,
        Guid PostId,
        Guid AuthorProfileId,
        string Content,
        DateTime CreatedAt,
        DateTime? UpdatedAt,
        Guid? ParentCommentId // n·∫øu h·ªó tr·ª£ reply nhi·ªÅu c·∫•p
    );
}
</file>

<file path="Favi-BE/Favi-BE.API/Models/Dtos/CommonDtos.cs">
namespace Favi_BE.Models.Dtos
{
    public record PagedResult<T>(
        IEnumerable<T> Items,
        int Page,
        int PageSize,
        int TotalCount
    );
}
</file>

<file path="Favi-BE/Favi-BE.API/Models/Dtos/NotificationDtos.cs">
using Favi_BE.Models.Enums;

namespace Favi_BE.Models.Dtos
{
    public record NotificationDto(
        int Id,
        NotificationType Type,
        Guid ActorProfileId,
        Guid? TargetPostId,
        Guid? TargetCommentId,
        string Message,
        DateTime CreatedAt
    );
}
</file>

<file path="Favi-BE/Favi-BE.API/Models/Dtos/PostDtos.cs">
using Favi_BE.Models.Enums;

namespace Favi_BE.Models.Dtos
{
    public record CreatePostRequest(
        // Guid AuthorProfileId l·∫•y t·ª´ jwt claims tr√°nh m·∫°o danh ƒëƒÉng
        string? Caption,
        IEnumerable<String>? Tags
    );

    public record UpdatePostRequest(
        string? Caption
    );

    // Response
    public record PostResponse(
        Guid Id,
        Guid AuthorProfileId,
        string? Caption,
        DateTime CreatedAt,
        DateTime UpdatedAt,
        PrivacyLevel PrivacyLevel,
        IEnumerable<PostMediaResponse> Medias,
        IEnumerable<TagDto> Tags,
        ReactionSummaryDto Reactions
    );

    public record PostMediaResponse(
        Guid Id,
        Guid PostId,
        string Url,
        string PublicId, //currently used for Cloudinary
        int Width,
        int Height,
        string Format,
        int Position,
        string? ThumbnailUrl
    );

    public record ReactionSummaryDto(
        int Total,
        Dictionary<ReactionType, int> ByType,
        ReactionType? CurrentUserReaction
    );

    public record ToggleReactionRequest(
        Guid UserProfileId,
        ReactionType Type
    );

    public record TagDto(
        Guid Id,
        string Name
    );
}
</file>

<file path="Favi-BE/Favi-BE.API/Models/Dtos/ProfileDtos.cs">
using Favi_BE.Models.Enums;

namespace Favi_BE.Models.Dtos
{
    public record ProfileResponse(
        Guid Id,
        string Username,
        string? DisplayName,
        string? Bio,
        string? AvatarUrl,
        string? CoverUrl,
        DateTime CreatedAt,
        DateTime LastActiveAt,
        PrivacyLevel PrivacyLevel,
        PrivacyLevel FollowPrivacyLevel,
        int? FollowersCount,
        int? FollowingCount
    );

    public record ProfileUpdateRequest(
        string? Username,
        string? DisplayName,
        string? Bio,
        string? AvatarUrl,
        string? CoverUrl,
        PrivacyLevel? PrivacyLevel,
        PrivacyLevel? FollowPrivacyLevel
    );

    public record SocialLinkDto(
        Guid? Id,
        SocialKind SocialKind,
        string Url
    );

    public record FollowResponse(
        Guid FollowerId,
        Guid FolloweeId,
        DateTime CreatedAt
    );
}
</file>

<file path="Favi-BE/Favi-BE.API/Models/Dtos/ReportDtos.cs">
using Favi_BE.Models.Enums;

namespace Favi_BE.Models.Dtos
{
    public record CreateReportRequest(
        Guid ReporterProfileId,
        ReportTarget TargetType,
        Guid TargetId,
        string Reason
    );

    public record ReportResponse(
        Guid Id,
        Guid ReporterProfileId,
        ReportTarget TargetType,
        Guid TargetId,
        string Reason,
        ReportStatus Status,
        DateTime CreatedAt,
        DateTime? ActedAt,
        string? Data
    );

    public record UpdateReportStatusRequest(
        ReportStatus NewStatus
    );
}
</file>

<file path="Favi-BE/Favi-BE.API/Models/Dtos/SearchDtos.cs">
namespace Favi_BE.Models.Dtos
{
    public record SearchRequest(
        string Query,
        int Page,
        int PageSize
    );

    public record SearchResult(
        IEnumerable<SearchPostDto> Posts,
        IEnumerable<SearchTagDto> Tags
    );

    public record SearchPostDto(
        Guid Id,
        string Caption,
        string ThumbnailUrl
    );

    public record SearchTagDto(
        Guid Id,
        string Name,
        int PostCount
    );
}
</file>

<file path="Favi-BE/Favi-BE.API/Models/Dtos/SupabaseAuthDtos.cs">
using System.Text.Json.Serialization;

namespace Favi_BE.Models.Dtos
{
    public class SupabaseOptions
    {
        public string Url = null!;
        public string ApiKey = null!;
    }

    public record SupabaseAuthResponse(
        [property: JsonPropertyName("access_token")] string AccessToken,
        [property: JsonPropertyName("token_type")] string TokenType,
        [property: JsonPropertyName("expires_in")] int ExpiresIn,
        [property: JsonPropertyName("expires_at")] long ExpiresAt,
        [property: JsonPropertyName("refresh_token")] string RefreshToken,
        [property: JsonPropertyName("user")] SupabaseUser User,
        [property: JsonPropertyName("weak_password")] string? WeakPassword
    );

    public record SupabaseUser(
        [property: JsonPropertyName("id")] string Id,
        [property: JsonPropertyName("aud")] string Aud,
        [property: JsonPropertyName("role")] string Role,
        [property: JsonPropertyName("email")] string Email,
        [property: JsonPropertyName("email_confirmed_at")] DateTime? EmailConfirmedAt,
        [property: JsonPropertyName("phone")] string Phone,
        [property: JsonPropertyName("confirmed_at")] DateTime? ConfirmedAt,
        [property: JsonPropertyName("last_sign_in_at")] DateTime? LastSignInAt,
        [property: JsonPropertyName("app_metadata")] Dictionary<string, object> AppMetadata,
        [property: JsonPropertyName("user_metadata")] Dictionary<string, object> UserMetadata,
        [property: JsonPropertyName("identities")] List<SupabaseIdentity> Identities,
        [property: JsonPropertyName("created_at")] DateTime CreatedAt,
        [property: JsonPropertyName("updated_at")] DateTime UpdatedAt,
        [property: JsonPropertyName("is_anonymous")] bool IsAnonymous
    );

    public record SupabaseIdentity(
        [property: JsonPropertyName("identity_id")] string IdentityId,
        [property: JsonPropertyName("id")] string Id,
        [property: JsonPropertyName("user_id")] string UserId,
        [property: JsonPropertyName("identity_data")] Dictionary<string, object> IdentityData,
        [property: JsonPropertyName("provider")] string Provider,
        [property: JsonPropertyName("last_sign_in_at")] DateTime LastSignInAt,
        [property: JsonPropertyName("created_at")] DateTime CreatedAt,
        [property: JsonPropertyName("updated_at")] DateTime UpdatedAt,
        [property: JsonPropertyName("email")] string Email
    );
}
</file>

<file path="Favi-BE/Favi-BE.API/Models/Dtos/TagDtos.cs">
namespace Favi_BE.Models.Dtos
{
    public record TagResponse(
        Guid Id,
        string Name,
        int PostCount
    );
}
</file>

<file path="Favi-BE/Favi-BE.API/Models/Entities/Collection.cs">
using Favi_BE.Models.Entities.JoinTables;
using Favi_BE.Models.Enums;

namespace Favi_BE.Models.Entities
{
    public class Collection
    {
        public Guid Id { get; set; }
        public Guid ProfileId { get; set; }
        public string Title { get; set; } = null!;
        public string? Description { get; set; }
        public string? CoverImageUrl { get; set; }
        public PrivacyLevel PrivacyLevel { get; set; }
        public DateTime CreatedAt { get; set; }
        public DateTime UpdatedAt { get; set; }

        public Profile Profile { get; set; } = null!;
        public ICollection<PostCollection> PostCollections { get; set; } = new List<PostCollection>();
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Models/Entities/Comment.cs">
namespace Favi_BE.Models.Entities
{
    public class Comment
    {
        public Guid Id { get; set; }
        public Guid PostId { get; set; }
        public Guid ProfileId { get; set; }
        public string Content { get; set; } = null!;
        public Guid? ParentCommentId { get; set; }
        public DateTime CreatedAt { get; set; }
        public DateTime? UpdatedAt { get; set; }

        public Post Post { get; set; } = null!;
        public Profile Profile { get; set; } = null!;
        public Comment? ParentComment { get; set; }
        public ICollection<Comment> Replies { get; set; } = new List<Comment>();
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Models/Entities/JoinTables/Follow.cs">
namespace Favi_BE.Models.Entities.JoinTables
{
    public class Follow
    {
        public Guid FollowerId { get; set; }
        public Guid FolloweeId { get; set; }
        public DateTime CreatedAt { get; set; }

        public Profile Follower { get; set; } = null!;
        public Profile Followee { get; set; } = null!;
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Models/Entities/JoinTables/PostCollection.cs">
namespace Favi_BE.Models.Entities.JoinTables
{
    public class PostCollection
    {
        public Guid PostId { get; set; }
        public Guid CollectionId { get; set; }

        public Post Post { get; set; } = null!;
        public Collection Collection { get; set; } = null!;
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Models/Entities/JoinTables/PostTag.cs">
namespace Favi_BE.Models.Entities.JoinTables
{
    public class PostTag
    {
        public Guid PostId { get; set; }
        public Guid TagId { get; set; }

        public Post Post { get; set; } = null!;
        public Tag Tag { get; set; } = null!;
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Models/Entities/JoinTables/Reaction.cs">
using Favi_BE.Models.Enums;

namespace Favi_BE.Models.Entities.JoinTables
{
    public class Reaction
    {
        public Guid PostId { get; set; }
        public Guid ProfileId { get; set; }
        public ReactionType Type { get; set; }
        public DateTime CreatedAt { get; set; }

        public Post Post { get; set; } = null!;
        public Profile Profile { get; set; } = null!;
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Models/Entities/Post.cs">
using Favi_BE.Models.Entities.JoinTables;
using Favi_BE.Models.Enums;
using System.Xml.Linq;

namespace Favi_BE.Models.Entities
{
    public class Post
    {
        public Guid Id { get; set; }
        public Guid ProfileId { get; set; }
        public string? Caption { get; set; }
        public PrivacyLevel Privacy { get; set; }
        public DateTime CreatedAt { get; set; }
        public DateTime UpdatedAt { get; set; }

        public Profile Profile { get; set; } = null!;
        public ICollection<PostMedia> PostMedias { get; set; } = new List<PostMedia>();
        public ICollection<PostTag> PostTags { get; set; } = new List<PostTag>();
        public ICollection<PostCollection> PostCollections { get; set; } = new List<PostCollection>();
        public ICollection<Comment> Comments { get; set; } = new List<Comment>();
        public ICollection<Reaction> Reactions { get; set; } = new List<Reaction>();
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Models/Entities/PostMedia.cs">
namespace Favi_BE.Models.Entities
{
    public class PostMedia
    {
        public Guid Id { get; set; }
        public Guid PostId { get; set; }
        public string Url { get; set; } = null!;
        public string? ThumbnailUrl { get; set; }
        public int Position { get; set; } // th·ª© t·ª± hi·ªÉn th·ªã trong post

        public Post Post { get; set; } = null!;

        public string PublicId { get; set; } = null!; //currently used for Cloudinary
        public int Width { get; set; }
        public int Height { get; set; }
        public string Format { get; set; } = null!;

    }

}
</file>

<file path="Favi-BE/Favi-BE.API/Models/Entities/Profile.cs">
using Favi_BE.Models.Entities.JoinTables;
using Favi_BE.Models.Enums;
using Microsoft.Extensions.Hosting;
using System.Xml.Linq;

namespace Favi_BE.Models.Entities
{
    public class Profile
    {
        public Guid Id { get; set; }
        public string Username { get; set; } = null!;
        public string? DisplayName { get; set; }
        public string? AvatarUrl { get; set; }
        public string? CoverUrl { get; set; }
        public string? Bio { get; set; }
        public UserRole Role { get; set; } = UserRole.User;
        public DateTime CreatedAt { get; set; }
        public DateTime? LastActiveAt { get; set; }
        public PrivacyLevel PrivacyLevel { get; set; } = PrivacyLevel.Public;
        public PrivacyLevel FollowPrivacyLevel { get; set; } = PrivacyLevel.Public;
        // Navigation
        public ICollection<SocialLink> SocialLinks { get; set; } = new List<SocialLink>();
        public ICollection<Collection> Collections { get; set; } = new List<Collection>();
        public ICollection<Post> Posts { get; set; } = new List<Post>();
        public ICollection<Comment> Comments { get; set; } = new List<Comment>();
        public ICollection<Reaction> Reactions { get; set; } = new List<Reaction>();
        public ICollection<Report> Reports { get; set; } = new List<Report>();
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Models/Entities/Report.cs">
using Favi_BE.Models.Enums;

namespace Favi_BE.Models.Entities
{
    public class Report
    {
        public Guid Id { get; set; }
        public Guid ReporterId { get; set; }
        public ReportTarget TargetType { get; set; }
        public Guid TargetId { get; set; }
        public string? Reason { get; set; }
        public ReportStatus Status { get; set; } = ReportStatus.Pending;
        public DateTime CreatedAt { get; set; }
        public DateTime? ActedAt { get; set; }
        public string? Data { get; set; }  // JSON

        public Profile? Reporter { get; set; }
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Models/Entities/SocialLink.cs">
using Favi_BE.Models.Enums;

namespace Favi_BE.Models.Entities
{
    public class SocialLink
    {
        public Guid Id { get; set; }
        public Guid ProfileId { get; set; }
        public SocialKind Kind { get; set; }
        public string Url { get; set; } = null!;
        public DateTime CreatedAt { get; set; }

        public Profile Profile { get; set; } = null!;
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Models/Entities/Tag.cs">
using Favi_BE.Models.Entities.JoinTables;

namespace Favi_BE.Models.Entities
{
    public class Tag
    {
        public Guid Id { get; set; }
        public string Name { get; set; } = null!;
        public ICollection<PostTag> PostTags { get; set; } = new List<PostTag>();
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Models/Enums/NotificationType.cs">
namespace Favi_BE.Models.Enums
{
    public enum NotificationType { Like, Comment, Follow, System }
}
</file>

<file path="Favi-BE/Favi-BE.API/Models/Enums/PrivacyLevel.cs">
namespace Favi_BE.Models.Enums
{
    public enum PrivacyLevel
    {
        Public, 
        Followers,
        Private
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Models/Enums/ReactionType.cs">
namespace Favi_BE.Models.Enums
{
    public enum ReactionType
    {
        Like,
        Love,
        Haha,
        Wow,
        Sad,
        Angry
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Models/Enums/ReportStatus.cs">
namespace Favi_BE.Models.Enums
{
    public enum ReportStatus
    {
        Pending,
        Resolved,
        Rejected
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Models/Enums/ReportTarget.cs">
namespace Favi_BE.Models.Enums
{
    public enum ReportTarget
    {
        User,
        Post,
        Comment,
        Message,
        Collection
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Models/Enums/SocialKind.cs">
namespace Favi_BE.Models.Enums
{
    public enum SocialKind
    {
        Website,
        Facebook,
        Instagram,
        Twitter,
        Tiktok,
        Youtube,
        Github,
        LinkedIn
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Models/Enums/UserRole.cs">
namespace Favi_BE.Models.Enums
{
    public enum UserRole
    {
        User,
        Moderator,
        Admin
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Program.cs">
using Favi_BE.Common;
using Favi_BE.Data;
using Favi_BE.Data.Repositories;
using Favi_BE.Interfaces;
using Favi_BE.Interfaces.Repositories;
using Favi_BE.Interfaces.Services;
using Favi_BE.Models.Dtos;
using Favi_BE.Services;
using Microsoft.AspNetCore.Authentication.JwtBearer;
using Microsoft.EntityFrameworkCore;
using Microsoft.IdentityModel.Tokens;
using Scalar.AspNetCore;
using System.Text;

var builder = WebApplication.CreateBuilder(args);

builder.Services.Configure<JwtOptions>(builder.Configuration.GetSection("Jwt"));
var jwtOpt = builder.Configuration.GetSection("Jwt").Get<JwtOptions>()!;

builder.Services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme)
    .AddJwtBearer(options =>
    {
        //options.Authority = builder.Configuration["Supabase:Url"]; // https://<project>.supabase.co
        options.TokenValidationParameters = new TokenValidationParameters
        {
            ValidateIssuer = false, // Supabase tokens kh√¥ng c√≥ issuer chu·∫©n
            ValidateAudience = false,
            ValidateLifetime = true,
            ValidateIssuerSigningKey = true, // Supabase cung c·∫•p JWKS ƒë·ªÉ ASP.NET t·ª± fetch
            IssuerSigningKey = new SymmetricSecurityKey(
                Encoding.UTF8.GetBytes(builder.Configuration["SupabaseSecret"]!)),
            NameClaimType = "sub",
            RoleClaimType = "account_role"
        }; 
        options.Events = new JwtBearerEvents
        {
            OnAuthenticationFailed = context =>
            {
                Console.WriteLine("JWT auth failed: " + context.Exception.Message);
                return Task.CompletedTask;
            },
            OnTokenValidated = context =>
            {
                var claims = context.Principal?.Claims.Select(c => $"{c.Type}:{c.Value}");
                Console.WriteLine("Token validated: " + string.Join(", ", claims ?? []));
                return Task.CompletedTask;
            }
        };
    });
builder.Services.AddAuthorization(options =>
{
    options.AddPolicy("RequireUser", policy => policy.RequireClaim("account_role", "user"));
    options.AddPolicy("RequireAdmin", policy => policy.RequireClaim("account_role", "admin"));
});
builder.Services.AddCors(opt =>
{
    opt.AddDefaultPolicy(p => p
        .WithOrigins("http://localhost:3000", "http://localhost:*")
        .AllowAnyHeader().AllowAnyMethod().AllowCredentials());
});
builder.Services.AddScoped<IUnitOfWork, UnitOfWork>();
builder.Services.AddScoped<ICollectionRepository, CollectionRepository>();
builder.Services.AddScoped<ICommentRepository, CommentRepository>();
builder.Services.AddScoped<IFollowRepository, FollowRepository>();
builder.Services.AddScoped<IPostCollectionRepository, PostCollectionRepository>();
builder.Services.AddScoped<IPostMediaRepository, PostMediaRepository>();
builder.Services.AddScoped<IPostRepository, PostRepository>();
builder.Services.AddScoped<IPostTagRepository, PostTagRepository>();
builder.Services.AddScoped<IProfileRepository, ProfileRepository>();
builder.Services.AddScoped<IReactionRepository, ReactionRepository>();
builder.Services.AddScoped<IReportRepository, ReportRepository>();
builder.Services.AddScoped<ISocialLinkRepository, SocialLinkRepository>();
builder.Services.AddScoped<ITagRepository, TagRepository>();

builder.Services.AddScoped<IJwtService, JwtService>();
builder.Services.AddScoped<ICloudinaryService, CloudinaryService>();
builder.Services.AddHttpClient<ISupabaseAuthService, SupabaseAuthService>(client =>
{
    client.BaseAddress = new Uri(builder.Configuration["Supabase:Url"]);
    client.DefaultRequestHeaders.Add("apikey", builder.Configuration["Supabase:ApiKey"]);
});
builder.Services.AddScoped<ICollectionService, CollectionService>();
builder.Services.AddScoped<ICommentService, CommentService>();
builder.Services.AddScoped<IPostService, PostService>();
builder.Services.AddScoped<IProfileService, ProfileService>();
builder.Services.AddScoped<IReportService, ReportService>();
builder.Services.AddScoped<ISearchService, SearchService>();
builder.Services.AddScoped<ITagService, TagService>();
builder.Services.AddScoped<IPrivacyGuard, PrivacyGuard>();
builder.Services.Configure<SupabaseOptions>(builder.Configuration.GetSection("Supabase"));

// Add services to the container.

builder.Services.AddControllers()
    .AddJsonOptions(options =>
    {
        options.JsonSerializerOptions.Converters.Add(new System.Text.Json.Serialization.JsonStringEnumConverter());
    });

// Learn more about configuring OpenAPI at https://aka.ms/aspnet/openapi
builder.Services.AddOpenApi();

builder.Services.AddEndpointsApiExplorer();
//Swagger is not used for this project as of now
//builder.Services.AddSwaggerGen(c =>
//{
//    c.SwaggerDoc("v1", new() { Title = "Favi API", Version = "v1" });
//    c.AddSecurityDefinition("Bearer", new()
//    {
//        In = Microsoft.OpenApi.Models.ParameterLocation.Header,
//        Description = "Enter: Bearer {token}",
//        Name = "Authorization",
//        Type = Microsoft.OpenApi.Models.SecuritySchemeType.Http,
//        Scheme = "bearer",
//        BearerFormat = "JWT"
//    });
//    c.AddSecurityRequirement(new()
//    {
//        {
//            new() { Reference = new() { Type = Microsoft.OpenApi.Models.ReferenceType.SecurityScheme, Id = "Bearer" } },
//            Array.Empty<string>()
//        }
//    });
//});

builder.Services.AddDbContext<AppDbContext>(options =>
    options.UseNpgsql(builder.Configuration.GetConnectionString("Default")));

var app = builder.Build();

//app.UseSwagger(); 
//app.UseSwaggerUI();

app.UseCors();

// Configure the HTTP request pipeline.
if (app.Environment.IsDevelopment())
{
    app.MapOpenApi();
    app.MapScalarApiReference();
}

app.UseHttpsRedirection();

app.UseAuthentication();
app.UseAuthorization();

app.MapControllers();

app.Run();
</file>

<file path="Favi-BE/Favi-BE.API/Properties/launchSettings.json">
{
  "$schema": "https://json.schemastore.org/launchsettings.json",
  "profiles": {
    "http": {
      "commandName": "Project",
      "dotnetRunMessages": true,
      "launchBrowser": false,
      "applicationUrl": "http://localhost:5104",
      "environmentVariables": {
        "ASPNETCORE_ENVIRONMENT": "Development"
      }
    },
    "https": {
      "commandName": "Project",
      "dotnetRunMessages": true,
      "launchBrowser": false,
      "applicationUrl": "https://localhost:7138;http://localhost:5104",
      "environmentVariables": {
        "ASPNETCORE_ENVIRONMENT": "Development"
      }
    }
  }
}
</file>

<file path="Favi-BE/Favi-BE.API/Services/CloudinaryService.cs">
using CloudinaryDotNet;
using CloudinaryDotNet.Actions;
using Favi_BE.Interfaces.Services;
using Favi_BE.Models.Dtos;
using Microsoft.AspNetCore.Http;

namespace Favi_BE.Services
{
    public class CloudinaryService : ICloudinaryService
    {
        private readonly Cloudinary _cloudinary;

        public CloudinaryService(IConfiguration config)
        {
            var section = config.GetSection("Cloudinary");
            var account = new Account(
                section["CloudName"],
                section["ApiKey"],
                section["ApiSecret"]
            );
            _cloudinary = new Cloudinary(account);
        }

        public async Task<PostMediaResponse?> TryUploadAsync(IFormFile file, CancellationToken ct = default)
        {
            try
            {
                await using var stream = file.OpenReadStream();
                var uploadParams = new ImageUploadParams
                {
                    File = new FileDescription(file.FileName, stream),
                    Folder = "favi_posts",
                    Transformation = new Transformation().Quality("auto").FetchFormat("auto")
                };

                var uploadResult = await _cloudinary.UploadAsync(uploadParams, ct);
                if (uploadResult.StatusCode != System.Net.HttpStatusCode.OK)
                    return null; // ‚úÖ b·ªè throw

                // Tr·∫£ v·ªÅ PostMediaResponse; Id/PostId/Position ch∆∞a c√≥ ·ªü b∆∞·ªõc upload ‚Üí set m·∫∑c ƒë·ªãnh
                return new PostMediaResponse(
                    Id: Guid.Empty,
                    PostId: Guid.Empty,
                    Url: uploadResult.SecureUrl.ToString(),
                    PublicId: uploadResult.PublicId,
                    Width: uploadResult.Width,
                    Height: uploadResult.Height,
                    Format: uploadResult.Format,
                    Position: 0,
                    ThumbnailUrl: uploadResult?.Eager?.FirstOrDefault()?.SecureUrl?.ToString()
                );
            }
            catch
            {
                return null; // ‚úÖ an to√†n
            }
        }

        // (Optional) B·∫£n strict n·∫øu b·∫°n v·∫´n mu·ªën d√πng ·ªü ch·ªó kh√°c
        public async Task<PostMediaResponse> UploadAsyncOrThrow(IFormFile file, CancellationToken ct = default)
        {
            await using var stream = file.OpenReadStream();
            var uploadParams = new ImageUploadParams
            {
                File = new FileDescription(file.FileName, stream),
                Folder = "favi_posts",
                Transformation = new Transformation().Quality("auto").FetchFormat("auto")
            };

            var uploadResult = await _cloudinary.UploadAsync(uploadParams, ct);
            if (uploadResult.StatusCode != System.Net.HttpStatusCode.OK)
                throw new Exception("Cloudinary upload failed"); // ‚ö†Ô∏è ch·ªâ d√πng khi b·∫°n th·∫≠t s·ª± mu·ªën throw

            return new PostMediaResponse(
                Id: Guid.Empty,
                PostId: Guid.Empty,
                Url: uploadResult.SecureUrl.ToString(),
                PublicId: uploadResult.PublicId,
                Width: uploadResult.Width,
                Height: uploadResult.Height,
                Format: uploadResult.Format,
                Position: 0,
                ThumbnailUrl: uploadResult?.Eager?.FirstOrDefault()?.SecureUrl?.ToString()
            );
        }
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Services/CollectionService.cs">
using Favi_BE.Interfaces;
using Favi_BE.Interfaces.Services;
using Favi_BE.Models.Dtos;
using Favi_BE.Models.Entities;
using Favi_BE.Models.Enums;
using System.Linq;

namespace Favi_BE.Services
{
    public class CollectionService : ICollectionService
    {
        private readonly IUnitOfWork _uow;

        public CollectionService(IUnitOfWork uow)
        {
            _uow = uow;
        }

        public async Task<CollectionResponse> CreateAsync(Guid ownerId, CreateCollectionRequest dto)
        {
            var collection = new Collection
            {
                Id = Guid.NewGuid(),
                ProfileId = ownerId,
                Title = dto.Title,
                Description = dto.Description,
                CoverImageUrl = dto.CoverImageUrl,
                PrivacyLevel = dto.PrivacyLevel,
                CreatedAt = DateTime.UtcNow,
                UpdatedAt = DateTime.UtcNow
            };
            await _uow.Collections.AddAsync(collection);
            await _uow.CompleteAsync();

            return new CollectionResponse(collection.Id, collection.ProfileId, collection.Title, collection.Description, collection.CoverImageUrl?? string.Empty, collection.PrivacyLevel, collection.CreatedAt, collection.UpdatedAt, new List<Guid>(), 0);
        }

        public async Task<CollectionResponse?> UpdateAsync(Guid collectionId, Guid requesterId, UpdateCollectionRequest dto)
        {
            var collection = await _uow.Collections.GetByIdAsync(collectionId);
            if (collection is null || collection.ProfileId != requesterId) return null;

            if (!string.IsNullOrWhiteSpace(dto.Title)) collection.Title = dto.Title;
            if (!string.IsNullOrWhiteSpace(dto.Description)) collection.Description = dto.Description;
            if (!string.IsNullOrWhiteSpace(dto.CoverImageUrl)) collection.CoverImageUrl = dto.CoverImageUrl;
            collection.PrivacyLevel = dto.PrivacyLevel ?? collection.PrivacyLevel;
            collection.UpdatedAt = DateTime.UtcNow;

            _uow.Collections.Update(collection);
            await _uow.CompleteAsync();

            return new CollectionResponse(collection.Id, collection.ProfileId, collection.Title, collection.Description, collection.CoverImageUrl, collection.PrivacyLevel, collection.CreatedAt, collection.UpdatedAt, new List<Guid>(), 0);
        }

        public async Task<bool> DeleteAsync(Guid collectionId, Guid requesterId)
        {
            var collection = await _uow.Collections.GetByIdAsync(collectionId);
            if (collection is null || collection.ProfileId != requesterId) return false;

            _uow.Collections.Remove(collection);
            await _uow.CompleteAsync();
            return true;
        }

        public async Task<PagedResult<CollectionResponse>> GetByOwnerAsync(Guid ownerId, int page, int pageSize)
        {
            var skip = (page - 1) * pageSize;
            var (collections, total) = await _uow.Collections.GetAllByOwnerPagedAsync(ownerId, skip, pageSize);

            var dtos = collections.Select(c =>
            {
                var postIds = c.PostCollections?.Select(pc => pc.PostId).ToList() ?? new List<Guid>();
                return new CollectionResponse(
                    c.Id,
                    c.ProfileId,
                    c.Title,
                    c.Description,
                    c.CoverImageUrl ?? string.Empty,
                    c.PrivacyLevel,
                    c.CreatedAt,
                    c.UpdatedAt,
                    postIds,
                    postIds.Count
                );
            });

            return new PagedResult<CollectionResponse>(dtos, page, pageSize, total);
        }

        public async Task<CollectionResponse?> GetByIdAsync(Guid collectionId)
        {
            var collection = await _uow.Collections.GetCollectionWithPostsAsync(collectionId);
            if (collection is null) return null;

            var postIds = collection.PostCollections?.Select(pc => pc.PostId) ?? new List<Guid>();
            return new CollectionResponse(collection.Id, collection.ProfileId, collection.Title, collection.Description, collection.CoverImageUrl, collection.PrivacyLevel, collection.CreatedAt, collection.UpdatedAt, postIds, postIds.Count());
        }

        public async Task<bool> AddPostAsync(Guid collectionId, Guid postId, Guid requesterId)
        {
            var collection = await _uow.Collections.GetByIdAsync(collectionId);
            if (collection is null || collection.ProfileId != requesterId) return false;

            if (!await _uow.PostCollections.ExistsInCollectionAsync(postId, collectionId))
            {
                await _uow.PostCollections.AddAsync(new Models.Entities.JoinTables.PostCollection
                {
                    CollectionId = collectionId,
                    PostId = postId
                });
                await _uow.CompleteAsync();
            }

            return true;
        }

        public async Task<bool> RemovePostAsync(Guid collectionId, Guid postId, Guid requesterId)
        {
            var collection = await _uow.Collections.GetByIdAsync(collectionId);
            if (collection is null || collection.ProfileId != requesterId) return false;

            await _uow.PostCollections.RemoveFromCollectionAsync(postId, collectionId);
            await _uow.CompleteAsync();
            return true;
        }

        public async Task<PagedResult<PostResponse>> GetPostsAsync(Guid collectionId, int page, int pageSize)
        {
            var skip = (page - 1) * pageSize;

            var (posts, total) = await _uow.Posts.GetPostsByCollectionPagedAsync(collectionId, skip, pageSize);

            var dtos = posts.Select(p =>
            {
                var medias = p.PostMedias?.Select(m =>
                    new PostMediaResponse(m.Id, m.PostId, m.Url, m.PublicId, m.Width, m.Height, m.Format, m.Position, m.ThumbnailUrl)
                ).ToList() ?? new List<PostMediaResponse>();

                var tags = p.PostTags?.Select(pt =>
                    new TagDto(pt.Tag.Id, pt.Tag.Name)
                ).ToList() ?? new List<TagDto>();

                int totalReactions = p.Reactions?.Count ?? 0;
                var reactionCounts = p.Reactions?
                    .GroupBy(r => r.Type)
                    .ToDictionary(g => g.Key, g => g.Count())
                    ?? new Dictionary<ReactionType, int>();

                ReactionType? userReaction = null; // sau n√†y truy·ªÅn userId hi·ªán t·∫°i v√†o n·∫øu c·∫ßn

                var reactionSummary = new ReactionSummaryDto(totalReactions, reactionCounts, userReaction);

                return new PostResponse(
                    p.Id,
                    p.ProfileId,
                    p.Caption,
                    p.CreatedAt,
                    p.UpdatedAt,
                    p.Privacy,
                    medias,
                    tags,
                    reactionSummary
                );
            });

            return new PagedResult<PostResponse>(dtos, page, pageSize, total);
        }

        public async Task<Collection?> GetEntityByIdAsync(Guid id)
        {
            return await _uow.Collections.GetByIdAsync(id);
        }

    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Services/CommentService.cs">
using Favi_BE.Interfaces;
using Favi_BE.Interfaces.Services;
using Favi_BE.Models.Dtos;
using Favi_BE.Models.Entities;
using System.Linq;

namespace Favi_BE.Services
{
    public class CommentService : ICommentService
    {
        private readonly IUnitOfWork _uow;

        public CommentService(IUnitOfWork uow)
        {
            _uow = uow;
        }

        public async Task<CommentResponse> CreateAsync(Guid postId, Guid authorId, string content, Guid? parentId)
        {
            var comment = new Comment
            {
                Id = Guid.NewGuid(),
                PostId = postId,
                ProfileId = authorId,
                Content = content,
                ParentCommentId = parentId,
                CreatedAt = DateTime.UtcNow,
                UpdatedAt = DateTime.UtcNow
            };

            await _uow.Comments.AddAsync(comment);
            await _uow.CompleteAsync();

            return new CommentResponse(comment.Id, comment.PostId, comment.ProfileId, comment.Content, comment.CreatedAt, comment.UpdatedAt, comment.ParentCommentId);
        }

        public async Task<CommentResponse?> UpdateAsync(Guid commentId, Guid requesterId, string content)
        {
            var comment = await _uow.Comments.GetByIdAsync(commentId);
            if (comment is null || comment.ProfileId != requesterId) return null;

            comment.Content = content;
            comment.UpdatedAt = DateTime.UtcNow;

            _uow.Comments.Update(comment);
            await _uow.CompleteAsync();

            return new CommentResponse(comment.Id, comment.PostId, comment.ProfileId, comment.Content, comment.CreatedAt, comment.UpdatedAt, comment.ParentCommentId);
        }

        public async Task<bool> DeleteAsync(Guid commentId, Guid requesterId)
        {
            var comment = await _uow.Comments.GetByIdAsync(commentId);
            if (comment is null || comment.ProfileId != requesterId) return false;

            _uow.Comments.Remove(comment);
            await _uow.CompleteAsync();
            return true;
        }

        public async Task<PagedResult<CommentResponse>> GetByPostAsync(Guid postId, int page, int pageSize)
        {
            var comments = await _uow.Comments.GetCommentsByPostIdAsync(postId);
            var paged = comments.Skip((page - 1) * pageSize).Take(pageSize);

            var dtos = paged.Select(c => new CommentResponse(c.Id, c.PostId, c.ProfileId, c.Content, c.CreatedAt, c.UpdatedAt, c.ParentCommentId));

            return new PagedResult<CommentResponse>(dtos, page, pageSize, comments.Count());
        }
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Services/JwtService.cs">
using Microsoft.Extensions.Options;
using Microsoft.IdentityModel.Tokens;
using System.IdentityModel.Tokens.Jwt;
using System.Security.Claims;
using System.Text;
using Favi_BE.Common;

namespace Favi_BE.Services
{
    public interface IJwtService
    {
        string CreateAccessToken(int accountId, string role);
        string CreateRefreshToken(int accountId, string role);
        ClaimsPrincipal? ValidateRefresh(string token); 
    }

    public class JwtService : IJwtService
    {
        private readonly JwtOptions _opt;
        private readonly SigningCredentials _cred;
        private readonly TokenValidationParameters _baseValidation;

        public JwtService(IOptions<JwtOptions> opt)
        {
            _opt = opt.Value;
            var key = new SymmetricSecurityKey(Encoding.UTF8.GetBytes(_opt.Key));
            _cred = new SigningCredentials(key, SecurityAlgorithms.HmacSha256);
            _baseValidation = new TokenValidationParameters
            {
                ValidateIssuer = true,
                ValidIssuer = _opt.Issuer,
                ValidateAudience = true,
                ValidAudience = _opt.Audience,
                ValidateIssuerSigningKey = true,
                IssuerSigningKey = key,
                ValidateLifetime = true,
                ClockSkew = TimeSpan.FromSeconds(30),
                RoleClaimType = ClaimTypes.Role
            };
        }

        public string CreateAccessToken(int accountId, string role)
            => CreateToken(accountId, role, "access", TimeSpan.FromMinutes(_opt.AccessMinutes));

        public string CreateRefreshToken(int accountId, string role)
            => CreateToken(accountId, role, "refresh", TimeSpan.FromDays(_opt.RefreshDays));

        private string CreateToken(int accountId, string role, string type, TimeSpan ttl)
        {
            var now = DateTime.UtcNow;
            var jwt = new JwtSecurityToken(
                issuer: _opt.Issuer,
                audience: _opt.Audience,
                claims: new[] {
                new Claim(JwtRegisteredClaimNames.Sub, accountId.ToString()),
                new Claim(ClaimTypes.Role, role),
                new Claim("type", type)
                },
                notBefore: now,
                expires: now.Add(ttl),
                signingCredentials: _cred
            );
            return new JwtSecurityTokenHandler().WriteToken(jwt);
        }

        public ClaimsPrincipal? ValidateRefresh(string token)
        {
            var tvp = _baseValidation.Clone();
            tvp.TokenDecryptionKey = null;
            var handler = new JwtSecurityTokenHandler();
            var principal = handler.ValidateToken(token, tvp, out var _);
            // gi·ªëng Spring: y√™u c·∫ßu claim "type" = refresh  :contentReference[oaicite:6]{index=6}
            if (principal.FindFirst("type")?.Value != "refresh") return null;
            return principal;
        }
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Services/PostService.cs">
using Favi_BE.Interfaces;
using Favi_BE.Interfaces.Services;
using Favi_BE.Models.Dtos;
using Favi_BE.Models.Entities;
using Favi_BE.Models.Entities.JoinTables;
using Favi_BE.Models.Enums;

namespace Favi_BE.Services
{
    public class PostService : IPostService
    {
        private readonly IUnitOfWork _uow;
        private readonly ICloudinaryService _cloudinary;
        private readonly IPrivacyGuard _privacy;
        public PostService(IUnitOfWork uow, ICloudinaryService cloudinary, IPrivacyGuard privacy)
        {
            _uow = uow;
            _cloudinary = cloudinary;
            _privacy = privacy;
        }

        public Task<Post?> GetEntityAsync(Guid id) => _uow.Posts.GetByIdAsync(id);

        // --------------------------------------------------------------------
        // Queries
        // --------------------------------------------------------------------
        public async Task<PostResponse?> GetByIdAsync(Guid id, Guid? currentUserId)
        {
            var post = await _uow.Posts.GetPostWithAllAsync(id);
            if (post is null) return null;

            // L·∫•y tags t·ª´ repo Tags (ho·∫∑c post.PostTags)
            var tags = post.PostTags?.Select(pt => new TagDto(pt.Tag.Id, pt.Tag.Name))
                       ?? Enumerable.Empty<TagDto>();

            // Medias
            var medias = (post.PostMedias ?? new List<PostMedia>())
                .OrderBy(m => m.Position)
                .Select(m => new PostMediaResponse(
                    m.Id,
                    m.PostId,
                    m.Url,
                    PublicId: string.Empty,     // entity hi·ªán kh√¥ng c√≥, ƒë·ªÉ r·ªóng
                    Width: 0,
                    Height: 0,
                    Format: string.Empty,
                    Position: m.Position,
                    ThumbnailUrl: m.ThumbnailUrl
                )).ToList();

            // Reaction summary
            var summary = await BuildReactionSummaryAsync(post.Id, currentUserId);

            return new PostResponse(
                Id: post.Id,
                AuthorProfileId: post.ProfileId,
                Caption: post.Caption,
                CreatedAt: post.CreatedAt,
                UpdatedAt: post.UpdatedAt,
                PrivacyLevel: post.Privacy,
                Medias: medias,
                Tags: tags,
                Reactions: summary
            );
        }

        public async Task<PagedResult<PostResponse>> GetFeedAsync(Guid currentUserId, int page, int pageSize)
        {
            var skip = Math.Max(0, (page - 1) * pageSize);

            var (posts, total) = await _uow.Posts.GetFeedPagedAsync(currentUserId, skip, pageSize);

            // Map
            var items = new List<PostResponse>(total);
            foreach (var p in posts)
            {
                items.Add(await MapPostToResponseAsync(p, currentUserId));
            }
            
            return new PagedResult<PostResponse>(items, page, pageSize, total);
        }

        // --------------------------------------------------------------------
        // Commands: Create/Update/Delete
        // --------------------------------------------------------------------
        public async Task<PostResponse> CreateAsync(Guid authorId, string? caption, IEnumerable<string>? tags)
        {
            var now = DateTime.UtcNow;
            var post = new Post
            {
                Id = Guid.NewGuid(),
                ProfileId = authorId,
                Caption = caption?.Trim(),
                Privacy = PrivacyLevel.Public, // m·∫∑c ƒë·ªãnh, c√≥ th·ªÉ ƒë·ªïi theo nhu c·∫ßu
                CreatedAt = now,
                UpdatedAt = now
            };

            await _uow.Posts.AddAsync(post);

            // Tags: normalize + t·∫°o li√™n k·∫øt
            if (tags != null && tags.Any())
            {
                var createdTags = await _uow.Tags.GetOrCreateTagsAsync(tags);
                foreach (var t in createdTags)
                {
                    await _uow.PostTags.AddTagToPostAsync(post.Id, t.Id);
                }
            }

            await _uow.CompleteAsync();
            // Tr·∫£ v·ªÅ b·∫£n ƒë·∫ßy ƒë·ªß
            var full = await _uow.Posts.GetPostWithAllAsync(post.Id);
            return await MapPostToResponseAsync(full ?? post, authorId);
        }

        public async Task<bool> UpdateAsync(Guid postId, Guid requesterId, string? caption)
        {
            var post = await _uow.Posts.GetByIdAsync(postId);
            if (post is null) return false;
            if (post.ProfileId != requesterId) return false;

            if (caption != null)
                post.Caption = caption.Trim();

            post.UpdatedAt = DateTime.UtcNow;

            _uow.Posts.Update(post);
            await _uow.CompleteAsync();
            return true;
        }

        public async Task<bool> DeleteAsync(Guid postId, Guid requesterId)
        {
            // L·∫•y post + ki·ªÉm tra quy·ªÅn
            var post = await _uow.Posts.GetByIdAsync(postId);
            if (post is null) return false;
            if (post.ProfileId != requesterId) return false;

            // Xo√° media trong Cloudinary n·∫øu c√≥ (entity kh√¥ng l∆∞u PublicId => b·ªè qua cloud delete)
            var medias = await _uow.PostMedia.GetByPostIdAsync(postId);
            _uow.PostMedia.RemoveRange(medias);

            // Xo√° post (c√°c join nh∆∞ PostTags, Reactions, Comments n√™n cascade trong DbContext)
            _uow.Posts.Remove(post);
            /*            await _uow.CompleteAsync();*/

            await _uow.CompleteAsync();

            var orphanTags = await _uow.Tags.GetTagsWithNoPostsAsync();
            foreach (var tag in orphanTags)
            {
                _uow.Tags.Remove(tag);
            }
            await _uow.CompleteAsync();

            return true;
        }

        // --------------------------------------------------------------------
        // Media
        // --------------------------------------------------------------------
        public async Task<IEnumerable<PostMediaResponse>> UploadMediaAsync(Guid postId, IEnumerable<IFormFile> files, Guid requesterId)
        {
            var post = await _uow.Posts.GetByIdAsync(postId);
            if (post is null) return Enumerable.Empty<PostMediaResponse>();
            if (post.ProfileId != requesterId) return Enumerable.Empty<PostMediaResponse>();

            var existing = await _uow.PostMedia.GetByPostIdAsync(postId);
            var nextPos = existing.Any() ? existing.Max(m => m.Position) + 1 : 0;

            var outputs = new List<PostMediaResponse>();
            foreach (var f in files)
            {
                var up = await _cloudinary.TryUploadAsync(f);
                if (up is null) continue;
                var media = new PostMedia
                {
                    Id = Guid.NewGuid(),
                    PostId = postId,
                    Url = up.Url,
                    ThumbnailUrl = up.ThumbnailUrl,
                    Position = nextPos++
                };

                await _uow.PostMedia.AddAsync(media);

                // Map DTO (ƒë·∫ßy ƒë·ªß th√¥ng tin Cloudinary ra ngo√†i)
                outputs.Add(new PostMediaResponse(
                Id: media.Id,
                PostId: media.PostId,
                Url: up.Url,
                PublicId: up.PublicId,
                Width: up.Width,
                Height: up.Height,
                Format: up.Format,
                Position: media.Position,
                ThumbnailUrl: up.ThumbnailUrl));
            }

            await _uow.CompleteAsync();
            return outputs;
        }

        public async Task<bool> RemoveMediaAsync(Guid postId, Guid mediaId, Guid requesterId)
        {
            var post = await _uow.Posts.GetByIdAsync(postId);
            if (post is null) return false;
            if (post.ProfileId != requesterId) return false;

            var medias = await _uow.PostMedia.GetByPostIdAsync(postId);
            var media = medias.FirstOrDefault(m => m.Id == mediaId);
            if (media is null) return false;

            // N·∫øu b·∫°n l∆∞u PublicId ·ªü n∆°i kh√°c, c√≥ th·ªÉ g·ªçi _cloudinary.DeleteAsync(publicId) t·∫°i ƒë√¢y.
            _uow.PostMedia.Remove(media);

            // Re-order position (gi·ªØ th·ª© t·ª± ƒë·∫πp)
            var remain = medias.Where(m => m.Id != mediaId).OrderBy(m => m.Position).ToList();
            for (int i = 0; i < remain.Count; i++)
            {
                if (remain[i].Position != i)
                {
                    remain[i].Position = i;
                    _uow.PostMedia.Update(remain[i]);
                }
            }

            await _uow.CompleteAsync();
            return true;
        }

        // --------------------------------------------------------------------
        // Tags
        // --------------------------------------------------------------------
        public async Task<IEnumerable<TagDto>> AddTagsAsync(Guid postId, IEnumerable<string> tags, Guid requesterId)
        {
            var post = await _uow.Posts.GetByIdAsync(postId);
            if (post is null) return Enumerable.Empty<TagDto>();  
            if (post.ProfileId != requesterId) return Enumerable.Empty<TagDto>(); 

            var created = await _uow.Tags.GetOrCreateTagsAsync(tags);
            foreach (var t in created)
                await _uow.PostTags.AddTagToPostAsync(postId, t.Id);

            await _uow.CompleteAsync();

            var result = await _uow.Tags.GetTagsByPostIdAsync(postId);
            return result.Select(t => new TagDto(t.Id, t.Name));
        }

        public async Task<bool> RemoveTagAsync(Guid postId, Guid tagId, Guid requesterId)
        {
            var post = await _uow.Posts.GetByIdAsync(postId);
            if (post is null) return false;
            if (post.ProfileId != requesterId) return false;

            await _uow.PostTags.RemoveTagFromPostAsync(postId, tagId);
            await _uow.CompleteAsync();
            return true;
        }

        // --------------------------------------------------------------------
        // Reactions
        // --------------------------------------------------------------------
        public async Task<ReactionSummaryDto> GetReactionsAsync(Guid postId, Guid? currentUserId)
        {
            return await BuildReactionSummaryAsync(postId, currentUserId);
        }

        public async Task<ReactionType?> ToggleReactionAsync(Guid postId, Guid userId, ReactionType type)
        {
            var post = await _uow.Posts.GetByIdAsync(postId);
            if (post is null) return null;

            var existing = await _uow.Reactions.GetProfileReactionOnPostAsync(userId, postId);

            // Ch∆∞a c√≥ ‚Üí th√™m
            if (existing is null)
            {
                await _uow.Reactions.AddAsync(new Reaction
                {
                    PostId = postId,
                    ProfileId = userId,
                    Type = type,
                    CreatedAt = DateTime.UtcNow
                });
                await _uow.CompleteAsync();
                return type;
            }

            // C√πng lo·∫°i ‚Üí g·ª°
            if (existing.Type == type)
            {
                _uow.Reactions.Remove(existing);
                await _uow.CompleteAsync();
                return null;
            }

            // Kh√°c lo·∫°i ‚Üí ƒë·ªïi
            existing.Type = type;
            _uow.Reactions.Update(existing);
            await _uow.CompleteAsync();
            return type;
        }

        // --------------------------------------------------------------------
        // Helpers
        // --------------------------------------------------------------------
        private async Task<PostResponse> MapPostToResponseAsync(Post post, Guid? currentUserId)
        {
            // B·∫£o ƒë·∫£m include ƒë·ªß (n·∫øu repo tr·∫£ ch∆∞a ƒë·ªß)
            if (post.PostMedias is null)
                post = await _uow.Posts.GetPostWithAllAsync(post.Id) ?? post;

            var medias = (post.PostMedias ?? new List<PostMedia>())
                .OrderBy(m => m.Position)
                .Select(m => new PostMediaResponse(
                    m.Id,
                    m.PostId,
                    m.Url,
                    PublicId: string.Empty, // entity kh√¥ng c√≥
                    Width: 0,
                    Height: 0,
                    Format: string.Empty,
                    Position: m.Position,
                    ThumbnailUrl: m.ThumbnailUrl
                ));

            var tags = (post.PostTags ?? new List<PostTag>())
                .Select(pt => new TagDto(pt.Tag.Id, pt.Tag.Name));

            var summary = await BuildReactionSummaryAsync(post.Id, currentUserId);

            return new PostResponse(
                Id: post.Id,
                AuthorProfileId: post.ProfileId,
                Caption: post.Caption,
                CreatedAt: post.CreatedAt,
                UpdatedAt: post.UpdatedAt,
                PrivacyLevel: post.Privacy,
                Medias: medias,
                Tags: tags,
                Reactions: summary
            );
        }

        private async Task<ReactionSummaryDto> BuildReactionSummaryAsync(Guid postId, Guid? currentUserId)
        {
            var reactions = await _uow.Reactions.GetReactionsByPostIdAsync(postId);

            var byType = reactions
                .GroupBy(r => r.Type)
                .ToDictionary(g => g.Key, g => g.Count());

            var total = byType.Values.Sum();

            ReactionType? mine = null;
            if (currentUserId.HasValue)
            {
                var my = reactions.FirstOrDefault(r => r.ProfileId == currentUserId.Value);
                if (my != null) mine = my.Type;
            }

            return new ReactionSummaryDto(total, byType, mine);
        }

        public async Task<PagedResult<PostResponse>> GetByProfileAsync(Guid profileId, Guid? viewerId, int page, int pageSize)
        {
            var skip = (page - 1) * pageSize;
            var posts = await _uow.Posts.GetPostsByProfileIdAsync(profileId, skip, pageSize);
            var total = await _uow.Posts.CountAsync(p => p.ProfileId == profileId);

            var result = new List<PostResponse>();
            foreach (var post in posts)
            {
                if (await _privacy.CanViewPostAsync(post, viewerId))
                    result.Add(await MapPostToResponseAsync(post, viewerId));
            }

            return new PagedResult<PostResponse>(result, page, pageSize, total);
        }

        // TODO: Implement these methods
        public Task<PagedResult<PostResponse>> GetExploreAsync(Guid userId, int page, int pageSize)
        {
            throw new NotImplementedException();
        }

        public Task<PagedResult<PostResponse>> GetLatestAsync(int page, int pageSize)
        {
            throw new NotImplementedException();
        }
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Services/PrivacyGuard.cs">
using Favi_BE.Interfaces;
using Favi_BE.Interfaces.Services;
using Favi_BE.Models.Entities;
using Favi_BE.Models.Enums;

namespace Favi_BE.Services
{
    public class PrivacyGuard : IPrivacyGuard
    {
        private readonly IUnitOfWork _uow;
        public PrivacyGuard(IUnitOfWork uow) => _uow = uow;

        // ===== PROFILE =====
        public async Task<bool> CanViewProfileAsync(Profile profile, Guid? viewerId, bool isAdmin = false)
        {
            if (profile == null) return false;
            if (isAdmin) return true;

            var privacy = profile.PrivacyLevel; // N·∫øu ch∆∞a c√≥ property n√†y, m·∫∑c ƒë·ªãnh Public
            if (!viewerId.HasValue) return privacy == PrivacyLevel.Public;
            if (viewerId.Value == profile.Id) return true;

            return privacy switch
            {
                PrivacyLevel.Public => true,
                PrivacyLevel.Followers => await _uow.Follows.IsFollowingAsync(viewerId.Value, profile.Id),
                PrivacyLevel.Private => false,
                _ => false
            };
        }

        // ===== POST =====
        public async Task<bool> CanViewPostAsync(Post post, Guid? viewerId, bool isAdmin = false)
        {
            if (post == null) return false;
            if (isAdmin) return true;

            var ownerId = post.ProfileId;
            if (!viewerId.HasValue) return post.Privacy == PrivacyLevel.Public;
            if (viewerId.Value == ownerId) return true;

            return post.Privacy switch
            {
                PrivacyLevel.Public => true,
                PrivacyLevel.Followers => await _uow.Follows.IsFollowingAsync(viewerId.Value, ownerId),
                PrivacyLevel.Private => false,
                _ => false
            };
        }

        // ===== COLLECTION =====
        public async Task<bool> CanViewCollectionAsync(Collection collection, Guid? viewerId, bool isAdmin = false)
        {
            if (collection == null) return false;
            if (isAdmin) return true;

            var ownerId = collection.ProfileId;
            if (!viewerId.HasValue) return collection.PrivacyLevel == PrivacyLevel.Public;
            if (viewerId.Value == ownerId) return true;

            return collection.PrivacyLevel switch
            {
                PrivacyLevel.Public => true,
                PrivacyLevel.Followers => await _uow.Follows.IsFollowingAsync(viewerId.Value, ownerId),
                PrivacyLevel.Private => false,
                _ => false
            };
        }

        // ===== COMMENT =====
        public async Task<bool> CanViewCommentAsync(Post parentPost, Guid? viewerId, bool isAdmin = false)
        {
            if (parentPost == null) return false;
            // Comment k·∫ø th·ª´a quy·ªÅn t·ª´ Post cha
            return await CanViewPostAsync(parentPost, viewerId, isAdmin);
        }

        // ===== FOLLOW =====
        public async Task<bool> CanFollowAsync(Profile targetProfile, Guid? viewerId, bool isAdmin = false)
        {
            if (targetProfile == null) return false;
            if (isAdmin) return true;

            var privacy = targetProfile.PrivacyLevel; // N·∫øu ch∆∞a c√≥ field n√†y, t·∫°m xem l√† Public
            if (!viewerId.HasValue) return privacy == PrivacyLevel.Public;
            if (viewerId.Value == targetProfile.Id) return false; // Kh√¥ng follow ch√≠nh m√¨nh

            return privacy switch
            {
                PrivacyLevel.Public => true,
                PrivacyLevel.Followers => true, // y√™u c·∫ßu approve sau n√†y
                PrivacyLevel.Private => false,
                _ => false
            };
        }
        public async Task<bool> CanViewFollowListAsync(Profile profile, Guid? viewerId, bool isAdmin = false)
        {
            if (profile == null) return false;
            if (isAdmin) return true;

            var privacy = profile.FollowPrivacyLevel;
            if (!viewerId.HasValue) return privacy == PrivacyLevel.Public;
            if (viewerId.Value == profile.Id) return true;

            return privacy switch
            {
                PrivacyLevel.Public => true,
                PrivacyLevel.Followers => await _uow.Follows.IsFollowingAsync(viewerId.Value, profile.Id),
                PrivacyLevel.Private => false,
                _ => false
            };
        }
        public async Task<bool> CanReportAsync(ReportTarget targetType, Guid targetId, Guid reporterId)
        {
            var targetProfile = await _uow.Profiles.GetByIdAsync(targetId);
            var collection = await _uow.Collections.GetByIdAsync(targetId);
            switch (targetType)
            {
                case ReportTarget.Post:
                    var post = await _uow.Posts.GetByIdAsync(targetId);
                    return post != null && await CanViewPostAsync(post, reporterId);

                case ReportTarget.User:
                    return await CanViewProfileAsync(targetProfile, reporterId);

                case ReportTarget.Comment:
                    var comment = await _uow.Comments.GetByIdAsync(targetId);
                    if (comment == null) return false;
                    var parentPost = await _uow.Posts.GetByIdAsync(comment.PostId);
                    return parentPost != null && await CanViewPostAsync(parentPost, reporterId);

                case ReportTarget.Collection:
                    return await CanViewCollectionAsync(collection, reporterId);

                default:
                    return false;
            }
        }

    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Services/ProfileService.cs">
using Favi_BE.Interfaces;
using Favi_BE.Interfaces.Services;
using Favi_BE.Models.Dtos;
using Favi_BE.Models.Entities;

namespace Favi_BE.Services
{
    public class ProfileService : IProfileService
    {
        private readonly IUnitOfWork _uow;

        public ProfileService(IUnitOfWork uow)
        {
            _uow = uow;
        }

        public async Task<ProfileResponse?> GetByIdAsync(Guid profileId)
        {
            var profile = await _uow.Profiles.GetByIdAsync(profileId);
            if (profile is null) return null;

            var followers = await _uow.Follows.GetFollowersCountAsync(profileId);
            var followings = await _uow.Follows.GetFollowingCountAsync(profileId);

            return new ProfileResponse(
                profile.Id,
                profile.Username,
                profile.DisplayName,
                profile.Bio,
                profile.AvatarUrl,
                profile.CoverUrl,
                profile.CreatedAt,
                profile.LastActiveAt ?? DateTime.MinValue,
                profile.PrivacyLevel,
                profile.FollowPrivacyLevel,
                followers,
                followings
            );
        }

        public async Task<ProfileResponse?> UpdateAsync(Guid profileId, ProfileUpdateRequest dto)
        {
            var profile = await _uow.Profiles.GetByIdAsync(profileId);
            if (profile is null) return null;

            if (!string.IsNullOrWhiteSpace(dto.DisplayName))
                profile.DisplayName = dto.DisplayName;
            if (!string.IsNullOrWhiteSpace(dto.Bio))
                profile.Bio = dto.Bio;
            if (!string.IsNullOrWhiteSpace(dto.AvatarUrl))
                profile.AvatarUrl = dto.AvatarUrl;
            if (!string.IsNullOrWhiteSpace(dto.CoverUrl))
                profile.CoverUrl = dto.CoverUrl;
            if (!string.IsNullOrWhiteSpace(dto.Username) && dto.Username != profile.Username)
                profile.Username = dto.Username;
            if (dto.PrivacyLevel.HasValue)
                profile.PrivacyLevel = dto.PrivacyLevel.Value;
            if (dto.FollowPrivacyLevel.HasValue)
                profile.FollowPrivacyLevel = dto.FollowPrivacyLevel.Value;
            profile.LastActiveAt = DateTime.UtcNow;
            _uow.Profiles.Update(profile);

            await _uow.CompleteAsync();
            return await GetByIdAsync(profileId);
        }

        public async Task<bool> FollowAsync(Guid followerId, Guid followeeId)
        {
            if (followerId == followeeId) return false;
            if (await _uow.Follows.IsFollowingAsync(followerId, followeeId)) return true;

            await _uow.Follows.AddAsync(new Models.Entities.JoinTables.Follow
            {
                FollowerId = followerId,
                FolloweeId = followeeId,
                CreatedAt = DateTime.UtcNow
            });
            await _uow.CompleteAsync();
            return true;
        }

        public async Task<bool> UnfollowAsync(Guid followerId, Guid followeeId)
        {
            var follow = await _uow.Follows.GetAsync(followerId, followeeId);
            if (follow is null) return false;

            _uow.Follows.Remove(follow);
            await _uow.CompleteAsync();
            return true;
        }

        public async Task<IEnumerable<FollowResponse>> GetFollowersAsync(Guid profileId)
        {
            var result = await _uow.Follows.GetFollowersAsync(profileId, 0, 1000);
            return result.Select(f => new FollowResponse(f.FollowerId, f.FolloweeId, f.CreatedAt));
        }

        public async Task<IEnumerable<FollowResponse>> GetFollowersAsync(Guid profileId, int skip, int take)
        {
            var result = await _uow.Follows.GetFollowersAsync(profileId, skip, take);
            return result.Select(f => new FollowResponse(f.FollowerId, f.FolloweeId, f.CreatedAt));
        }

        public async Task<IEnumerable<FollowResponse>> GetFollowingsAsync(Guid profileId, int skip, int take)
        {
            var result = await _uow.Follows.GetFollowingAsync(profileId, skip, take);
            return result.Select(f => new FollowResponse(f.FollowerId, f.FolloweeId, f.CreatedAt));
        }
        public async Task<IEnumerable<FollowResponse>> GetFollowingsAsync(Guid profileId)
        {
            var result = await _uow.Follows.GetFollowingAsync(profileId, 0, 1000);
            return result.Select(f => new FollowResponse(f.FollowerId, f.FolloweeId, f.CreatedAt));
        }
        public async Task<IEnumerable<SocialLinkDto>> GetSocialLinksAsync(Guid profileId)
        {
            var links = await _uow.SocialLinks.GetByProfileIdAsync(profileId);
            return links.Select(l => new SocialLinkDto(l.Id, l.Kind, l.Url));
        }

        public async Task<SocialLinkDto> AddSocialLinkAsync(Guid profileId, SocialLinkDto dto)
        {
            var entity = new SocialLink
            {
                Id = Guid.NewGuid(),
                ProfileId = profileId,
                Kind = dto.SocialKind,
                Url = dto.Url,
                CreatedAt = DateTime.UtcNow
            };
            await _uow.SocialLinks.AddAsync(entity);
            await _uow.CompleteAsync();

            return new SocialLinkDto(entity.Id, entity.Kind, entity.Url);
        }

        public async Task<bool> RemoveSocialLinkAsync(Guid profileId, Guid linkId)
        {
            var link = await _uow.SocialLinks.GetByIdAsync(linkId);
            if (link is null || link.ProfileId != profileId) return false;

            _uow.SocialLinks.Remove(link);
            await _uow.CompleteAsync();
            return true;
        }
        public async Task<Profile> CreateProfileAsync(Guid id, string username, string? displayName)
        {
            var profile = new Profile
            {
                Id = id,
                Username = username,
                DisplayName = displayName ?? username,
                CreatedAt = DateTime.UtcNow,
                LastActiveAt = DateTime.UtcNow
            };
            await _uow.Profiles.AddAsync(profile);
            await _uow.CompleteAsync();
            return profile;
        }

        public async Task<bool> DeleteAsync(Guid profileId)
        {
            var profile = await _uow.Profiles.GetByIdAsync(profileId);
            if (profile is null) return false;
            _uow.Profiles.Remove(profile);
            await _uow.CompleteAsync();
            return true;
        }

        public async Task<Profile?> GetEntityByIdAsync(Guid profileId)
        {
            return await _uow.Profiles.GetByIdAsync(profileId);
        }

        public async Task<bool> CheckValidUsername(string username)
        {
            return await _uow.Profiles.IsUsernameUniqueAsync(username);
        }
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Services/ReportService.cs">
using Favi_BE.Interfaces;
using Favi_BE.Interfaces.Services;
using Favi_BE.Models.Dtos;
using Favi_BE.Models.Entities;
using Favi_BE.Models.Enums;
using System.Linq;

namespace Favi_BE.Services
{
    public class ReportService : IReportService
    {
        private readonly IUnitOfWork _uow;

        public ReportService(IUnitOfWork uow)
        {
            _uow = uow;
        }

        public async Task<ReportResponse> CreateAsync(CreateReportRequest dto)
        {
            var report = new Report
            {
                Id = Guid.NewGuid(),
                ReporterId = dto.ReporterProfileId,
                TargetType = dto.TargetType,
                TargetId = dto.TargetId,
                Reason = dto.Reason,
                Status = ReportStatus.Pending,
                CreatedAt = DateTime.UtcNow
            };

            await _uow.Reports.AddAsync(report);
            await _uow.CompleteAsync();

            return new ReportResponse(report.Id, report.ReporterId, report.TargetType, report.TargetId, report.Reason, report.Status, report.CreatedAt, report.ActedAt, report.Data);
        }

        public async Task<PagedResult<ReportResponse>> GetAllAsync(int page, int pageSize)
        {
            var reports = await _uow.Reports.GetAllAsync();
            var total = reports.Count();
            var paged = reports.Skip((page - 1) * pageSize).Take(pageSize);

            var dtos = paged.Select(r => new ReportResponse(r.Id, r.ReporterId, r.TargetType, r.TargetId, r.Reason?? string.Empty, r.Status, r.CreatedAt, r.ActedAt, r.Data));
            return new PagedResult<ReportResponse>(dtos, page, pageSize, total);
        }

        public async Task<bool> UpdateStatusAsync(Guid reportId, UpdateReportStatusRequest dto)
        {
            var report = await _uow.Reports.GetByIdAsync(reportId);
            if (report is null) return false;

            report.Status = dto.NewStatus;
            report.ActedAt = DateTime.UtcNow;

            _uow.Reports.Update(report);
            await _uow.CompleteAsync();
            return true;
        }

        public async Task<PagedResult<ReportResponse>> GetReportsByReporterIdAsync(Guid reporterId, int page, int pageSize)
        {
            var skip = (page - 1) * pageSize;
            var (reports, total) = await _uow.Reports.GetReportsByReporterIdPagedAsync(reporterId, skip, pageSize);
            var dtos = reports.Select(r => new ReportResponse(r.Id, r.ReporterId, r.TargetType, r.TargetId, r.Reason ?? string.Empty, r.Status, r.CreatedAt, r.ActedAt, r.Data));
            return new PagedResult<ReportResponse>(dtos, page, pageSize, total);
        }
        public async Task<PagedResult<ReportResponse>> GetReportsByTargetTypeAsync(ReportTarget reportTarget, int page, int pageSize)
        {
            var skip = (page - 1) * pageSize;
            var (reports, total) = await _uow.Reports.GetReportsByTargetTypePagedAsync(reportTarget, skip, pageSize);
            var dtos = reports.Select(r => new ReportResponse(r.Id, r.ReporterId, r.TargetType, r.TargetId, r.Reason ?? string.Empty, r.Status, r.CreatedAt, r.ActedAt, r.Data));
            return new PagedResult<ReportResponse>(dtos, page, pageSize, total);
        }
        public async Task<PagedResult<ReportResponse>> GetReportsByTargetIdAsync(Guid targetId, int page, int pageSize)
        {
            var skip = (page - 1) * pageSize;
            var (reports, total) = await _uow.Reports.GetReportsByTargetIdPagedAsync(targetId, skip, pageSize);
            var dtos = reports.Select(r => new ReportResponse(r.Id, r.ReporterId, r.TargetType, r.TargetId, r.Reason ?? string.Empty, r.Status, r.CreatedAt, r.ActedAt, r.Data));
            return new PagedResult<ReportResponse>(dtos, page, pageSize, total);
        }
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Services/SearchService.cs">
using Favi_BE.Interfaces;
using Favi_BE.Interfaces.Services;
using Favi_BE.Models.Dtos;

namespace Favi_BE.Services
{
    public class SearchService : ISearchService
    {
        private readonly IUnitOfWork _uow;

        public SearchService(IUnitOfWork uow)
        {
            _uow = uow;
        }

        public async Task<SearchResult> SearchAsync(SearchRequest dto)
        {
            var query = dto.Query.Trim().ToLowerInvariant();

            // Search posts (caption contains)
            var posts = await _uow.Posts.GetAllAsync();
            var matchedPosts = posts
                .Where(p => p.Caption != null && p.Caption.ToLower().Contains(query))
                .Skip((dto.Page - 1) * dto.PageSize)
                .Take(dto.PageSize)
                .Select(p => new SearchPostDto(p.Id, p.Caption ?? string.Empty, p.PostMedias?.FirstOrDefault()?.Url ?? string.Empty));

            // Search tags (name contains)
            var tags = await _uow.Tags.GetAllAsync();
            var matchedTags = tags
                .Where(t => t.Name.Contains(query))
                .Select(t => new SearchTagDto(t.Id, t.Name, 0));

            return new SearchResult(matchedPosts, matchedTags);
        }
    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Services/SupabaseAuthService.cs">
using Favi_BE.Interfaces.Services;
using Favi_BE.Models.Dtos;
using Microsoft.Extensions.Options;
using System.Text;
using System.Text.Json;

namespace Favi_BE.Services
{
    public class SupabaseAuthService : ISupabaseAuthService
    {
        private readonly HttpClient _httpClient;
        private readonly SupabaseOptions _options;

        public SupabaseAuthService(HttpClient httpClient, IOptions<SupabaseOptions> options)
        {
            _httpClient = httpClient;
            _options = options.Value;

            /*_httpClient.BaseAddress = new Uri(_options.Url);
            _httpClient.DefaultRequestHeaders.Add("apikey", _options.ApiKey);*/
        }

        public async Task<SupabaseAuthResponse?> RegisterAsync(string email, string password, string username)
        {
            var body = new
            {
                email,
                password,
                data = new { username }
            };
            var content = new StringContent(JsonSerializer.Serialize(body), Encoding.UTF8, "application/json");
            var response = await _httpClient.PostAsync("/auth/v1/signup", content);
            if (!response.IsSuccessStatusCode) return null;

            var json = await response.Content.ReadAsStringAsync();
            return JsonSerializer.Deserialize<SupabaseAuthResponse>(json, new JsonSerializerOptions { PropertyNameCaseInsensitive = true });
        }

        public async Task<SupabaseAuthResponse?> LoginAsync(string email, string password)
        {
            var body = new { email, password };
            var content = new StringContent(JsonSerializer.Serialize(body), Encoding.UTF8, "application/json");
            var response = await _httpClient.PostAsync("/auth/v1/token?grant_type=password", content);
            if (!response.IsSuccessStatusCode) return null;

            var json = await response.Content.ReadAsStringAsync();
            return JsonSerializer.Deserialize<SupabaseAuthResponse>(json, new JsonSerializerOptions { PropertyNameCaseInsensitive = true });
        }

        public async Task<SupabaseAuthResponse?> RefreshAsync(string refreshToken)
        {
            var body = new { refresh_token = refreshToken };
            var content = new StringContent(JsonSerializer.Serialize(body), Encoding.UTF8, "application/json");

            var response = await _httpClient.PostAsync("/auth/v1/token?grant_type=refresh_token", content);
            if (!response.IsSuccessStatusCode) return null;

            var json = await response.Content.ReadAsStringAsync();
            return JsonSerializer.Deserialize<SupabaseAuthResponse>(json,
                new JsonSerializerOptions { PropertyNameCaseInsensitive = true });
        }

    }
}
</file>

<file path="Favi-BE/Favi-BE.API/Services/TagService.cs">
using Favi_BE.Interfaces;
using Favi_BE.Interfaces.Services;
using Favi_BE.Models.Dtos;
using Favi_BE.Models.Entities;
using System.Linq;

namespace Favi_BE.Services
{
    public class TagService : ITagService
    {
        private readonly IUnitOfWork _uow;

        public TagService(IUnitOfWork uow)
        {
            _uow = uow;
        }

        public async Task<TagResponse> CreateAsync(string name)
        {
            var normalized = name.Trim().ToLowerInvariant();
            var tag = await _uow.Tags.GetByNameAsync(normalized);
            if (tag is null)
            {
                tag = new Tag { Id = Guid.NewGuid(), Name = normalized};
                await _uow.Tags.AddAsync(tag);
                await _uow.CompleteAsync();
            }

            return new TagResponse(tag.Id, tag.Name, 0);
        }

        public async Task<IEnumerable<TagResponse>> GetAllAsync()
        {
            var tags = await _uow.Tags.GetAllAsync();
            return tags.Select(t => new TagResponse(t.Id, t.Name, 0));
        }

        public async Task<PagedResult<TagResponse>> GetAllPagedAsync(int page, int pageSize)
        {
            var skip = (page - 1) * pageSize;
            var (tags, totalCount) = await _uow.Tags.GetAllPagedAsync(skip, pageSize);
            var dtos = tags.Select(t => new TagResponse(t.Id, t.Name, 0));
            return new PagedResult<TagResponse>(dtos, page, pageSize, totalCount);
        }

        public async Task<TagResponse?> GetByIdAsync(Guid id)
        {
            var tag = await _uow.Tags.GetByIdAsync(id);
            if (tag is null) return null;
            return new TagResponse(tag.Id, tag.Name, 0);
        }

        public Task<IEnumerable<TagResponse>> GetOrCreateTagsAsync(IEnumerable<string> names)
        {
            throw new NotImplementedException();
        }

        public async Task<PagedResult<PostResponse>> GetPostsByTagAsync(Guid tagId, int page, int pageSize)
        {
            var skip = (page - 1) * pageSize;

            // L·∫•y danh s√°ch b√†i vi·∫øt v√† t·ªïng s·ªë b√†i
            var (posts, total) = await _uow.Posts.GetPostsByTagPagedAsync(tagId, skip, pageSize);

            var dtos = posts.Select(p =>
            {
                // ‚úÖ Map media
                var medias = p.PostMedias?.Select(m =>
                    new PostMediaResponse(
                        m.Id,
                        m.PostId,
                        m.Url,
                        m.PublicId,
                        m.Width,
                        m.Height,
                        m.Format,
                        m.Position,
                        m.ThumbnailUrl
                    )
                ).ToList() ?? new List<PostMediaResponse>();

                // ‚úÖ Map tags
                var tags = p.PostTags?.Select(pt =>
                    new TagDto(
                        pt.Tag.Id,
                        pt.Tag.Name
                    )
                ).ToList() ?? new List<TagDto>();

                // ‚úÖ Map reactions
                int totalReactions = p.Reactions?.Count ?? 0;
                var reactionCounts = p.Reactions?
                    .GroupBy(r => r.Type)
                    .ToDictionary(g => g.Key, g => g.Count())
                    ?? new Dictionary<Favi_BE.Models.Enums.ReactionType, int>();

                // N·∫øu b·∫°n ch∆∞a c√≥ context ng∆∞·ªùi d√πng hi·ªán t·∫°i, ƒë·ªÉ null
                Favi_BE.Models.Enums.ReactionType? userReaction = null;

                var reactionSummary = new ReactionSummaryDto(
                    totalReactions,
                    reactionCounts,
                    userReaction
                );

                // ‚úÖ Map sang PostResponse ƒë·∫ßy ƒë·ªß
                return new PostResponse(
                    p.Id,
                    p.ProfileId,
                    p.Caption,
                    p.CreatedAt,
                    p.UpdatedAt,
                    p.Privacy,
                    medias,
                    tags,
                    reactionSummary
                );
            });

            return new PagedResult<PostResponse>(dtos, page, pageSize, total);
        }


    }
}
</file>

<file path="Favi-BE/FaviBE.Dockerfile">
# FaviBE.Dockerfile
FROM mcr.microsoft.com/dotnet/sdk:9.0 AS build
ARG PROJECT=Favi-BE.API/Favi-BE.API.csproj    # ‚Üê ƒë·ªïi m·∫∑c ƒë·ªãnh cho kh·ªõp
ARG CONFIG=Release

WORKDIR /src
COPY . .

RUN echo "Project = $PROJECT" \
 && dotnet restore "$PROJECT" \
 && dotnet publish "$PROJECT" -c $CONFIG -o /app/publish /p:UseAppHost=false

FROM mcr.microsoft.com/dotnet/aspnet:9.0
WORKDIR /app
COPY --from=build /app/publish .
ENV ASPNETCORE_URLS=http://+:8080
EXPOSE 8080
ENTRYPOINT ["dotnet", "Favi-BE.API.dll"]
</file>

<file path="Vector-index-api/main.py">
import uuid, time, os, io
from collections import defaultdict, deque
from typing import Optional, List
from fastapi import FastAPI, HTTPException, Request, Depends
from pydantic import BaseModel, Field
import httpx

import torch
import torch.nn.functional as F
import open_clip
from PIL import Image
import requests

from qdrant_client import QdrantClient
from qdrant_client.http.models import VectorParams, Distance, Filter, FieldCondition, MatchAny, MatchValue, SearchParams

QDRANT_URL = os.getenv("QDRANT_URL", "http://localhost:6333")
FRIENDS_URL = os.getenv("FRIENDS_URL", "http://localhost:8002")
COLLECTION = os.getenv("COLLECTION_NAME", "posts_demo")
MODEL_NAME = os.getenv("MODEL_NAME", "ViT-B-32")
PRETRAINED = os.getenv("PRETRAINED", "openai")

RL_SEARCH = int(os.getenv("RL_SEARCH_PER_MIN", "60"))
RL_POST = int(os.getenv("RL_POST_PER_MIN", "20"))
RL_BULK = int(os.getenv("RL_BULK_PER_MIN", "6"))
BULK_EMBED_BATCH = int(os.getenv("BULK_EMBED_BATCH", "32"))

app = FastAPI(title="Multimodal Retrieval API (Monolith)", version="2.0")

device = "cuda" if torch.cuda.is_available() else "cpu"
model, _, preprocess = open_clip.create_model_and_transforms(MODEL_NAME, pretrained=PRETRAINED)
tokenizer = open_clip.get_tokenizer(MODEL_NAME)
model = model.to(device).eval()

def l2_normalize(x: torch.Tensor) -> torch.Tensor:
    return F.normalize(x, p=2, dim=-1)

def encode_text_vec(text: str):
    with torch.no_grad():
        toks = tokenizer([text]).to(device)
        z = model.encode_text(toks)
        z = l2_normalize(z)
    return z[0].detach().cpu().numpy().tolist()

def encode_image_vec(image_url: str):
    resp = requests.get(image_url, timeout=15)
    resp.raise_for_status()
    img = Image.open(io.BytesIO(resp.content)).convert("RGB")
    with torch.no_grad():
        x = preprocess(img).unsqueeze(0).to(device)
        z = model.encode_image(x)
        z = l2_normalize(z)
    return z[0].detach().cpu().numpy().tolist()

def encode_post_vec(image_url: str, caption: str, alpha: float):
    resp = requests.get(image_url, timeout=15)
    resp.raise_for_status()
    img = Image.open(io.BytesIO(resp.content)).convert("RGB")
    with torch.no_grad():
        x = preprocess(img).unsqueeze(0).to(device)
        zi = model.encode_image(x)
        zi = l2_normalize(zi)
        if caption and caption.strip():
            toks = tokenizer([caption]).to(device)
            zt = model.encode_text(toks)
            zt = l2_normalize(zt)
        else:
            zt = torch.zeros_like(zi)
        a = float(alpha)
        z = l2_normalize(a * zi + (1 - a) * zt)
    return z[0].detach().cpu().numpy().tolist()

client = QdrantClient(url=QDRANT_URL)

def ensure_collection():
    collections = [c.name for c in client.get_collections().collections]
    if COLLECTION not in collections:
        client.create_collection(
            collection_name=COLLECTION,
            vectors_config=VectorParams(size=512, distance=Distance.COSINE)
        )

ensure_collection()

class Limiter:
    def __init__(self, max_per_min: int):
        self.max = max_per_min
        self.buckets = defaultdict(deque)

    def allow(self, key: str) -> bool:
        now = time.time()
        dq = self.buckets[key]
        while dq and now - dq[0] > 60:
            dq.popleft()
        if len(dq) >= self.max:
            return False
        dq.append(now)
        return True

limiter_search = Limiter(RL_SEARCH)
limiter_post = Limiter(RL_POST)
limiter_bulk = Limiter(RL_BULK)

def rate_limit(limiter: Limiter):
    async def dep(request: Request):
        user_id = request.query_params.get("user_id") or request.headers.get("X-User-Id") or ""
        ip = request.client.host if request.client else "unknown"
        key = user_id or ip
        if not limiter.allow(key):
            raise HTTPException(429, "Rate limit exceeded")
    return dep

class PostIn(BaseModel):
    post_id: str = Field(..., description="ID b√†i vi·∫øt")
    owner_id: str = Field(..., description="ID owner")
    privacy: str = Field(..., pattern="^(Public|Followers|Private)$")
    image_url: str
    caption: Optional[str] = ""
    alpha: float = 0.5

class BulkIn(BaseModel):
    items: List[PostIn]
    batch_size: Optional[int] = None

class SearchOut(BaseModel):
    post_id: str
    owner_id: str
    privacy: str
    link: str
    caption: str
    score: float

async def get_friends(user_id: str) -> List[str]:
    if not user_id:
        return []
    async with httpx.AsyncClient(timeout=10) as sx:
        resp = await sx.get(f"{FRIENDS_URL}/friends/{user_id}")
    if resp.status_code != 200:
        return []
    return resp.json().get("friends", [])

def to_point_id(post_id: str) -> str:
    try:
        return str(uuid.UUID(post_id))
    except ValueError:
        return str(uuid.uuid5(uuid.NAMESPACE_DNS, post_id))

@app.get("/healthz")
async def healthz():
    return {"ok": True}

@app.get("/depsz")
async def depsz():
    try:
        _ = client.get_collections()
        return {"ok": True}
    except Exception as e:
        raise HTTPException(status_code=503, detail=str(e))

@app.post("/posts", dependencies=[Depends(rate_limit(limiter_post))])
async def index_post(body: PostIn):
    ensure_collection()
    vec = encode_post_vec(body.image_url, body.caption or "", body.alpha)
    payload = {
        "post_id": body.post_id,
        "owner_id": body.owner_id,
        "privacy": body.privacy,
        "link": body.image_url,
        "caption": body.caption or ""
    }
    client.upsert(
        collection_name=COLLECTION,
        points=[{
            "id": to_point_id(body.post_id),
            "vector": vec,
            "payload": payload
        }]
    )
    return {"ok": True, "post_id": body.post_id}

@app.post("/bulk_posts", dependencies=[Depends(rate_limit(limiter_bulk))])
async def bulk_posts(body: BulkIn):
    ensure_collection()
    items = body.items or []
    bsz = body.batch_size or BULK_EMBED_BATCH
    if bsz <= 0:
        bsz = 32
    inserted = 0
    for i in range(0, len(items), bsz):
        chunk = items[i:i+bsz]
        vectors, payloads, ids = [], [], []
        for p in chunk:
            vec = encode_post_vec(p.image_url, p.caption or "", p.alpha)
            vectors.append(vec)
            payloads.append({
                "post_id": p.post_id,
                "owner_id": p.owner_id,
                "privacy": p.privacy,
                "link": p.image_url,
                "caption": p.caption or ""
            })
            ids.append(to_point_id(p.post_id))
        client.upsert(
            collection_name=COLLECTION,
            points=[{"id": i, "vector": v, "payload": pl} for i, v, pl in zip(ids, vectors, payloads)]
        )
        inserted += len(chunk)
    return {"ok": True, "inserted": inserted, "batch_size": bsz}

@app.get("/search", response_model=List[SearchOut], dependencies=[Depends(rate_limit(limiter_search))])
async def search(user_id: Optional[str] = None, q: str = "", k: int = 10):
    ensure_collection()
    qvec = encode_text_vec(q or "")
    friends: List[str] = await get_friends(user_id) if user_id else []

    should = []
    should.append(FieldCondition(key="privacy", match=MatchValue(value="Public")))
    if user_id:
        should.append(Filter(must=[
            FieldCondition(key="privacy", match=MatchValue(value="Private")),
            FieldCondition(key="owner_id", match=MatchValue(value=user_id)),
        ]))
    if user_id and friends:
        should.append(Filter(must=[
            FieldCondition(key="privacy", match=MatchValue(value="Followers")),
            FieldCondition(key="owner_id", match=MatchAny(any=friends + [user_id])),
        ]))

    query_filter = Filter(should=should) if should else None

    res = client.search(
        collection_name=COLLECTION,
        query_vector=qvec,
        limit=k,
        with_payload=True,
        score_threshold=None,
        query_filter=query_filter,
        search_params=SearchParams(hnsw_ef=128),
    )

    outputs: List[SearchOut] = []
    for p in res:
        pl = p.payload or {}
        outputs.append(SearchOut(
            post_id=str(pl.get("post_id")),
            owner_id=str(pl.get("owner_id")),
            privacy=str(pl.get("privacy")),
            link=str(pl.get("link")),
            caption=str(pl.get("caption","")),
            score=float(p.score)
        ))
    return outputs
</file>

<file path="Vector-index-api/requirements.txt">
fastapi==0.115.5
uvicorn[standard]==0.32.0
pydantic==2.9.2
qdrant-client==1.12.1
httpx==0.27.2
Pillow==10.4.0
requests==2.32.3
open_clip_torch==2.24.0
numpy==1.26.4
</file>

<file path="Vector-index-api/seed.py">
import os, asyncio, httpx, time

API = os.getenv("API", "http://localhost:8080")

posts = [
    {"post_id":"p1","owner_id":"user_alice","privacy":"Public",
     "image_url":"https://picsum.photos/id/1011/800/600","caption":"Bi·ªÉn xanh v√† b·∫ßu tr·ªùi trong v·∫Øt","alpha":0.5},
    {"post_id":"p2","owner_id":"user_bob","privacy":"Followers",
     "image_url":"https://picsum.photos/id/1035/800/600","caption":"ƒêi b·ªô ƒë∆∞·ªùng d√†i trong r·ª´ng th√¥ng m√°t m·∫ª","alpha":0.5},
    {"post_id":"p3","owner_id":"user_cara","privacy":"Private",
     "image_url":"https://picsum.photos/id/1025/800/600","caption":"Ch√≥ nh·ªè ƒë√°ng y√™u n·∫±m tr√™n b√£i c·ªè","alpha":0.5},
    {"post_id":"p4","owner_id":"user_deno","privacy":"Followers",
     "image_url":"https://picsum.photos/id/1040/800/600","caption":"Ho√†ng h√¥n tr√™n n√∫i v·ªõi m√¢y m√†u cam","alpha":0.5},
]

async def wait_ready(url: str, path: str = "/healthz", timeout_sec: int = 180):
    start = time.time()
    async with httpx.AsyncClient(timeout=5) as sx:
        while time.time() - start < timeout_sec:
            try:
                r = await sx.get(f"{url}{path}")
                if r.status_code == 200:
                    return
            except Exception:
                pass
            await asyncio.sleep(1)
    raise RuntimeError(f"{url}{path} not ready after {timeout_sec}s")

async def main():
    await wait_ready(API, "/healthz", 180)
    async with httpx.AsyncClient(timeout=120) as sx:
        r = await sx.post(f"{API}/bulk_posts", json={"items": posts, "batch_size": 2})
        print("bulk:", r.status_code, r.text)

if __name__ == "__main__":
    asyncio.run(main())
</file>

<file path="Vector-index-api/VectorIndexApi.Dockerfile">
FROM python:3.11-slim

RUN apt-get update && apt-get install -y --no-install-recommends     git libglib2.0-0 libsm6 libxext6 libxrender1 ca-certificates     && rm -rf /var/lib/apt/lists/*

WORKDIR /app

COPY requirements.txt /app/requirements.txt
RUN pip install --no-cache-dir --upgrade pip &&     pip install --no-cache-dir --extra-index-url https://download.pytorch.org/whl/cpu       torch==2.4.1 torchvision==0.19.1 torchaudio==2.4.1 &&     pip install --no-cache-dir -r requirements.txt

COPY warmup.py /app/warmup.py
RUN python /app/warmup.py

COPY main.py /app/main.py
COPY seed.py /app/seed.py

ENV QDRANT_URL=http://qdrant:6333
ENV FRIENDS_URL=http://mock_friends:8002
ENV COLLECTION_NAME=posts_demo
ENV MODEL_NAME=ViT-B-32
ENV PRETRAINED=openai
ENV RL_SEARCH_PER_MIN=60
ENV RL_POST_PER_MIN=20
ENV RL_BULK_PER_MIN=6
ENV BULK_EMBED_BATCH=32

EXPOSE 8080
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8080"]
</file>

<file path="Vector-index-api/warmup.py">
import open_clip, torch
model, _, _ = open_clip.create_model_and_transforms('ViT-B-32', pretrained='openai')
tok = open_clip.get_tokenizer('ViT-B-32')(['warmup'])
with torch.no_grad():
    _ = model.encode_text(tok)
print('Warmup done')
</file>

<file path="LICENSE">
MIT License

Copyright (c) 2025 I-Love-U-3000

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
</file>

<file path="README.md">
# Favi-BE
Backend Application For Favi
</file>

<file path=".gitignore">
## Ignore Visual Studio temporary files, build results, and
## files generated by popular Visual Studio add-ons.
##
## Get latest from https://github.com/github/gitignore/blob/main/VisualStudio.gitignore

# User-specific files
*.rsuser
*.suo
*.user
*.userosscache
*.sln.docstates
*.env

# User-specific files (MonoDevelop/Xamarin Studio)
*.userprefs

# Mono auto generated files
mono_crash.*

# Build results
[Dd]ebug/
[Dd]ebugPublic/
[Rr]elease/
[Rr]eleases/
x64/
x86/
[Ww][Ii][Nn]32/
[Aa][Rr][Mm]/
[Aa][Rr][Mm]64/
[Aa][Rr][Mm]64[Ee][Cc]/
bld/
[Oo]bj/
[Oo]ut/
[Ll]og/
[Ll]ogs/

# Build results on 'Bin' directories
**/[Bb]in/*
# Uncomment if you have tasks that rely on *.refresh files to move binaries
# (https://github.com/github/gitignore/pull/3736)
#!**/[Bb]in/*.refresh

# Visual Studio 2015/2017 cache/options directory
.vs/
# Uncomment if you have tasks that create the project's static files in wwwroot
#wwwroot/

# Visual Studio 2017 auto generated files
Generated\ Files/

# MSTest test Results
[Tt]est[Rr]esult*/
[Bb]uild[Ll]og.*
*.trx

# NUnit
*.VisualState.xml
TestResult.xml
nunit-*.xml

# Approval Tests result files
*.received.*

# Build Results of an ATL Project
[Dd]ebugPS/
[Rr]eleasePS/
dlldata.c

# Benchmark Results
BenchmarkDotNet.Artifacts/

# .NET Core
project.lock.json
project.fragment.lock.json
artifacts/

# ASP.NET Scaffolding
ScaffoldingReadMe.txt

# StyleCop
StyleCopReport.xml

# Files built by Visual Studio
*_i.c
*_p.c
*_h.h
*.ilk
*.meta
*.obj
*.idb
*.iobj
*.pch
*.pdb
*.ipdb
*.pgc
*.pgd
*.rsp
# but not Directory.Build.rsp, as it configures directory-level build defaults
!Directory.Build.rsp
*.sbr
*.tlb
*.tli
*.tlh
*.tmp
*.tmp_proj
*_wpftmp.csproj
*.log
*.tlog
*.vspscc
*.vssscc
.builds
*.pidb
*.svclog
*.scc

# Chutzpah Test files
_Chutzpah*

# Visual C++ cache files
ipch/
*.aps
*.ncb
*.opendb
*.opensdf
*.sdf
*.cachefile
*.VC.db
*.VC.VC.opendb

# Visual Studio profiler
*.psess
*.vsp
*.vspx
*.sap

# Visual Studio Trace Files
*.e2e

# TFS 2012 Local Workspace
$tf/

# Guidance Automation Toolkit
*.gpState

# ReSharper is a .NET coding add-in
_ReSharper*/
*.[Rr]e[Ss]harper
*.DotSettings.user

# TeamCity is a build add-in
_TeamCity*

# DotCover is a Code Coverage Tool
*.dotCover

# AxoCover is a Code Coverage Tool
.axoCover/*
!.axoCover/settings.json

# Coverlet is a free, cross platform Code Coverage Tool
coverage*.json
coverage*.xml
coverage*.info

# Visual Studio code coverage results
*.coverage
*.coveragexml

# NCrunch
_NCrunch_*
.NCrunch_*
.*crunch*.local.xml
nCrunchTemp_*

# MightyMoose
*.mm.*
AutoTest.Net/

# Web workbench (sass)
.sass-cache/

# Installshield output folder
[Ee]xpress/

# DocProject is a documentation generator add-in
DocProject/buildhelp/
DocProject/Help/*.HxT
DocProject/Help/*.HxC
DocProject/Help/*.hhc
DocProject/Help/*.hhk
DocProject/Help/*.hhp
DocProject/Help/Html2
DocProject/Help/html

# Click-Once directory
publish/

# Publish Web Output
*.[Pp]ublish.xml
*.azurePubxml
# Note: Comment the next line if you want to checkin your web deploy settings,
# but database connection strings (with potential passwords) will be unencrypted
*.pubxml
*.publishproj

# Microsoft Azure Web App publish settings. Comment the next line if you want to
# checkin your Azure Web App publish settings, but sensitive information contained
# in these scripts will be unencrypted
PublishScripts/

# NuGet Packages
*.nupkg
# NuGet Symbol Packages
*.snupkg
# The packages folder can be ignored because of Package Restore
**/[Pp]ackages/*
# except build/, which is used as an MSBuild target.
!**/[Pp]ackages/build/
# Uncomment if necessary however generally it will be regenerated when needed
#!**/[Pp]ackages/repositories.config
# NuGet v3's project.json files produces more ignorable files
*.nuget.props
*.nuget.targets

# Microsoft Azure Build Output
csx/
*.build.csdef

# Microsoft Azure Emulator
ecf/
rcf/

# Windows Store app package directories and files
AppPackages/
BundleArtifacts/
Package.StoreAssociation.xml
_pkginfo.txt
*.appx
*.appxbundle
*.appxupload

# Visual Studio cache files
# files ending in .cache can be ignored
*.[Cc]ache
# but keep track of directories ending in .cache
!?*.[Cc]ache/

# Others
ClientBin/
~$*
*~
*.dbmdl
*.dbproj.schemaview
*.jfm
*.pfx
*.publishsettings
orleans.codegen.cs

# Including strong name files can present a security risk
# (https://github.com/github/gitignore/pull/2483#issue-259490424)
#*.snk

# Since there are multiple workflows, uncomment next line to ignore bower_components
# (https://github.com/github/gitignore/pull/1529#issuecomment-104372622)
#bower_components/

# RIA/Silverlight projects
Generated_Code/

# Backup & report files from converting an old project file
# to a newer Visual Studio version. Backup files are not needed,
# because we have git ;-)
_UpgradeReport_Files/
Backup*/
UpgradeLog*.XML
UpgradeLog*.htm
ServiceFabricBackup/
*.rptproj.bak

# SQL Server files
*.mdf
*.ldf
*.ndf

# Business Intelligence projects
*.rdl.data
*.bim.layout
*.bim_*.settings
*.rptproj.rsuser
*- [Bb]ackup.rdl
*- [Bb]ackup ([0-9]).rdl
*- [Bb]ackup ([0-9][0-9]).rdl

# Microsoft Fakes
FakesAssemblies/

# GhostDoc plugin setting file
*.GhostDoc.xml

# Node.js Tools for Visual Studio
.ntvs_analysis.dat
node_modules/

# Visual Studio 6 build log
*.plg

# Visual Studio 6 workspace options file
*.opt

# Visual Studio 6 auto-generated workspace file (contains which files were open etc.)
*.vbw

# Visual Studio 6 auto-generated project file (contains which files were open etc.)
*.vbp

# Visual Studio 6 workspace and project file (working project files containing files to include in project)
*.dsw
*.dsp

# Visual Studio 6 technical files
*.ncb
*.aps

# Visual Studio LightSwitch build output
**/*.HTMLClient/GeneratedArtifacts
**/*.DesktopClient/GeneratedArtifacts
**/*.DesktopClient/ModelManifest.xml
**/*.Server/GeneratedArtifacts
**/*.Server/ModelManifest.xml
_Pvt_Extensions

# Paket dependency manager
**/.paket/paket.exe
paket-files/

# FAKE - F# Make
**/.fake/

# CodeRush personal settings
**/.cr/personal

# Python Tools for Visual Studio (PTVS)
**/__pycache__/
*.pyc

# Cake - Uncomment if you are using it
#tools/**
#!tools/packages.config

# Tabs Studio
*.tss

# Telerik's JustMock configuration file
*.jmconfig

# BizTalk build output
*.btp.cs
*.btm.cs
*.odx.cs
*.xsd.cs

# OpenCover UI analysis results
OpenCover/

# Azure Stream Analytics local run output
ASALocalRun/

# MSBuild Binary and Structured Log
*.binlog
MSBuild_Logs/

# AWS SAM Build and Temporary Artifacts folder
.aws-sam

# NVidia Nsight GPU debugger configuration file
*.nvuser

# MFractors (Xamarin productivity tool) working folder
**/.mfractor/

# Local History for Visual Studio
**/.localhistory/

# Visual Studio History (VSHistory) files
.vshistory/

# BeatPulse healthcheck temp database
healthchecksdb

# Backup folder for Package Reference Convert tool in Visual Studio 2017
MigrationBackup/

# Ionide (cross platform F# VS Code tools) working folder
**/.ionide/

# Fody - auto-generated XML schema
FodyWeavers.xsd

# VS Code files for those working on multiple tools
.vscode/*
!.vscode/settings.json
!.vscode/tasks.json
!.vscode/launch.json
!.vscode/extensions.json
!.vscode/*.code-snippets

# Local History for Visual Studio Code
.history/

# Built Visual Studio Code Extensions
*.vsix

# Windows Installer files from build outputs
*.cab
*.msi
*.msix
*.msm
*.msp

# secrets / local configs
appsettings.*.json
!appsettings.json
</file>

<file path="Favi-BE/Favi-BE.sln">
Microsoft Visual Studio Solution File, Format Version 12.00
# Visual Studio Version 17
VisualStudioVersion = 17.14.36518.9
MinimumVisualStudioVersion = 10.0.40219.1
Project("{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}") = "Favi-BE.API", "Favi-BE.API\Favi-BE.API.csproj", "{CE949904-4389-4B67-9036-8382F98826A6}"
EndProject
Global
	GlobalSection(SolutionConfigurationPlatforms) = preSolution
		Debug|Any CPU = Debug|Any CPU
		Release|Any CPU = Release|Any CPU
	EndGlobalSection
	GlobalSection(ProjectConfigurationPlatforms) = postSolution
		{CE949904-4389-4B67-9036-8382F98826A6}.Debug|Any CPU.ActiveCfg = Debug|Any CPU
		{CE949904-4389-4B67-9036-8382F98826A6}.Debug|Any CPU.Build.0 = Debug|Any CPU
		{CE949904-4389-4B67-9036-8382F98826A6}.Release|Any CPU.ActiveCfg = Release|Any CPU
		{CE949904-4389-4B67-9036-8382F98826A6}.Release|Any CPU.Build.0 = Release|Any CPU
	EndGlobalSection
	GlobalSection(SolutionProperties) = preSolution
		HideSolutionNode = FALSE
	EndGlobalSection
	GlobalSection(ExtensibilityGlobals) = postSolution
		SolutionGuid = {8A836969-D7EF-481E-B3E1-639D86068F7F}
	EndGlobalSection
EndGlobal
</file>

<file path="postman/collections/44172356-8e6ecdc6-dac1-4b08-a3f5-bffd8df0375c.json">
{
	"info": {
		"_postman_id": "44172356-8e6ecdc6-dac1-4b08-a3f5-bffd8df0375c",
		"name": "Favi-BE.API | v1",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "api",
			"item": [
				{
					"name": "Auth",
					"item": [
						{
							"name": "login",
							"item": [
								{
									"name": "/api/Auth/login",
									"id": "44172356-82c50cab-7a20-4989-9b78-a23d0378823d",
									"protocolProfileBehavior": {
										"disableBodyPruning": true
									},
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "Accept",
												"value": "text/plain"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"email\": \"string\",\n  \"password\": \"string\"\n}",
											"options": {
												"raw": {
													"headerFamily": "json",
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{baseUrl}}/api/Auth/login",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"api",
												"Auth",
												"login"
											]
										}
									},
									"response": [
										{
											"id": "44172356-762bf559-9a23-4ffd-8908-ebe4353ef5a9",
											"name": "OK",
											"originalRequest": {
												"method": "POST",
												"header": [
													{
														"key": "Content-Type",
														"value": "application/json"
													},
													{
														"key": "Accept",
														"value": "text/plain"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n  \"email\": \"string\",\n  \"password\": \"string\"\n}",
													"options": {
														"raw": {
															"headerFamily": "json",
															"language": "json"
														}
													}
												},
												"url": {
													"raw": "{{baseUrl}}/api/Auth/login",
													"host": [
														"{{baseUrl}}"
													],
													"path": [
														"api",
														"Auth",
														"login"
													]
												}
											},
											"status": "OK",
											"code": 200,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Content-Type",
													"value": "application/json"
												}
											],
											"cookie": [],
											"responseTime": null,
											"body": "{\n  \"access_token\": \"string\",\n  \"token_type\": \"string\",\n  \"expires_in\": 8862,\n  \"expires_at\": 5884,\n  \"refresh_token\": \"string\",\n  \"user\": {\n    \"id\": \"string\",\n    \"aud\": \"string\",\n    \"role\": \"string\",\n    \"email\": \"string\",\n    \"email_confirmed_at\": \"2017-09-18T05:39:37.596Z\",\n    \"phone\": \"string\",\n    \"confirmed_at\": \"1994-03-22T23:21:24.895Z\",\n    \"last_sign_in_at\": \"1978-05-24T12:22:33.251Z\",\n    \"app_metadata\": {},\n    \"user_metadata\": {},\n    \"identities\": [\n      {\n        \"identity_id\": \"string\",\n        \"id\": \"string\",\n        \"user_id\": \"string\",\n        \"identity_data\": {},\n        \"provider\": \"string\",\n        \"last_sign_in_at\": \"1980-11-02T13:31:33.674Z\",\n        \"created_at\": \"2024-07-26T22:30:32.485Z\",\n        \"updated_at\": \"1950-09-21T20:09:36.253Z\",\n        \"email\": \"string\"\n      },\n      {\n        \"identity_id\": \"string\",\n        \"id\": \"string\",\n        \"user_id\": \"string\",\n        \"identity_data\": {},\n        \"provider\": \"string\",\n        \"last_sign_in_at\": \"1982-02-27T04:43:06.769Z\",\n        \"created_at\": \"1994-01-26T13:04:10.496Z\",\n        \"updated_at\": \"1996-06-05T19:52:21.890Z\",\n        \"email\": \"string\"\n      }\n    ],\n    \"created_at\": \"1959-07-19T13:45:16.050Z\",\n    \"updated_at\": \"1946-01-09T21:39:39.930Z\",\n    \"is_anonymous\": true\n  },\n  \"weak_password\": \"string\"\n}"
										}
									]
								}
							],
							"id": "44172356-fc499325-11b4-47d6-a115-6f7a74fa8dd9"
						},
						{
							"name": "register",
							"item": [
								{
									"name": "/api/Auth/register",
									"id": "44172356-f531118e-23c9-4060-9015-eef4457274d9",
									"protocolProfileBehavior": {
										"disableBodyPruning": true
									},
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "Accept",
												"value": "text/plain"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"email\": \"string\",\n  \"password\": \"string\",\n  \"username\": \"string\"\n}",
											"options": {
												"raw": {
													"headerFamily": "json",
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{baseUrl}}/api/Auth/register",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"api",
												"Auth",
												"register"
											]
										}
									},
									"response": [
										{
											"id": "44172356-419f27ca-4236-46a7-b8c3-186f3f296647",
											"name": "OK",
											"originalRequest": {
												"method": "POST",
												"header": [
													{
														"key": "Content-Type",
														"value": "application/json"
													},
													{
														"key": "Accept",
														"value": "text/plain"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n  \"email\": \"string\",\n  \"password\": \"string\",\n  \"username\": \"string\"\n}",
													"options": {
														"raw": {
															"headerFamily": "json",
															"language": "json"
														}
													}
												},
												"url": {
													"raw": "{{baseUrl}}/api/Auth/register",
													"host": [
														"{{baseUrl}}"
													],
													"path": [
														"api",
														"Auth",
														"register"
													]
												}
											},
											"status": "OK",
											"code": 200,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Content-Type",
													"value": "application/json"
												}
											],
											"cookie": [],
											"responseTime": null,
											"body": "{\n  \"access_token\": \"string\",\n  \"token_type\": \"string\",\n  \"expires_in\": 8862,\n  \"expires_at\": 5884,\n  \"refresh_token\": \"string\",\n  \"user\": {\n    \"id\": \"string\",\n    \"aud\": \"string\",\n    \"role\": \"string\",\n    \"email\": \"string\",\n    \"email_confirmed_at\": \"2017-09-18T05:39:37.596Z\",\n    \"phone\": \"string\",\n    \"confirmed_at\": \"1994-03-22T23:21:24.895Z\",\n    \"last_sign_in_at\": \"1978-05-24T12:22:33.251Z\",\n    \"app_metadata\": {},\n    \"user_metadata\": {},\n    \"identities\": [\n      {\n        \"identity_id\": \"string\",\n        \"id\": \"string\",\n        \"user_id\": \"string\",\n        \"identity_data\": {},\n        \"provider\": \"string\",\n        \"last_sign_in_at\": \"1980-11-02T13:31:33.674Z\",\n        \"created_at\": \"2024-07-26T22:30:32.485Z\",\n        \"updated_at\": \"1950-09-21T20:09:36.253Z\",\n        \"email\": \"string\"\n      },\n      {\n        \"identity_id\": \"string\",\n        \"id\": \"string\",\n        \"user_id\": \"string\",\n        \"identity_data\": {},\n        \"provider\": \"string\",\n        \"last_sign_in_at\": \"1982-02-27T04:43:06.769Z\",\n        \"created_at\": \"1994-01-26T13:04:10.496Z\",\n        \"updated_at\": \"1996-06-05T19:52:21.890Z\",\n        \"email\": \"string\"\n      }\n    ],\n    \"created_at\": \"1959-07-19T13:45:16.050Z\",\n    \"updated_at\": \"1946-01-09T21:39:39.930Z\",\n    \"is_anonymous\": true\n  },\n  \"weak_password\": \"string\"\n}"
										}
									]
								}
							],
							"id": "44172356-cd93b8ae-87bc-460d-b71d-89b82a5ce0b3"
						},
						{
							"name": "refresh",
							"item": [
								{
									"name": "/api/Auth/refresh",
									"id": "44172356-99942a0c-3092-432e-b4b2-f07c4d26bbc2",
									"protocolProfileBehavior": {
										"disableBodyPruning": true
									},
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "Accept",
												"value": "text/plain"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "string",
											"options": {
												"raw": {
													"headerFamily": "json",
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{baseUrl}}/api/Auth/refresh",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"api",
												"Auth",
												"refresh"
											]
										}
									},
									"response": [
										{
											"id": "44172356-525ace86-ce5c-4261-a06f-ba69d8a8fc75",
											"name": "OK",
											"originalRequest": {
												"method": "POST",
												"header": [
													{
														"key": "Content-Type",
														"value": "application/json"
													},
													{
														"key": "Accept",
														"value": "text/plain"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "string",
													"options": {
														"raw": {
															"headerFamily": "json",
															"language": "json"
														}
													}
												},
												"url": {
													"raw": "{{baseUrl}}/api/Auth/refresh",
													"host": [
														"{{baseUrl}}"
													],
													"path": [
														"api",
														"Auth",
														"refresh"
													]
												}
											},
											"status": "OK",
											"code": 200,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Content-Type",
													"value": "application/json"
												}
											],
											"cookie": [],
											"responseTime": null,
											"body": "{\n  \"access_token\": \"string\",\n  \"token_type\": \"string\",\n  \"expires_in\": 8862,\n  \"expires_at\": 5884,\n  \"refresh_token\": \"string\",\n  \"user\": {\n    \"id\": \"string\",\n    \"aud\": \"string\",\n    \"role\": \"string\",\n    \"email\": \"string\",\n    \"email_confirmed_at\": \"2017-09-18T05:39:37.596Z\",\n    \"phone\": \"string\",\n    \"confirmed_at\": \"1994-03-22T23:21:24.895Z\",\n    \"last_sign_in_at\": \"1978-05-24T12:22:33.251Z\",\n    \"app_metadata\": {},\n    \"user_metadata\": {},\n    \"identities\": [\n      {\n        \"identity_id\": \"string\",\n        \"id\": \"string\",\n        \"user_id\": \"string\",\n        \"identity_data\": {},\n        \"provider\": \"string\",\n        \"last_sign_in_at\": \"1980-11-02T13:31:33.674Z\",\n        \"created_at\": \"2024-07-26T22:30:32.485Z\",\n        \"updated_at\": \"1950-09-21T20:09:36.253Z\",\n        \"email\": \"string\"\n      },\n      {\n        \"identity_id\": \"string\",\n        \"id\": \"string\",\n        \"user_id\": \"string\",\n        \"identity_data\": {},\n        \"provider\": \"string\",\n        \"last_sign_in_at\": \"1982-02-27T04:43:06.769Z\",\n        \"created_at\": \"1994-01-26T13:04:10.496Z\",\n        \"updated_at\": \"1996-06-05T19:52:21.890Z\",\n        \"email\": \"string\"\n      }\n    ],\n    \"created_at\": \"1959-07-19T13:45:16.050Z\",\n    \"updated_at\": \"1946-01-09T21:39:39.930Z\",\n    \"is_anonymous\": true\n  },\n  \"weak_password\": \"string\"\n}"
										}
									]
								}
							],
							"id": "44172356-da9f1e0d-fef2-4c36-ba39-3b8bf266d1fd"
						}
					],
					"id": "44172356-5273c849-e8e5-4f6a-9993-3b2f48238656"
				},
				{
					"name": "Collections",
					"item": [
						{
							"name": "{id}",
							"item": [
								{
									"name": "posts",
									"item": [
										{
											"name": "{postId}",
											"item": [
												{
													"name": "/api/Collections/:id/posts/:postId",
													"id": "44172356-35330369-973d-48c9-b2a5-4bb662360281",
													"protocolProfileBehavior": {
														"disableBodyPruning": true
													},
													"request": {
														"method": "POST",
														"header": [],
														"url": {
															"raw": "{{baseUrl}}/api/Collections/:id/posts/:postId",
															"host": [
																"{{baseUrl}}"
															],
															"path": [
																"api",
																"Collections",
																":id",
																"posts",
																":postId"
															],
															"variable": [
																{
																	"id": "3a28bc91-9e32-4260-ab05-8f1c0da2f6fd",
																	"key": "id",
																	"value": "57e7bc5b-cbe8-6dce-856f-60b3dd3de49f"
																},
																{
																	"id": "5e1f7127-0306-4d65-8e40-56e26afbe7e5",
																	"key": "postId",
																	"value": "57e7bc5b-cbe8-6dce-856f-60b3dd3de49f"
																}
															]
														}
													},
													"response": [
														{
															"id": "44172356-df1b17c6-7b98-41e6-a055-d780ee643249",
															"name": "OK",
															"originalRequest": {
																"method": "POST",
																"header": [],
																"url": {
																	"raw": "{{baseUrl}}/api/Collections/:id/posts/:postId",
																	"host": [
																		"{{baseUrl}}"
																	],
																	"path": [
																		"api",
																		"Collections",
																		":id",
																		"posts",
																		":postId"
																	],
																	"variable": [
																		{
																			"key": "id"
																		},
																		{
																			"key": "postId"
																		}
																	]
																}
															},
															"status": "OK",
															"code": 200,
															"_postman_previewlanguage": "text",
															"header": [],
															"cookie": [],
															"responseTime": null,
															"body": ""
														}
													]
												},
												{
													"name": "/api/Collections/:id/posts/:postId",
													"id": "44172356-f29f37c2-16e6-4d88-8fde-9ac95e3fc089",
													"protocolProfileBehavior": {
														"disableBodyPruning": true
													},
													"request": {
														"method": "DELETE",
														"header": [],
														"url": {
															"raw": "{{baseUrl}}/api/Collections/:id/posts/:postId",
															"host": [
																"{{baseUrl}}"
															],
															"path": [
																"api",
																"Collections",
																":id",
																"posts",
																":postId"
															],
															"variable": [
																{
																	"id": "773f36e8-4b67-4d6b-b5d3-e42fdc3e23e4",
																	"key": "id",
																	"value": "57e7bc5b-cbe8-6dce-856f-60b3dd3de49f"
																},
																{
																	"id": "a8db3764-5342-46f3-b0ab-41d092dc15d3",
																	"key": "postId",
																	"value": "57e7bc5b-cbe8-6dce-856f-60b3dd3de49f"
																}
															]
														}
													},
													"response": [
														{
															"id": "44172356-3bb25b23-2894-4da8-b947-c1bd3c7c8a0c",
															"name": "OK",
															"originalRequest": {
																"method": "DELETE",
																"header": [],
																"url": {
																	"raw": "{{baseUrl}}/api/Collections/:id/posts/:postId",
																	"host": [
																		"{{baseUrl}}"
																	],
																	"path": [
																		"api",
																		"Collections",
																		":id",
																		"posts",
																		":postId"
																	],
																	"variable": [
																		{
																			"key": "id"
																		},
																		{
																			"key": "postId"
																		}
																	]
																}
															},
															"status": "OK",
															"code": 200,
															"_postman_previewlanguage": "text",
															"header": [],
															"cookie": [],
															"responseTime": null,
															"body": ""
														}
													]
												}
											],
											"id": "44172356-1e0c8f43-e957-4ca4-89c0-0f0f07acd26f"
										},
										{
											"name": "/api/Collections/:id/posts",
											"id": "44172356-7a86e775-9e8f-403b-811a-bbcf1ed52e00",
											"protocolProfileBehavior": {
												"disableBodyPruning": true
											},
											"request": {
												"method": "GET",
												"header": [
													{
														"key": "Accept",
														"value": "text/plain"
													}
												],
												"url": {
													"raw": "{{baseUrl}}/api/Collections/:id/posts?page=1&pageSize=20",
													"host": [
														"{{baseUrl}}"
													],
													"path": [
														"api",
														"Collections",
														":id",
														"posts"
													],
													"query": [
														{
															"key": "page",
															"value": "1"
														},
														{
															"key": "pageSize",
															"value": "20"
														}
													],
													"variable": [
														{
															"id": "487a464b-70bd-4830-ade8-6a8bfe7c4e65",
															"key": "id",
															"value": "57e7bc5b-cbe8-6dce-856f-60b3dd3de49f"
														}
													]
												}
											},
											"response": [
												{
													"id": "44172356-6cd9458b-0efe-4655-9423-0b05acced2b6",
													"name": "OK",
													"originalRequest": {
														"method": "GET",
														"header": [
															{
																"key": "Accept",
																"value": "text/plain"
															}
														],
														"url": {
															"raw": "{{baseUrl}}/api/Collections/:id/posts?page=1&pageSize=20",
															"host": [
																"{{baseUrl}}"
															],
															"path": [
																"api",
																"Collections",
																":id",
																"posts"
															],
															"query": [
																{
																	"key": "page",
																	"value": "1"
																},
																{
																	"key": "pageSize",
																	"value": "20"
																}
															],
															"variable": [
																{
																	"key": "id"
																}
															]
														}
													},
													"status": "OK",
													"code": 200,
													"_postman_previewlanguage": "json",
													"header": [
														{
															"key": "Content-Type",
															"value": "application/json"
														}
													],
													"cookie": [],
													"responseTime": null,
													"body": "{\n  \"items\": [\n    {\n      \"id\": \"8e215a08-43e2-f048-0563-ded1cb003c06\",\n      \"authorProfileId\": \"ec74a444-2a68-903a-01a0-2507b9bbb122\",\n      \"caption\": \"string\",\n      \"createdAt\": \"1962-11-21T10:44:00.320Z\",\n      \"updatedAt\": \"2013-08-18T18:02:59.988Z\",\n      \"privacyLevel\": 2391,\n      \"medias\": [\n        {\n          \"id\": \"f151e891-c548-a819-8f71-200404862eb2\",\n          \"postId\": \"b03fe9ce-7bc2-4755-7019-24b628c03184\",\n          \"url\": \"string\",\n          \"publicId\": \"string\",\n          \"width\": 9161,\n          \"height\": 662,\n          \"format\": \"string\",\n          \"position\": 6659,\n          \"thumbnailUrl\": \"string\"\n        },\n        {\n          \"id\": \"df73f51b-cc01-a4df-1563-47bdc2329fc6\",\n          \"postId\": \"1220e246-4991-18fd-b267-4869985194ed\",\n          \"url\": \"string\",\n          \"publicId\": \"string\",\n          \"width\": 3049,\n          \"height\": 3180,\n          \"format\": \"string\",\n          \"position\": 2935,\n          \"thumbnailUrl\": \"string\"\n        }\n      ],\n      \"tags\": [\n        {\n          \"id\": \"19192fad-432f-5356-3572-455dc4bdbd6e\",\n          \"name\": \"string\"\n        },\n        {\n          \"id\": \"79119f34-fefb-87ec-1315-63031a4ad058\",\n          \"name\": \"string\"\n        }\n      ],\n      \"reactions\": {\n        \"total\": 7987,\n        \"byType\": {\n          \"key_0\": 6475\n        },\n        \"currentUserReaction\": 4681\n      }\n    },\n    {\n      \"id\": \"9eb12a26-fcd6-041c-ac69-f2d30cfb5ad9\",\n      \"authorProfileId\": \"50ddcbd2-e4e5-2723-820e-6457ef0a9e30\",\n      \"caption\": \"string\",\n      \"createdAt\": \"1975-04-20T00:07:58.427Z\",\n      \"updatedAt\": \"1995-11-29T02:57:08.961Z\",\n      \"privacyLevel\": 4218,\n      \"medias\": [\n        {\n          \"id\": \"d8ba6f26-eb67-5d9e-e8c0-c820befe7a86\",\n          \"postId\": \"45e60431-879a-0aef-bafc-1da783ecf6ca\",\n          \"url\": \"string\",\n          \"publicId\": \"string\",\n          \"width\": 7346,\n          \"height\": 1396,\n          \"format\": \"string\",\n          \"position\": 5693,\n          \"thumbnailUrl\": \"string\"\n        },\n        {\n          \"id\": \"93a7edac-0a95-469b-ddf2-3c8c077932f2\",\n          \"postId\": \"694584f8-1920-4883-e210-b41f96b7d817\",\n          \"url\": \"string\",\n          \"publicId\": \"string\",\n          \"width\": 3096,\n          \"height\": 2945,\n          \"format\": \"string\",\n          \"position\": 9307,\n          \"thumbnailUrl\": \"string\"\n        }\n      ],\n      \"tags\": [\n        {\n          \"id\": \"d0f89c01-683b-b842-be69-7cb448fdaa7d\",\n          \"name\": \"string\"\n        },\n        {\n          \"id\": \"3c75270e-444d-bba8-ce41-d5822320d61b\",\n          \"name\": \"string\"\n        }\n      ],\n      \"reactions\": {\n        \"total\": 9962,\n        \"byType\": {\n          \"key_0\": 4846,\n          \"key_1\": 3519\n        },\n        \"currentUserReaction\": 5342\n      }\n    }\n  ],\n  \"page\": 548,\n  \"pageSize\": 7421,\n  \"totalCount\": 429\n}"
												}
											]
										}
									],
									"id": "44172356-c83d1a4f-c37d-4b72-a644-6f055bda7c7a"
								},
								{
									"name": "/api/Collections/:id",
									"id": "44172356-ea593123-204d-4459-b515-6ec8787c6117",
									"protocolProfileBehavior": {
										"disableBodyPruning": true
									},
									"request": {
										"method": "PUT",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "Accept",
												"value": "text/plain"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"title\": \"string\",\n  \"description\": \"string\",\n  \"privacyLevel\": 4563,\n  \"coverImageUrl\": \"string\"\n}",
											"options": {
												"raw": {
													"headerFamily": "json",
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{baseUrl}}/api/Collections/:id",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"api",
												"Collections",
												":id"
											],
											"variable": [
												{
													"id": "0f159561-5855-4cf2-8b72-d42ed7b1015e",
													"key": "id",
													"value": "57e7bc5b-cbe8-6dce-856f-60b3dd3de49f"
												}
											]
										}
									},
									"response": [
										{
											"id": "44172356-a6bac22b-17d2-4fb3-b924-36e3337462fc",
											"name": "OK",
											"originalRequest": {
												"method": "PUT",
												"header": [
													{
														"key": "Content-Type",
														"value": "application/json"
													},
													{
														"key": "Accept",
														"value": "text/plain"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n  \"title\": \"string\",\n  \"description\": \"string\",\n  \"privacyLevel\": 4563,\n  \"coverImageUrl\": \"string\"\n}",
													"options": {
														"raw": {
															"headerFamily": "json",
															"language": "json"
														}
													}
												},
												"url": {
													"raw": "{{baseUrl}}/api/Collections/:id",
													"host": [
														"{{baseUrl}}"
													],
													"path": [
														"api",
														"Collections",
														":id"
													],
													"variable": [
														{
															"key": "id"
														}
													]
												}
											},
											"status": "OK",
											"code": 200,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Content-Type",
													"value": "application/json"
												}
											],
											"cookie": [],
											"responseTime": null,
											"body": "{\n  \"id\": \"b0d24bf9-22f1-a931-5baf-bb5655cca011\",\n  \"ownerProfileId\": \"321cb9b7-c782-f7d6-c856-f4b0350d870d\",\n  \"title\": \"string\",\n  \"description\": \"string\",\n  \"coverImageUrl\": \"string\",\n  \"privacyLevel\": 8578,\n  \"createdAt\": \"1984-06-09T02:49:11.728Z\",\n  \"updatedAt\": \"1997-03-25T13:30:35.773Z\",\n  \"postIds\": [\n    \"981643ae-0667-8a70-887b-c48804a9f169\",\n    \"74ca087a-f4ab-1f80-7542-da73727e3f44\"\n  ],\n  \"postCount\": 5664\n}"
										}
									]
								},
								{
									"name": "/api/Collections/:id",
									"id": "44172356-dddd542c-3a23-4049-803c-211333e6147b",
									"protocolProfileBehavior": {
										"disableBodyPruning": true
									},
									"request": {
										"method": "DELETE",
										"header": [],
										"url": {
											"raw": "{{baseUrl}}/api/Collections/:id",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"api",
												"Collections",
												":id"
											],
											"variable": [
												{
													"id": "1eaafaa6-ece5-4e0f-980a-61d0094af620",
													"key": "id",
													"value": "57e7bc5b-cbe8-6dce-856f-60b3dd3de49f"
												}
											]
										}
									},
									"response": [
										{
											"id": "44172356-fc6c761e-7a4a-4152-8209-fc4be56e46e1",
											"name": "OK",
											"originalRequest": {
												"method": "DELETE",
												"header": [],
												"url": {
													"raw": "{{baseUrl}}/api/Collections/:id",
													"host": [
														"{{baseUrl}}"
													],
													"path": [
														"api",
														"Collections",
														":id"
													],
													"variable": [
														{
															"key": "id"
														}
													]
												}
											},
											"status": "OK",
											"code": 200,
											"_postman_previewlanguage": "text",
											"header": [],
											"cookie": [],
											"responseTime": null,
											"body": ""
										}
									]
								},
								{
									"name": "/api/Collections/:id",
									"id": "44172356-8e3af99f-317c-4477-a776-1845d604600c",
									"protocolProfileBehavior": {
										"disableBodyPruning": true
									},
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "Accept",
												"value": "text/plain"
											}
										],
										"url": {
											"raw": "{{baseUrl}}/api/Collections/:id",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"api",
												"Collections",
												":id"
											],
											"variable": [
												{
													"id": "baf3e841-8b66-4916-86e5-4f7b2cdb51b6",
													"key": "id",
													"value": "57e7bc5b-cbe8-6dce-856f-60b3dd3de49f"
												}
											]
										}
									},
									"response": [
										{
											"id": "44172356-c562178a-bf8e-47f7-8172-546bf52feeea",
											"name": "OK",
											"originalRequest": {
												"method": "GET",
												"header": [
													{
														"key": "Accept",
														"value": "text/plain"
													}
												],
												"url": {
													"raw": "{{baseUrl}}/api/Collections/:id",
													"host": [
														"{{baseUrl}}"
													],
													"path": [
														"api",
														"Collections",
														":id"
													],
													"variable": [
														{
															"key": "id"
														}
													]
												}
											},
											"status": "OK",
											"code": 200,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Content-Type",
													"value": "application/json"
												}
											],
											"cookie": [],
											"responseTime": null,
											"body": "{\n  \"id\": \"b0d24bf9-22f1-a931-5baf-bb5655cca011\",\n  \"ownerProfileId\": \"321cb9b7-c782-f7d6-c856-f4b0350d870d\",\n  \"title\": \"string\",\n  \"description\": \"string\",\n  \"coverImageUrl\": \"string\",\n  \"privacyLevel\": 8578,\n  \"createdAt\": \"1984-06-09T02:49:11.728Z\",\n  \"updatedAt\": \"1997-03-25T13:30:35.773Z\",\n  \"postIds\": [\n    \"981643ae-0667-8a70-887b-c48804a9f169\",\n    \"74ca087a-f4ab-1f80-7542-da73727e3f44\"\n  ],\n  \"postCount\": 5664\n}"
										}
									]
								}
							],
							"id": "44172356-c473b413-8e2d-4bd7-8fc8-15c0990bd8b4"
						},
						{
							"name": "owner",
							"item": [
								{
									"name": "{ownerId}",
									"item": [
										{
											"name": "/api/Collections/owner/:ownerId",
											"id": "44172356-f1e088d2-f64d-4026-9b7b-6c0324cc6878",
											"protocolProfileBehavior": {
												"disableBodyPruning": true
											},
											"request": {
												"method": "GET",
												"header": [
													{
														"key": "Accept",
														"value": "text/plain"
													}
												],
												"url": {
													"raw": "{{baseUrl}}/api/Collections/owner/:ownerId?page=1&pageSize=20",
													"host": [
														"{{baseUrl}}"
													],
													"path": [
														"api",
														"Collections",
														"owner",
														":ownerId"
													],
													"query": [
														{
															"key": "page",
															"value": "1"
														},
														{
															"key": "pageSize",
															"value": "20"
														}
													],
													"variable": [
														{
															"id": "ce5103c7-adfb-4e7d-abdd-e91fa5f61127",
															"key": "ownerId",
															"value": "57e7bc5b-cbe8-6dce-856f-60b3dd3de49f"
														}
													]
												}
											},
											"response": [
												{
													"id": "44172356-8de17529-63b1-4335-a84f-1419748a3bb5",
													"name": "OK",
													"originalRequest": {
														"method": "GET",
														"header": [
															{
																"key": "Accept",
																"value": "text/plain"
															}
														],
														"url": {
															"raw": "{{baseUrl}}/api/Collections/owner/:ownerId?page=1&pageSize=20",
															"host": [
																"{{baseUrl}}"
															],
															"path": [
																"api",
																"Collections",
																"owner",
																":ownerId"
															],
															"query": [
																{
																	"key": "page",
																	"value": "1"
																},
																{
																	"key": "pageSize",
																	"value": "20"
																}
															],
															"variable": [
																{
																	"key": "ownerId"
																}
															]
														}
													},
													"status": "OK",
													"code": 200,
													"_postman_previewlanguage": "json",
													"header": [
														{
															"key": "Content-Type",
															"value": "application/json"
														}
													],
													"cookie": [],
													"responseTime": null,
													"body": "{\n  \"items\": [\n    {\n      \"id\": \"0b8437a7-f631-17c6-da09-66f3d53bda1c\",\n      \"ownerProfileId\": \"6aa93585-e0fd-07b6-3ef5-15ab2cfc93ee\",\n      \"title\": \"string\",\n      \"description\": \"string\",\n      \"coverImageUrl\": \"string\",\n      \"privacyLevel\": 8488,\n      \"createdAt\": \"1994-10-04T21:12:25.908Z\",\n      \"updatedAt\": \"1978-08-03T00:43:16.077Z\",\n      \"postIds\": [\n        \"b199d269-37e2-28ae-bd0c-348dce5de9ce\",\n        \"83d2e700-dcd5-3c74-6452-46eb5436cfdc\"\n      ],\n      \"postCount\": 6361\n    },\n    {\n      \"id\": \"9de72349-4e8d-6796-5912-80db9b4f1463\",\n      \"ownerProfileId\": \"60a655bf-c3a2-15e8-9b2b-181dd42f2152\",\n      \"title\": \"string\",\n      \"description\": \"string\",\n      \"coverImageUrl\": \"string\",\n      \"privacyLevel\": 3976,\n      \"createdAt\": \"1972-01-21T12:23:04.501Z\",\n      \"updatedAt\": \"1988-10-06T10:42:20.206Z\",\n      \"postIds\": [\n        \"d1652fee-2c03-ee7a-bbd7-0c09bf1c98ce\",\n        \"afd5b433-e947-eb7c-0e08-afbb99749359\"\n      ],\n      \"postCount\": 2205\n    }\n  ],\n  \"page\": 7175,\n  \"pageSize\": 3688,\n  \"totalCount\": 5653\n}"
												}
											]
										}
									],
									"id": "44172356-2c30c7f1-aae9-4fc7-bae7-568d73fd524b"
								}
							],
							"id": "44172356-59f90974-3329-41d6-a550-9039e6743b82"
						},
						{
							"name": "/api/Collections",
							"id": "44172356-dd9c5df7-4ad2-4035-97f7-fd3e97cd4eb8",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "Accept",
										"value": "text/plain"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"ownerProfileId\": \"e4b6511a-e599-2d8c-c15e-e036420e4654\",\n  \"title\": \"string\",\n  \"description\": \"string\",\n  \"privacyLevel\": 9360,\n  \"coverImageUrl\": \"string\"\n}",
									"options": {
										"raw": {
											"headerFamily": "json",
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/api/Collections",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"api",
										"Collections"
									]
								}
							},
							"response": [
								{
									"id": "44172356-635fafe8-5687-496b-8bf5-0aac1f38b5e2",
									"name": "OK",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "Accept",
												"value": "text/plain"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"ownerProfileId\": \"e4b6511a-e599-2d8c-c15e-e036420e4654\",\n  \"title\": \"string\",\n  \"description\": \"string\",\n  \"privacyLevel\": 9360,\n  \"coverImageUrl\": \"string\"\n}",
											"options": {
												"raw": {
													"headerFamily": "json",
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{baseUrl}}/api/Collections",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"api",
												"Collections"
											]
										}
									},
									"status": "OK",
									"code": 200,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"cookie": [],
									"responseTime": null,
									"body": "{\n  \"id\": \"b0d24bf9-22f1-a931-5baf-bb5655cca011\",\n  \"ownerProfileId\": \"321cb9b7-c782-f7d6-c856-f4b0350d870d\",\n  \"title\": \"string\",\n  \"description\": \"string\",\n  \"coverImageUrl\": \"string\",\n  \"privacyLevel\": 8578,\n  \"createdAt\": \"1984-06-09T02:49:11.728Z\",\n  \"updatedAt\": \"1997-03-25T13:30:35.773Z\",\n  \"postIds\": [\n    \"981643ae-0667-8a70-887b-c48804a9f169\",\n    \"74ca087a-f4ab-1f80-7542-da73727e3f44\"\n  ],\n  \"postCount\": 5664\n}"
								}
							]
						}
					],
					"id": "44172356-d9f126fe-c5f0-4001-8808-a5e475684406"
				},
				{
					"name": "Comments",
					"item": [
						{
							"name": "{id}",
							"item": [
								{
									"name": "/api/Comments/:id",
									"id": "44172356-3706c780-e5e6-4f73-8d74-ff7ba3ac4702",
									"protocolProfileBehavior": {
										"disableBodyPruning": true
									},
									"request": {
										"method": "PUT",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"content\": \"string\"\n}",
											"options": {
												"raw": {
													"headerFamily": "json",
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{baseUrl}}/api/Comments/:id",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"api",
												"Comments",
												":id"
											],
											"variable": [
												{
													"id": "8bffb5d2-a5a4-4d10-a288-18845c7f160c",
													"key": "id",
													"value": "57e7bc5b-cbe8-6dce-856f-60b3dd3de49f"
												}
											]
										}
									},
									"response": [
										{
											"id": "44172356-5f11b8f3-2b38-4299-8e1b-ea5dd6ff6e3f",
											"name": "OK",
											"originalRequest": {
												"method": "PUT",
												"header": [
													{
														"key": "Content-Type",
														"value": "application/json"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n  \"content\": \"string\"\n}",
													"options": {
														"raw": {
															"headerFamily": "json",
															"language": "json"
														}
													}
												},
												"url": {
													"raw": "{{baseUrl}}/api/Comments/:id",
													"host": [
														"{{baseUrl}}"
													],
													"path": [
														"api",
														"Comments",
														":id"
													],
													"variable": [
														{
															"key": "id"
														}
													]
												}
											},
											"status": "OK",
											"code": 200,
											"_postman_previewlanguage": "text",
											"header": [],
											"cookie": [],
											"responseTime": null,
											"body": ""
										}
									]
								},
								{
									"name": "/api/Comments/:id",
									"id": "44172356-90b589a2-7e30-4b16-9fed-0b739ed8af53",
									"protocolProfileBehavior": {
										"disableBodyPruning": true
									},
									"request": {
										"method": "DELETE",
										"header": [],
										"url": {
											"raw": "{{baseUrl}}/api/Comments/:id",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"api",
												"Comments",
												":id"
											],
											"variable": [
												{
													"id": "f219105b-f555-4f3d-9198-fa7eabba0731",
													"key": "id",
													"value": "57e7bc5b-cbe8-6dce-856f-60b3dd3de49f"
												}
											]
										}
									},
									"response": [
										{
											"id": "44172356-abce426e-b16c-4070-aeae-6a6e9d8cdc77",
											"name": "OK",
											"originalRequest": {
												"method": "DELETE",
												"header": [],
												"url": {
													"raw": "{{baseUrl}}/api/Comments/:id",
													"host": [
														"{{baseUrl}}"
													],
													"path": [
														"api",
														"Comments",
														":id"
													],
													"variable": [
														{
															"key": "id"
														}
													]
												}
											},
											"status": "OK",
											"code": 200,
											"_postman_previewlanguage": "text",
											"header": [],
											"cookie": [],
											"responseTime": null,
											"body": ""
										}
									]
								}
							],
							"id": "44172356-8d1f2aee-8ce7-4bcc-84ce-548d66696d13"
						},
						{
							"name": "post",
							"item": [
								{
									"name": "{postId}",
									"item": [
										{
											"name": "/api/Comments/post/:postId",
											"id": "44172356-4be39c73-885b-4744-a9b6-f8bba562fe4b",
											"protocolProfileBehavior": {
												"disableBodyPruning": true
											},
											"request": {
												"method": "GET",
												"header": [
													{
														"key": "Accept",
														"value": "text/plain"
													}
												],
												"url": {
													"raw": "{{baseUrl}}/api/Comments/post/:postId?page=1&pageSize=20",
													"host": [
														"{{baseUrl}}"
													],
													"path": [
														"api",
														"Comments",
														"post",
														":postId"
													],
													"query": [
														{
															"key": "page",
															"value": "1"
														},
														{
															"key": "pageSize",
															"value": "20"
														}
													],
													"variable": [
														{
															"id": "8a3c5d44-0363-42d0-af03-b838e780b563",
															"key": "postId",
															"value": "57e7bc5b-cbe8-6dce-856f-60b3dd3de49f"
														}
													]
												}
											},
											"response": [
												{
													"id": "44172356-2a168d41-961d-44a4-9072-273fd52f60b0",
													"name": "OK",
													"originalRequest": {
														"method": "GET",
														"header": [
															{
																"key": "Accept",
																"value": "text/plain"
															}
														],
														"url": {
															"raw": "{{baseUrl}}/api/Comments/post/:postId?page=1&pageSize=20",
															"host": [
																"{{baseUrl}}"
															],
															"path": [
																"api",
																"Comments",
																"post",
																":postId"
															],
															"query": [
																{
																	"key": "page",
																	"value": "1"
																},
																{
																	"key": "pageSize",
																	"value": "20"
																}
															],
															"variable": [
																{
																	"key": "postId"
																}
															]
														}
													},
													"status": "OK",
													"code": 200,
													"_postman_previewlanguage": "json",
													"header": [
														{
															"key": "Content-Type",
															"value": "application/json"
														}
													],
													"cookie": [],
													"responseTime": null,
													"body": "{\n  \"items\": [\n    {\n      \"id\": \"754776f0-503c-f523-4a85-c8b74e27c11b\",\n      \"postId\": \"150b201b-e857-ff83-a760-0ef5165807fd\",\n      \"authorProfileId\": \"b0b6d61b-9d7f-4936-4788-c4ce8b44899c\",\n      \"content\": \"string\",\n      \"createdAt\": \"1946-03-27T18:57:16.350Z\",\n      \"updatedAt\": \"1978-02-14T06:19:38.172Z\",\n      \"parentCommentId\": \"550eaada-dbb0-9af5-43cd-bd4e32f7aeaf\"\n    },\n    {\n      \"id\": \"57ef6edf-9aca-a9ac-2ccf-23cc996a2a4c\",\n      \"postId\": \"f7669189-c369-5b21-4e0f-a95dd48117ed\",\n      \"authorProfileId\": \"ce719595-f535-72d4-278b-6772d08e3f20\",\n      \"content\": \"string\",\n      \"createdAt\": \"2006-04-16T16:24:54.920Z\",\n      \"updatedAt\": \"1954-07-22T23:46:41.845Z\",\n      \"parentCommentId\": \"7ae7527b-6ff2-62e3-32de-04074ef42048\"\n    }\n  ],\n  \"page\": 5291,\n  \"pageSize\": 5116,\n  \"totalCount\": 8825\n}"
												}
											]
										}
									],
									"id": "44172356-4aa3168c-f902-4e96-ab85-c9ab0eb6446f"
								}
							],
							"id": "44172356-705f6d73-1fba-44ec-81be-810e9dd01be9"
						},
						{
							"name": "/api/Comments",
							"id": "44172356-e3e22ded-745e-4c39-a18c-bebfb2a4170c",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "Accept",
										"value": "text/plain"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"postId\": \"20ad736b-a33b-0720-e265-be7534860b9e\",\n  \"authorProfileId\": \"9f645891-4ff2-d5cc-0b6b-ce08a2254765\",\n  \"content\": \"string\",\n  \"parentCommentId\": \"2f7f53b4-c6f1-aecb-3f42-18ae96244de9\"\n}",
									"options": {
										"raw": {
											"headerFamily": "json",
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/api/Comments",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"api",
										"Comments"
									]
								}
							},
							"response": [
								{
									"id": "44172356-f0106ec1-6120-4c71-8fd8-8e3071a521d3",
									"name": "OK",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "Accept",
												"value": "text/plain"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"postId\": \"20ad736b-a33b-0720-e265-be7534860b9e\",\n  \"authorProfileId\": \"9f645891-4ff2-d5cc-0b6b-ce08a2254765\",\n  \"content\": \"string\",\n  \"parentCommentId\": \"2f7f53b4-c6f1-aecb-3f42-18ae96244de9\"\n}",
											"options": {
												"raw": {
													"headerFamily": "json",
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{baseUrl}}/api/Comments",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"api",
												"Comments"
											]
										}
									},
									"status": "OK",
									"code": 200,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"cookie": [],
									"responseTime": null,
									"body": "{\n  \"id\": \"9cd2cce5-36b2-241f-3b5a-3c8c4d380d27\",\n  \"postId\": \"372359d2-7a63-a0c9-8e9e-8efe9185c0c4\",\n  \"authorProfileId\": \"b2471edc-f0f0-b9cc-df97-3b2dfe590e98\",\n  \"content\": \"string\",\n  \"createdAt\": \"2013-06-01T16:25:48.380Z\",\n  \"updatedAt\": \"1951-05-02T03:23:29.139Z\",\n  \"parentCommentId\": \"8d501a1e-3260-87cb-8b2b-ad9f19810eb7\"\n}"
								}
							]
						}
					],
					"id": "44172356-d20bb2b5-a4c7-4bd1-bbc5-3bfb1e2a02f5"
				},
				{
					"name": "Profiles",
					"item": [
						{
							"name": "{id}",
							"item": [
								{
									"name": "followers",
									"item": [
										{
											"name": "/api/Profiles/:id/followers",
											"id": "44172356-be6a3f6d-ce84-492c-90cd-93875fbc098d",
											"protocolProfileBehavior": {
												"disableBodyPruning": true
											},
											"request": {
												"method": "GET",
												"header": [],
												"url": {
													"raw": "{{baseUrl}}/api/Profiles/:id/followers?skip=5733&take=5733",
													"host": [
														"{{baseUrl}}"
													],
													"path": [
														"api",
														"Profiles",
														":id",
														"followers"
													],
													"query": [
														{
															"key": "skip",
															"value": "5733"
														},
														{
															"key": "take",
															"value": "5733"
														}
													],
													"variable": [
														{
															"id": "b72e5b88-7636-40a9-b5fb-197df3e2cab1",
															"key": "id",
															"value": "57e7bc5b-cbe8-6dce-856f-60b3dd3de49f"
														}
													]
												}
											},
											"response": [
												{
													"id": "44172356-6b80cbe1-3d04-4aff-a912-45c1c93afd96",
													"name": "OK",
													"originalRequest": {
														"method": "GET",
														"header": [],
														"url": {
															"raw": "{{baseUrl}}/api/Profiles/:id/followers?skip=5733&take=5733",
															"host": [
																"{{baseUrl}}"
															],
															"path": [
																"api",
																"Profiles",
																":id",
																"followers"
															],
															"query": [
																{
																	"key": "skip",
																	"value": "5733"
																},
																{
																	"key": "take",
																	"value": "5733"
																}
															],
															"variable": [
																{
																	"key": "id"
																}
															]
														}
													},
													"status": "OK",
													"code": 200,
													"_postman_previewlanguage": "text",
													"header": [],
													"cookie": [],
													"responseTime": null,
													"body": ""
												}
											]
										}
									],
									"id": "44172356-f96a7f8d-6caa-493e-8aa5-58c7732a0ff0"
								},
								{
									"name": "followings",
									"item": [
										{
											"name": "/api/Profiles/:id/followings",
											"id": "44172356-53b44f49-01c2-4e0b-bb45-74e914c12a2c",
											"protocolProfileBehavior": {
												"disableBodyPruning": true
											},
											"request": {
												"method": "GET",
												"header": [],
												"url": {
													"raw": "{{baseUrl}}/api/Profiles/:id/followings?skip=5733&take=5733",
													"host": [
														"{{baseUrl}}"
													],
													"path": [
														"api",
														"Profiles",
														":id",
														"followings"
													],
													"query": [
														{
															"key": "skip",
															"value": "5733"
														},
														{
															"key": "take",
															"value": "5733"
														}
													],
													"variable": [
														{
															"id": "9b27cfe8-fef6-47fe-b4ad-670d6e3e8478",
															"key": "id",
															"value": "57e7bc5b-cbe8-6dce-856f-60b3dd3de49f"
														}
													]
												}
											},
											"response": [
												{
													"id": "44172356-615b0929-f151-42dc-b752-264c3d14320a",
													"name": "OK",
													"originalRequest": {
														"method": "GET",
														"header": [],
														"url": {
															"raw": "{{baseUrl}}/api/Profiles/:id/followings?skip=5733&take=5733",
															"host": [
																"{{baseUrl}}"
															],
															"path": [
																"api",
																"Profiles",
																":id",
																"followings"
															],
															"query": [
																{
																	"key": "skip",
																	"value": "5733"
																},
																{
																	"key": "take",
																	"value": "5733"
																}
															],
															"variable": [
																{
																	"key": "id"
																}
															]
														}
													},
													"status": "OK",
													"code": 200,
													"_postman_previewlanguage": "text",
													"header": [],
													"cookie": [],
													"responseTime": null,
													"body": ""
												}
											]
										}
									],
									"id": "44172356-d62e8bed-7451-405a-8b5c-83162631d0fc"
								},
								{
									"name": "/api/Profiles/:id",
									"id": "44172356-5332540d-fd88-46d7-b316-ad35301285d2",
									"protocolProfileBehavior": {
										"disableBodyPruning": true
									},
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "Accept",
												"value": "text/plain"
											}
										],
										"url": {
											"raw": "{{baseUrl}}/api/Profiles/:id",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"api",
												"Profiles",
												":id"
											],
											"variable": [
												{
													"id": "ba6875ee-4760-4b22-b7d1-dbb12220d4b1",
													"key": "id",
													"value": "57e7bc5b-cbe8-6dce-856f-60b3dd3de49f"
												}
											]
										}
									},
									"response": [
										{
											"id": "44172356-701e26c0-8faf-4213-8e3c-383bab0bd5aa",
											"name": "OK",
											"originalRequest": {
												"method": "GET",
												"header": [
													{
														"key": "Accept",
														"value": "text/plain"
													}
												],
												"url": {
													"raw": "{{baseUrl}}/api/Profiles/:id",
													"host": [
														"{{baseUrl}}"
													],
													"path": [
														"api",
														"Profiles",
														":id"
													],
													"variable": [
														{
															"key": "id"
														}
													]
												}
											},
											"status": "OK",
											"code": 200,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Content-Type",
													"value": "application/json"
												}
											],
											"cookie": [],
											"responseTime": null,
											"body": "{\n  \"id\": \"98868995-9924-3093-64ae-7014e2ff5727\",\n  \"username\": \"string\",\n  \"displayName\": \"string\",\n  \"bio\": \"string\",\n  \"avatarUrl\": \"string\",\n  \"coverUrl\": \"string\",\n  \"createdAt\": \"1981-09-16T09:01:36.332Z\",\n  \"lastActiveAt\": \"1960-12-11T14:56:00.958Z\",\n  \"followersCount\": 8206,\n  \"followingCount\": 4952\n}"
										}
									]
								}
							],
							"id": "44172356-bbb459e0-1816-4ac3-bb8e-08663c69ad8f"
						},
						{
							"name": "follow",
							"item": [
								{
									"name": "{targetId}",
									"item": [
										{
											"name": "/api/Profiles/follow/:targetId",
											"id": "44172356-005a2eb2-dd97-4117-ab84-aeabc56ed5fa",
											"protocolProfileBehavior": {
												"disableBodyPruning": true
											},
											"request": {
												"method": "POST",
												"header": [],
												"url": {
													"raw": "{{baseUrl}}/api/Profiles/follow/:targetId",
													"host": [
														"{{baseUrl}}"
													],
													"path": [
														"api",
														"Profiles",
														"follow",
														":targetId"
													],
													"variable": [
														{
															"id": "a934281c-ba13-43cb-a9f2-c6eaa9ef1059",
															"key": "targetId",
															"value": "57e7bc5b-cbe8-6dce-856f-60b3dd3de49f"
														}
													]
												}
											},
											"response": [
												{
													"id": "44172356-60c9c925-23b7-482a-8088-f7bf3391aa08",
													"name": "OK",
													"originalRequest": {
														"method": "POST",
														"header": [],
														"url": {
															"raw": "{{baseUrl}}/api/Profiles/follow/:targetId",
															"host": [
																"{{baseUrl}}"
															],
															"path": [
																"api",
																"Profiles",
																"follow",
																":targetId"
															],
															"variable": [
																{
																	"key": "targetId"
																}
															]
														}
													},
													"status": "OK",
													"code": 200,
													"_postman_previewlanguage": "text",
													"header": [],
													"cookie": [],
													"responseTime": null,
													"body": ""
												}
											]
										},
										{
											"name": "/api/Profiles/follow/:targetId",
											"id": "44172356-9807b532-bd6c-499e-b4b5-77fe927658e0",
											"protocolProfileBehavior": {
												"disableBodyPruning": true
											},
											"request": {
												"method": "DELETE",
												"header": [],
												"url": {
													"raw": "{{baseUrl}}/api/Profiles/follow/:targetId",
													"host": [
														"{{baseUrl}}"
													],
													"path": [
														"api",
														"Profiles",
														"follow",
														":targetId"
													],
													"variable": [
														{
															"id": "b9fef3f8-779b-43de-8c80-099d96c20564",
															"key": "targetId",
															"value": "57e7bc5b-cbe8-6dce-856f-60b3dd3de49f"
														}
													]
												}
											},
											"response": [
												{
													"id": "44172356-73030514-1c7f-4068-bfee-ac3835507d5a",
													"name": "OK",
													"originalRequest": {
														"method": "DELETE",
														"header": [],
														"url": {
															"raw": "{{baseUrl}}/api/Profiles/follow/:targetId",
															"host": [
																"{{baseUrl}}"
															],
															"path": [
																"api",
																"Profiles",
																"follow",
																":targetId"
															],
															"variable": [
																{
																	"key": "targetId"
																}
															]
														}
													},
													"status": "OK",
													"code": 200,
													"_postman_previewlanguage": "text",
													"header": [],
													"cookie": [],
													"responseTime": null,
													"body": ""
												}
											]
										}
									],
									"id": "44172356-66f448b7-ed56-4c7f-8adc-01214e9cac80"
								}
							],
							"id": "44172356-65b56ca0-9101-474a-aa94-b955aa248631"
						},
						{
							"name": "links",
							"item": [
								{
									"name": "{linkId}",
									"item": [
										{
											"name": "/api/Profiles/links/:linkId",
											"id": "44172356-fd049185-9739-4e83-a7dd-6dfdb494642f",
											"protocolProfileBehavior": {
												"disableBodyPruning": true
											},
											"request": {
												"method": "DELETE",
												"header": [],
												"url": {
													"raw": "{{baseUrl}}/api/Profiles/links/:linkId",
													"host": [
														"{{baseUrl}}"
													],
													"path": [
														"api",
														"Profiles",
														"links",
														":linkId"
													],
													"variable": [
														{
															"id": "e9d9d0a4-8b87-4960-9a38-237ea64e3248",
															"key": "linkId",
															"value": "57e7bc5b-cbe8-6dce-856f-60b3dd3de49f"
														}
													]
												}
											},
											"response": [
												{
													"id": "44172356-6e7726d3-8204-43db-94b4-f74ff7913474",
													"name": "OK",
													"originalRequest": {
														"method": "DELETE",
														"header": [],
														"url": {
															"raw": "{{baseUrl}}/api/Profiles/links/:linkId",
															"host": [
																"{{baseUrl}}"
															],
															"path": [
																"api",
																"Profiles",
																"links",
																":linkId"
															],
															"variable": [
																{
																	"key": "linkId"
																}
															]
														}
													},
													"status": "OK",
													"code": 200,
													"_postman_previewlanguage": "text",
													"header": [],
													"cookie": [],
													"responseTime": null,
													"body": ""
												}
											]
										}
									],
									"id": "44172356-8d01458b-1bd0-4dea-b886-ff94e944b6e0"
								},
								{
									"name": "/api/Profiles/links",
									"id": "44172356-d104f038-34f4-485a-b10e-4c50bae70d3b",
									"protocolProfileBehavior": {
										"disableBodyPruning": true
									},
									"request": {
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{baseUrl}}/api/Profiles/links",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"api",
												"Profiles",
												"links"
											]
										}
									},
									"response": [
										{
											"id": "44172356-a1a49701-1535-4c55-a0f8-5f815ab11118",
											"name": "OK",
											"originalRequest": {
												"method": "GET",
												"header": [],
												"url": {
													"raw": "{{baseUrl}}/api/Profiles/links",
													"host": [
														"{{baseUrl}}"
													],
													"path": [
														"api",
														"Profiles",
														"links"
													]
												}
											},
											"status": "OK",
											"code": 200,
											"_postman_previewlanguage": "text",
											"header": [],
											"cookie": [],
											"responseTime": null,
											"body": ""
										}
									]
								},
								{
									"name": "/api/Profiles/links",
									"id": "44172356-457dd7d2-7d8b-42c2-b114-352ec1296a6d",
									"protocolProfileBehavior": {
										"disableBodyPruning": true
									},
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"id\": \"e074e3ed-0801-6a25-e75c-f630966e8b3b\",\n  \"socialKind\": 3401,\n  \"url\": \"string\"\n}",
											"options": {
												"raw": {
													"headerFamily": "json",
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{baseUrl}}/api/Profiles/links",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"api",
												"Profiles",
												"links"
											]
										}
									},
									"response": [
										{
											"id": "44172356-5d44d0c8-f843-4626-a1bc-c3c219456f79",
											"name": "OK",
											"originalRequest": {
												"method": "POST",
												"header": [
													{
														"key": "Content-Type",
														"value": "application/json"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n  \"id\": \"e074e3ed-0801-6a25-e75c-f630966e8b3b\",\n  \"socialKind\": 3401,\n  \"url\": \"string\"\n}",
													"options": {
														"raw": {
															"headerFamily": "json",
															"language": "json"
														}
													}
												},
												"url": {
													"raw": "{{baseUrl}}/api/Profiles/links",
													"host": [
														"{{baseUrl}}"
													],
													"path": [
														"api",
														"Profiles",
														"links"
													]
												}
											},
											"status": "OK",
											"code": 200,
											"_postman_previewlanguage": "text",
											"header": [],
											"cookie": [],
											"responseTime": null,
											"body": ""
										}
									]
								}
							],
							"id": "44172356-6d36c8c9-9148-468e-9047-9bce22ef046d"
						},
						{
							"name": "/api/Profiles",
							"id": "44172356-9a050bff-00ed-43f4-aee8-adcfeaa7a778",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "PUT",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "Accept",
										"value": "text/plain"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"username\": \"string\",\n  \"displayName\": \"string\",\n  \"bio\": \"string\",\n  \"avatarUrl\": \"string\",\n  \"coverUrl\": \"string\"\n}",
									"options": {
										"raw": {
											"headerFamily": "json",
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/api/Profiles",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"api",
										"Profiles"
									]
								}
							},
							"response": [
								{
									"id": "44172356-57d81539-04b1-475f-be4d-a698780dbdba",
									"name": "OK",
									"originalRequest": {
										"method": "PUT",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "Accept",
												"value": "text/plain"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"username\": \"string\",\n  \"displayName\": \"string\",\n  \"bio\": \"string\",\n  \"avatarUrl\": \"string\",\n  \"coverUrl\": \"string\"\n}",
											"options": {
												"raw": {
													"headerFamily": "json",
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{baseUrl}}/api/Profiles",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"api",
												"Profiles"
											]
										}
									},
									"status": "OK",
									"code": 200,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"cookie": [],
									"responseTime": null,
									"body": "{\n  \"id\": \"98868995-9924-3093-64ae-7014e2ff5727\",\n  \"username\": \"string\",\n  \"displayName\": \"string\",\n  \"bio\": \"string\",\n  \"avatarUrl\": \"string\",\n  \"coverUrl\": \"string\",\n  \"createdAt\": \"1981-09-16T09:01:36.332Z\",\n  \"lastActiveAt\": \"1960-12-11T14:56:00.958Z\",\n  \"followersCount\": 8206,\n  \"followingCount\": 4952\n}"
								}
							]
						},
						{
							"name": "/api/Profiles",
							"id": "44172356-adce6ebb-8635-4078-bb38-3d005a1e1e4a",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "DELETE",
								"header": [],
								"url": {
									"raw": "{{baseUrl}}/api/Profiles",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"api",
										"Profiles"
									]
								}
							},
							"response": [
								{
									"id": "44172356-d83237f9-9ee0-4e04-837c-6b3ee494095e",
									"name": "OK",
									"originalRequest": {
										"method": "DELETE",
										"header": [],
										"url": {
											"raw": "{{baseUrl}}/api/Profiles",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"api",
												"Profiles"
											]
										}
									},
									"status": "OK",
									"code": 200,
									"_postman_previewlanguage": "text",
									"header": [],
									"cookie": [],
									"responseTime": null,
									"body": ""
								}
							]
						}
					],
					"id": "44172356-319d48d7-923f-40e3-89cc-5a3447e222ee",
					"auth": {
						"type": "bearer",
						"bearer": [
							{
								"key": "token",
								"value": "eyJhbGciOiJIUzI1NiIsImtpZCI6IjhkVjBVTkQzdm9tSzNUY1ciLCJ0eXAiOiJKV1QifQ.eyJhYWwiOiJhYWwxIiwiYWNjb3VudF9yb2xlIjoidXNlciIsImFtciI6W3sibWV0aG9kIjoicGFzc3dvcmQiLCJ0aW1lc3RhbXAiOjE3NTk2ODc3MDF9XSwiYXBwX21ldGFkYXRhIjp7InByb3ZpZGVyIjoiZW1haWwiLCJwcm92aWRlcnMiOlsiZW1haWwiXX0sImF1ZCI6ImF1dGhlbnRpY2F0ZWQiLCJlbWFpbCI6InRvcGh1cXV5MjcxMkBnbWFpbC5jb20iLCJleHAiOjE3NTk2OTEzMDEsImlhdCI6MTc1OTY4NzcwMSwiaXNfYW5vbnltb3VzIjpmYWxzZSwiaXNzIjoiaHR0cHM6Ly9qZ291bnlsbWdqY21sd3l6enpodi5zdXBhYmFzZS5jby9hdXRoL3YxIiwicGhvbmUiOiIiLCJyb2xlIjoiYXV0aGVudGljYXRlZCIsInNlc3Npb25faWQiOiI1NzAxZTM2Ni0wMGI4LTQ1YjYtYTMwMC02N2FjMmRkOTFkZjMiLCJzdWIiOiJmM2NlYWM2NC1hNGYyLTQxYzAtYjFmZS03MjBmMjhmZTJlYzEiLCJ1c2VyX21ldGFkYXRhIjp7ImVtYWlsIjoidG9waHVxdXkyNzEyQGdtYWlsLmNvbSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJmdWxsX25hbWUiOiJjYyBjaGFtIGNvbSIsInBob25lX3ZlcmlmaWVkIjpmYWxzZSwic3ViIjoiZjNjZWFjNjQtYTRmMi00MWMwLWIxZmUtNzIwZjI4ZmUyZWMxIiwidXNlcm5hbWUiOiJjYyJ9fQ.FQVDGIFPwPTFd97ypy78GEiHkpFzulkKPKKrObTVZ44",
								"type": "string"
							}
						]
					},
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"id": "9f4825fb-7366-4ae3-a2fe-b60dd8eeb122",
								"type": "text/javascript",
								"packages": {},
								"requests": {},
								"exec": [
									""
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"id": "7a34c071-db64-4893-9902-bbd9e3aa8ace",
								"type": "text/javascript",
								"packages": {},
								"requests": {},
								"exec": [
									""
								]
							}
						}
					]
				},
				{
					"name": "ProfilesSync",
					"item": [
						{
							"name": "sync",
							"item": [
								{
									"name": "/api/ProfilesSync/sync",
									"id": "44172356-afc15a08-b6e1-458f-9a88-bfabb9d42199",
									"protocolProfileBehavior": {
										"disableBodyPruning": true
									},
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"user_id\": \"cc99d7d3-2e1b-554e-9ed0-3a9c134f89ee\",\n  \"email\": \"string\",\n  \"role\": \"string\",\n  \"raw_user_meta_data\": {}\n}",
											"options": {
												"raw": {
													"headerFamily": "json",
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{baseUrl}}/api/ProfilesSync/sync",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"api",
												"ProfilesSync",
												"sync"
											]
										}
									},
									"response": [
										{
											"id": "44172356-eee313ec-24d3-4107-b737-21c4287acfbd",
											"name": "OK",
											"originalRequest": {
												"method": "POST",
												"header": [
													{
														"key": "Content-Type",
														"value": "application/json"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n  \"user_id\": \"cc99d7d3-2e1b-554e-9ed0-3a9c134f89ee\",\n  \"email\": \"string\",\n  \"role\": \"string\",\n  \"raw_user_meta_data\": {}\n}",
													"options": {
														"raw": {
															"headerFamily": "json",
															"language": "json"
														}
													}
												},
												"url": {
													"raw": "{{baseUrl}}/api/ProfilesSync/sync",
													"host": [
														"{{baseUrl}}"
													],
													"path": [
														"api",
														"ProfilesSync",
														"sync"
													]
												}
											},
											"status": "OK",
											"code": 200,
											"_postman_previewlanguage": "text",
											"header": [],
											"cookie": [],
											"responseTime": null,
											"body": ""
										}
									]
								}
							],
							"id": "44172356-6dcef18b-92d7-468a-a0ba-b6b934a398fe"
						}
					],
					"id": "44172356-575fbbe4-72dc-4d6c-a06c-dfae83d8a68d"
				},
				{
					"name": "Reports",
					"item": [
						{
							"name": "{id}",
							"item": [
								{
									"name": "/api/Reports/:id",
									"id": "44172356-e0707e9b-368d-441e-8895-51ba142f84b1",
									"protocolProfileBehavior": {
										"disableBodyPruning": true
									},
									"request": {
										"method": "PUT",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"newStatus\": 6840\n}",
											"options": {
												"raw": {
													"headerFamily": "json",
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{baseUrl}}/api/Reports/:id",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"api",
												"Reports",
												":id"
											],
											"variable": [
												{
													"id": "2c0d9b1d-d7ad-49ba-be79-ade913b933f6",
													"key": "id",
													"value": "57e7bc5b-cbe8-6dce-856f-60b3dd3de49f"
												}
											]
										}
									},
									"response": [
										{
											"id": "44172356-3b1b1142-019b-4e7f-9c2b-0dc2d092e52b",
											"name": "OK",
											"originalRequest": {
												"method": "PUT",
												"header": [
													{
														"key": "Content-Type",
														"value": "application/json"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n  \"newStatus\": 6840\n}",
													"options": {
														"raw": {
															"headerFamily": "json",
															"language": "json"
														}
													}
												},
												"url": {
													"raw": "{{baseUrl}}/api/Reports/:id",
													"host": [
														"{{baseUrl}}"
													],
													"path": [
														"api",
														"Reports",
														":id"
													],
													"variable": [
														{
															"key": "id"
														}
													]
												}
											},
											"status": "OK",
											"code": 200,
											"_postman_previewlanguage": "text",
											"header": [],
											"cookie": [],
											"responseTime": null,
											"body": ""
										}
									]
								}
							],
							"id": "44172356-4df15141-481e-4f99-b6af-5e035cdf35a1"
						},
						{
							"name": "/api/Reports",
							"id": "44172356-cf3c31ce-73d1-4a28-bc56-a08f8212493a",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "Accept",
										"value": "text/plain"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"reporterProfileId\": \"4763335a-42cc-f1c4-2b0c-2148b6052f07\",\n  \"targetType\": 7714,\n  \"targetId\": \"fd3e579a-c9e8-5cad-70de-05642ad096a5\",\n  \"reason\": \"string\"\n}",
									"options": {
										"raw": {
											"headerFamily": "json",
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/api/Reports",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"api",
										"Reports"
									]
								}
							},
							"response": [
								{
									"id": "44172356-eae0a773-d4ef-471d-9215-c534f6689d04",
									"name": "OK",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "Accept",
												"value": "text/plain"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"reporterProfileId\": \"4763335a-42cc-f1c4-2b0c-2148b6052f07\",\n  \"targetType\": 7714,\n  \"targetId\": \"fd3e579a-c9e8-5cad-70de-05642ad096a5\",\n  \"reason\": \"string\"\n}",
											"options": {
												"raw": {
													"headerFamily": "json",
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{baseUrl}}/api/Reports",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"api",
												"Reports"
											]
										}
									},
									"status": "OK",
									"code": 200,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"cookie": [],
									"responseTime": null,
									"body": "{\n  \"id\": \"97e16379-3943-cb4c-d2a8-55fe79bd7930\",\n  \"reporterProfileId\": \"cecd811a-eb61-d791-e776-0d4d239063b8\",\n  \"targetType\": 6634,\n  \"targetId\": \"75ce5f08-d8d7-d923-a78a-2ffc2e4be803\",\n  \"reason\": \"string\",\n  \"status\": 9569,\n  \"createdAt\": \"1987-06-23T02:52:04.517Z\",\n  \"actedAt\": \"1976-03-15T21:17:28.221Z\",\n  \"data\": \"string\"\n}"
								}
							]
						},
						{
							"name": "/api/Reports",
							"id": "44172356-233de713-685c-4287-9646-a283bd36711c",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "Accept",
										"value": "text/plain"
									}
								],
								"url": {
									"raw": "{{baseUrl}}/api/Reports?page=1&pageSize=20",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"api",
										"Reports"
									],
									"query": [
										{
											"key": "page",
											"value": "1"
										},
										{
											"key": "pageSize",
											"value": "20"
										}
									]
								}
							},
							"response": [
								{
									"id": "44172356-b7c1ea75-dcfc-4524-bf49-bf78fd3fb8d9",
									"name": "OK",
									"originalRequest": {
										"method": "GET",
										"header": [
											{
												"key": "Accept",
												"value": "text/plain"
											}
										],
										"url": {
											"raw": "{{baseUrl}}/api/Reports?page=1&pageSize=20",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"api",
												"Reports"
											],
											"query": [
												{
													"key": "page",
													"value": "1"
												},
												{
													"key": "pageSize",
													"value": "20"
												}
											]
										}
									},
									"status": "OK",
									"code": 200,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"cookie": [],
									"responseTime": null,
									"body": "{\n  \"items\": [\n    {\n      \"id\": \"cdde984e-b8f7-b1ed-d56e-b507008b323f\",\n      \"reporterProfileId\": \"36402493-5e58-8457-8d0a-6a81a3f05071\",\n      \"targetType\": 2828,\n      \"targetId\": \"b959afdf-d89d-d800-557c-52cab91d7e55\",\n      \"reason\": \"string\",\n      \"status\": 8093,\n      \"createdAt\": \"2003-09-29T23:19:08.129Z\",\n      \"actedAt\": \"2018-11-30T14:11:13.402Z\",\n      \"data\": \"string\"\n    },\n    {\n      \"id\": \"39fe30b4-6ed5-f345-4804-84c3b0d46126\",\n      \"reporterProfileId\": \"b181b192-0311-ccdc-f2fe-e2b79c7ea376\",\n      \"targetType\": 8401,\n      \"targetId\": \"32af4eaa-91f9-4e9b-d3f0-a044641d1467\",\n      \"reason\": \"string\",\n      \"status\": 5875,\n      \"createdAt\": \"1987-07-12T11:47:08.903Z\",\n      \"actedAt\": \"1998-10-28T00:04:34.715Z\",\n      \"data\": \"string\"\n    }\n  ],\n  \"page\": 3808,\n  \"pageSize\": 1660,\n  \"totalCount\": 6306\n}"
								}
							]
						}
					],
					"id": "44172356-a2702601-bf9c-4a8b-8d10-2d3fab1f4388"
				},
				{
					"name": "Search",
					"item": [
						{
							"name": "/api/Search",
							"id": "44172356-9764d761-f542-4969-8c85-772d215c56fc",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "Accept",
										"value": "text/plain"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"query\": \"string\",\n  \"page\": 8274,\n  \"pageSize\": 5783\n}",
									"options": {
										"raw": {
											"headerFamily": "json",
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/api/Search",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"api",
										"Search"
									]
								}
							},
							"response": [
								{
									"id": "44172356-7078e855-a6a3-434c-88db-11f19d963e8e",
									"name": "OK",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "Accept",
												"value": "text/plain"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"query\": \"string\",\n  \"page\": 8274,\n  \"pageSize\": 5783\n}",
											"options": {
												"raw": {
													"headerFamily": "json",
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{baseUrl}}/api/Search",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"api",
												"Search"
											]
										}
									},
									"status": "OK",
									"code": 200,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"cookie": [],
									"responseTime": null,
									"body": "{\n  \"posts\": [\n    {\n      \"id\": \"7d7f9f33-15f9-c849-63eb-5ab45c820639\",\n      \"caption\": \"string\",\n      \"thumbnailUrl\": \"string\"\n    },\n    {\n      \"id\": \"ac13d0ee-4d4b-cc28-9e8c-9c7c27acd63d\",\n      \"caption\": \"string\",\n      \"thumbnailUrl\": \"string\"\n    }\n  ],\n  \"tags\": [\n    {\n      \"id\": \"78b5ec44-0296-065e-9615-511713bffcd4\",\n      \"name\": \"string\",\n      \"postCount\": 1000\n    },\n    {\n      \"id\": \"57751759-d3bb-2a72-86d6-fda42b8f26fb\",\n      \"name\": \"string\",\n      \"postCount\": 5805\n    }\n  ]\n}"
								}
							]
						}
					],
					"id": "44172356-77adf714-bf69-4c03-b22b-678824ae88ce"
				},
				{
					"name": "Tags",
					"item": [
						{
							"name": "{id}",
							"item": [
								{
									"name": "posts",
									"item": [
										{
											"name": "/api/Tags/:id/posts",
											"id": "44172356-ecd11834-b51e-41a7-b2ff-db33ac82fb36",
											"protocolProfileBehavior": {
												"disableBodyPruning": true
											},
											"request": {
												"method": "GET",
												"header": [
													{
														"key": "Accept",
														"value": "text/plain"
													}
												],
												"url": {
													"raw": "{{baseUrl}}/api/Tags/:id/posts?page=1&pageSize=20",
													"host": [
														"{{baseUrl}}"
													],
													"path": [
														"api",
														"Tags",
														":id",
														"posts"
													],
													"query": [
														{
															"key": "page",
															"value": "1"
														},
														{
															"key": "pageSize",
															"value": "20"
														}
													],
													"variable": [
														{
															"id": "5d2c9fde-9905-488f-8039-7ae299f0633d",
															"key": "id",
															"value": "57e7bc5b-cbe8-6dce-856f-60b3dd3de49f"
														}
													]
												}
											},
											"response": [
												{
													"id": "44172356-193ba51a-733f-4aae-98ab-cbce945a5273",
													"name": "OK",
													"originalRequest": {
														"method": "GET",
														"header": [
															{
																"key": "Accept",
																"value": "text/plain"
															}
														],
														"url": {
															"raw": "{{baseUrl}}/api/Tags/:id/posts?page=1&pageSize=20",
															"host": [
																"{{baseUrl}}"
															],
															"path": [
																"api",
																"Tags",
																":id",
																"posts"
															],
															"query": [
																{
																	"key": "page",
																	"value": "1"
																},
																{
																	"key": "pageSize",
																	"value": "20"
																}
															],
															"variable": [
																{
																	"key": "id"
																}
															]
														}
													},
													"status": "OK",
													"code": 200,
													"_postman_previewlanguage": "json",
													"header": [
														{
															"key": "Content-Type",
															"value": "application/json"
														}
													],
													"cookie": [],
													"responseTime": null,
													"body": "{\n  \"items\": [\n    {\n      \"id\": \"8e215a08-43e2-f048-0563-ded1cb003c06\",\n      \"authorProfileId\": \"ec74a444-2a68-903a-01a0-2507b9bbb122\",\n      \"caption\": \"string\",\n      \"createdAt\": \"1962-11-21T10:44:00.320Z\",\n      \"updatedAt\": \"2013-08-18T18:02:59.988Z\",\n      \"privacyLevel\": 2391,\n      \"medias\": [\n        {\n          \"id\": \"f151e891-c548-a819-8f71-200404862eb2\",\n          \"postId\": \"b03fe9ce-7bc2-4755-7019-24b628c03184\",\n          \"url\": \"string\",\n          \"publicId\": \"string\",\n          \"width\": 9161,\n          \"height\": 662,\n          \"format\": \"string\",\n          \"position\": 6659,\n          \"thumbnailUrl\": \"string\"\n        },\n        {\n          \"id\": \"df73f51b-cc01-a4df-1563-47bdc2329fc6\",\n          \"postId\": \"1220e246-4991-18fd-b267-4869985194ed\",\n          \"url\": \"string\",\n          \"publicId\": \"string\",\n          \"width\": 3049,\n          \"height\": 3180,\n          \"format\": \"string\",\n          \"position\": 2935,\n          \"thumbnailUrl\": \"string\"\n        }\n      ],\n      \"tags\": [\n        {\n          \"id\": \"19192fad-432f-5356-3572-455dc4bdbd6e\",\n          \"name\": \"string\"\n        },\n        {\n          \"id\": \"79119f34-fefb-87ec-1315-63031a4ad058\",\n          \"name\": \"string\"\n        }\n      ],\n      \"reactions\": {\n        \"total\": 7987,\n        \"byType\": {\n          \"key_0\": 6475\n        },\n        \"currentUserReaction\": 4681\n      }\n    },\n    {\n      \"id\": \"9eb12a26-fcd6-041c-ac69-f2d30cfb5ad9\",\n      \"authorProfileId\": \"50ddcbd2-e4e5-2723-820e-6457ef0a9e30\",\n      \"caption\": \"string\",\n      \"createdAt\": \"1975-04-20T00:07:58.427Z\",\n      \"updatedAt\": \"1995-11-29T02:57:08.961Z\",\n      \"privacyLevel\": 4218,\n      \"medias\": [\n        {\n          \"id\": \"d8ba6f26-eb67-5d9e-e8c0-c820befe7a86\",\n          \"postId\": \"45e60431-879a-0aef-bafc-1da783ecf6ca\",\n          \"url\": \"string\",\n          \"publicId\": \"string\",\n          \"width\": 7346,\n          \"height\": 1396,\n          \"format\": \"string\",\n          \"position\": 5693,\n          \"thumbnailUrl\": \"string\"\n        },\n        {\n          \"id\": \"93a7edac-0a95-469b-ddf2-3c8c077932f2\",\n          \"postId\": \"694584f8-1920-4883-e210-b41f96b7d817\",\n          \"url\": \"string\",\n          \"publicId\": \"string\",\n          \"width\": 3096,\n          \"height\": 2945,\n          \"format\": \"string\",\n          \"position\": 9307,\n          \"thumbnailUrl\": \"string\"\n        }\n      ],\n      \"tags\": [\n        {\n          \"id\": \"d0f89c01-683b-b842-be69-7cb448fdaa7d\",\n          \"name\": \"string\"\n        },\n        {\n          \"id\": \"3c75270e-444d-bba8-ce41-d5822320d61b\",\n          \"name\": \"string\"\n        }\n      ],\n      \"reactions\": {\n        \"total\": 9962,\n        \"byType\": {\n          \"key_0\": 4846,\n          \"key_1\": 3519\n        },\n        \"currentUserReaction\": 5342\n      }\n    }\n  ],\n  \"page\": 548,\n  \"pageSize\": 7421,\n  \"totalCount\": 429\n}"
												}
											]
										}
									],
									"id": "44172356-2dc79514-37b5-4e85-96d1-d6d1f8519420"
								},
								{
									"name": "/api/Tags/:id",
									"id": "44172356-5cf93e60-5092-4507-ba2d-0b21fccd7ae2",
									"protocolProfileBehavior": {
										"disableBodyPruning": true
									},
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "Accept",
												"value": "text/plain"
											}
										],
										"url": {
											"raw": "{{baseUrl}}/api/Tags/:id",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"api",
												"Tags",
												":id"
											],
											"variable": [
												{
													"id": "28e0179e-cc0d-4c47-9799-80f4a76ddb26",
													"key": "id",
													"value": "57e7bc5b-cbe8-6dce-856f-60b3dd3de49f"
												}
											]
										}
									},
									"response": [
										{
											"id": "44172356-85a92563-8535-4199-bde7-b99e53a1495f",
											"name": "OK",
											"originalRequest": {
												"method": "GET",
												"header": [
													{
														"key": "Accept",
														"value": "text/plain"
													}
												],
												"url": {
													"raw": "{{baseUrl}}/api/Tags/:id",
													"host": [
														"{{baseUrl}}"
													],
													"path": [
														"api",
														"Tags",
														":id"
													],
													"variable": [
														{
															"key": "id"
														}
													]
												}
											},
											"status": "OK",
											"code": 200,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Content-Type",
													"value": "application/json"
												}
											],
											"cookie": [],
											"responseTime": null,
											"body": "{\n  \"id\": \"68254c2c-a37f-6009-3e0d-30b9bc521da3\",\n  \"name\": \"string\",\n  \"postCount\": 9416\n}"
										}
									]
								}
							],
							"id": "44172356-c40bb554-c881-43bd-b1a7-2764ef37ba99"
						},
						{
							"name": "/api/Tags",
							"id": "44172356-a6c074b9-8492-4d31-88be-d055a5942718",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "Accept",
										"value": "text/plain"
									}
								],
								"url": {
									"raw": "{{baseUrl}}/api/Tags",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"api",
										"Tags"
									]
								}
							},
							"response": [
								{
									"id": "44172356-4c49253e-6439-4837-a918-f62f980609bd",
									"name": "OK",
									"originalRequest": {
										"method": "GET",
										"header": [
											{
												"key": "Accept",
												"value": "text/plain"
											}
										],
										"url": {
											"raw": "{{baseUrl}}/api/Tags",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"api",
												"Tags"
											]
										}
									},
									"status": "OK",
									"code": 200,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"cookie": [],
									"responseTime": null,
									"body": "[\n  {\n    \"id\": \"a96a34de-4fdc-32b4-4f9f-54496016a29d\",\n    \"name\": \"string\",\n    \"postCount\": 100\n  },\n  {\n    \"id\": \"5f9b2cdd-586f-ab7b-e3e3-ea6443883085\",\n    \"name\": \"string\",\n    \"postCount\": 3464\n  }\n]"
								}
							]
						},
						{
							"name": "/api/Tags",
							"id": "44172356-b3b2b104-a572-45d3-9212-79cf60a0c551",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Accept",
										"value": "text/plain"
									}
								],
								"url": {
									"raw": "{{baseUrl}}/api/Tags?name=string",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"api",
										"Tags"
									],
									"query": [
										{
											"key": "name",
											"value": "string"
										}
									]
								}
							},
							"response": [
								{
									"id": "44172356-1a077ce3-c531-4d5d-ae35-9c172cfd30a6",
									"name": "OK",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Accept",
												"value": "text/plain"
											}
										],
										"url": {
											"raw": "{{baseUrl}}/api/Tags?name=string",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"api",
												"Tags"
											],
											"query": [
												{
													"key": "name",
													"value": "string"
												}
											]
										}
									},
									"status": "OK",
									"code": 200,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"cookie": [],
									"responseTime": null,
									"body": "{\n  \"id\": \"68254c2c-a37f-6009-3e0d-30b9bc521da3\",\n  \"name\": \"string\",\n  \"postCount\": 9416\n}"
								}
							]
						}
					],
					"id": "44172356-3fa1432b-94bf-4b30-b9d5-b13347b479a3"
				}
			],
			"id": "44172356-53a82a15-74d6-40fe-a3b0-b13afaa4f630",
			"auth": {
				"type": "bearer",
				"bearer": [
					{
						"key": "token",
						"value": "eyJhbGciOiJIUzI1NiIsImtpZCI6IjhkVjBVTkQzdm9tSzNUY1ciLCJ0eXAiOiJKV1QifQ.eyJhYWwiOiJhYWwxIiwiYWNjb3VudF9yb2xlIjoidXNlciIsImFtciI6W3sibWV0aG9kIjoicGFzc3dvcmQiLCJ0aW1lc3RhbXAiOjE3NjA5NjQ0Nzl9XSwiYXBwX21ldGFkYXRhIjp7InByb3ZpZGVyIjoiZW1haWwiLCJwcm92aWRlcnMiOlsiZW1haWwiXX0sImF1ZCI6ImF1dGhlbnRpY2F0ZWQiLCJlbWFpbCI6IjIzNTIxMzIwQGdtLnVpdC5lZHUudm4iLCJleHAiOjE3NjA5NjgwNzksImlhdCI6MTc2MDk2NDQ3OSwiaXNfYW5vbnltb3VzIjpmYWxzZSwiaXNzIjoiaHR0cHM6Ly9qZ291bnlsbWdqY21sd3l6enpodi5zdXBhYmFzZS5jby9hdXRoL3YxIiwicGhvbmUiOiIiLCJyb2xlIjoiYXV0aGVudGljYXRlZCIsInNlc3Npb25faWQiOiI5YTAwODhmZS1kYTU1LTQ4NjctODJmNS0wODVkMzQwOWU0YjQiLCJzdWIiOiIxMzQ2NmFlMC1jOGE5LTQwNjktYjlmMi1lMDYyNGEyZmJkNDAiLCJ1c2VyX21ldGFkYXRhIjp7ImVtYWlsIjoiMjM1MjEzMjBAZ20udWl0LmVkdS52biIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJwaG9uZV92ZXJpZmllZCI6ZmFsc2UsInN1YiI6IjEzNDY2YWUwLWM4YTktNDA2OS1iOWYyLWUwNjI0YTJmYmQ0MCIsInVzZXJuYW1lIjoiY2MyIn19.hhON5E27DEjkf9jLClbV6XNaDkLfEw6VLAxHnTRBM5E",
						"type": "string"
					}
				]
			},
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"id": "5807c5d6-2e91-401c-983b-dc6ec65d794e",
						"type": "text/javascript",
						"packages": {},
						"requests": {},
						"exec": [
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"id": "56effcdc-87d2-4127-b037-89e9cad65d88",
						"type": "text/javascript",
						"packages": {},
						"requests": {},
						"exec": [
							""
						]
					}
				}
			]
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"id": "6e552764-e51a-4851-a8f1-994e8ff02e69",
				"type": "text/javascript",
				"packages": {},
				"requests": {},
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"id": "f9401c39-1133-458a-be52-8d925fc1295c",
				"type": "text/javascript",
				"packages": {},
				"requests": {},
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"key": "baseUrl",
			"value": "https://localhost:7138/"
		}
	]
}
</file>

</files>
